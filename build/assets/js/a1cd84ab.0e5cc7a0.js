"use strict";(self.webpackChunknestjs_mod_com=self.webpackChunknestjs_mod_com||[]).push([[117],{956:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>c,toc:()=>d});var t=s(4848),r=s(8453);const a={},o="@nestjs-mod/cache-manager",c={id:"packages/core/cache-manager/README",title:"@nestjs-mod/cache-manager",description:"A cache module for nodejs that allows easy wrapping of functions in cache, tiered caches, and a consistent interface for NestJS-mod (Wrapper for https://www.npmjs.com/package/cache-manager)",source:"@site/docs/packages/core/cache-manager/README.md",sourceDirName:"packages/core/cache-manager",slug:"/packages/core/cache-manager/",permalink:"/docs/packages/core/cache-manager/",draft:!1,unlisted:!1,editUrl:"https://github.com/nestjs-mod/nestjs-mod.com/blob/master/docs/packages/core/cache-manager/README.md",tags:[],version:"current",frontMatter:{},sidebar:"packagesSidebar",previous:{title:"@nestjs-mod/authorizer",permalink:"/docs/packages/core/authorizer/"},next:{title:"@nestjs-mod/minio",permalink:"/docs/packages/core/minio/"}},i={},d=[{value:"Installation",id:"installation",level:2},{value:"Modules",id:"modules",level:2},{value:"Modules descriptions",id:"modules-descriptions",level:2},{value:"CacheManagerModule",id:"cachemanagermodule",level:3},{value:"Use in NestJS",id:"use-in-nestjs",level:4},{value:"Use in NestJS-mod",id:"use-in-nestjs-mod",level:4},{value:"Shared providers",id:"shared-providers",level:4},{value:"Environments",id:"environments",level:4},{value:"Static configuration",id:"static-configuration",level:4},{value:"Links",id:"links",level:2},{value:"License",id:"license",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"nestjs-modcache-manager",children:"@nestjs-mod/cache-manager"}),"\n",(0,t.jsxs)(n.p,{children:["A cache module for nodejs that allows easy wrapping of functions in cache, tiered caches, and a consistent interface for NestJS-mod (Wrapper for ",(0,t.jsx)(n.a,{href:"https://www.npmjs.com/package/cache-manager",children:"https://www.npmjs.com/package/cache-manager"}),")"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://npmjs.org/package/@nestjs-mod/cache-manager",children:(0,t.jsx)(n.img,{src:"https://badgen.net/npm/v/@nestjs-mod/cache-manager",alt:"NPM version"})})," ",(0,t.jsx)(n.a,{href:"https://npmjs.org/package/@nestjs-mod/cache-manager",children:(0,t.jsx)(n.img,{src:"https://badgen.net/npm/dm/@nestjs-mod/cache-manager",alt:"monthly downloads"})})," ",(0,t.jsx)(n.a,{href:"https://t.me/nestjs_mod",children:(0,t.jsx)(n.img,{src:"https://img.shields.io/badge/group-telegram-blue.svg?maxAge=2592000",alt:"Telegram bot"})})]}),"\n",(0,t.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm i --save redis@4.6.7 cache-manager@5.4.0 cache-manager-redis-yet@4.1.2 @nestjs-mod/cache-manager\n"})}),"\n",(0,t.jsx)(n.h2,{id:"modules",children:"Modules"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Link"}),(0,t.jsx)(n.th,{children:"Category"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"#cachemanagermodule",children:"CacheManagerModule"})}),(0,t.jsx)(n.td,{children:"core"}),(0,t.jsxs)(n.td,{children:["A cache module for nodejs that allows easy wrapping of functions in cache, tiered caches, and a consistent interface for NestJS-mod (Wrapper for ",(0,t.jsx)(n.a,{href:"https://www.npmjs.com/package/cache-manager",children:"https://www.npmjs.com/package/cache-manager"}),")"]})]})})]}),"\n",(0,t.jsx)(n.h2,{id:"modules-descriptions",children:"Modules descriptions"}),"\n",(0,t.jsx)(n.h3,{id:"cachemanagermodule",children:"CacheManagerModule"}),"\n",(0,t.jsxs)(n.p,{children:["A cache module for nodejs that allows easy wrapping of functions in cache, tiered caches, and a consistent interface for NestJS-mod (Wrapper for ",(0,t.jsx)(n.a,{href:"https://www.npmjs.com/package/cache-manager",children:"https://www.npmjs.com/package/cache-manager"}),")"]}),"\n",(0,t.jsx)(n.h4,{id:"use-in-nestjs",children:"Use in NestJS"}),"\n",(0,t.jsx)(n.p,{children:"Use with forRoot options."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { NestFactory } from '@nestjs/core';\nimport { randomUUID } from 'crypto';\n\nimport { CacheManagerModule, CacheManagerService } from '@nestjs-mod/cache-manager';\nimport { isInfrastructureMode } from '@nestjs-mod/common';\nimport { Injectable, Module } from '@nestjs/common';\n\nconst userFeatureName = 'prisma-user';\n\n@Injectable()\nexport class AppService {\n  constructor(private readonly cacheManagerService: CacheManagerService) {}\n\n  async setCache({ externalUserId }: { externalUserId: string }) {\n    return await this.cacheManagerService.set('cache', externalUserId, 0);\n  }\n\n  async getCache() {\n    return await this.cacheManagerService.get('cache');\n  }\n}\n\nprocess.env.PRISMA_USER_REDIS_URL = 'redis://:redis_password@localhost:6379';\n\n@Module({\n  imports: [\n    CacheManagerModule.forRoot({\n      staticConfiguration: {\n        type: isInfrastructureMode() ? 'memory' : 'redis',\n        cacheFeatureName: userFeatureName,\n      },\n    }),\n  ],\n  providers: [AppService],\n})\nexport class AppModule {}\n\nasync function bootstrap() {\n  const app = await NestFactory.create(AppModule);\n  await app.listen(3000);\n\n  const service = app.get<AppService>(AppService);\n  const externalUserId = randomUUID();\n  await service.setCache({ externalUserId });\n  console.log(await service.getCache()); // output: '568a823e-65ea-46ba-aa57-0194ee67e0f9'\n}\n\nbootstrap();\n"})}),"\n",(0,t.jsx)(n.p,{children:"An example of access to module services with forFeature."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { NestFactory } from '@nestjs/core';\nimport { randomUUID } from 'crypto';\n\nimport { CacheManagerModule, CacheManagerService } from '@nestjs-mod/cache-manager';\nimport { isInfrastructureMode } from '@nestjs-mod/common';\nimport { Injectable, Module } from '@nestjs/common';\n\nconst userFeatureName = 'prisma-user';\n\n@Injectable()\nexport class FeatureService {\n  constructor(private readonly cacheManagerService: CacheManagerService) {}\n\n  async setCache({ externalUserId }: { externalUserId: string }) {\n    return await this.cacheManagerService.set('cache', externalUserId, 0);\n  }\n\n  async getCache() {\n    return await this.cacheManagerService.get('cache');\n  }\n}\n@Module({\n  imports: [\n    CacheManagerModule.forFeature({\n      featureModuleName: 'FeatureModule',\n    }),\n  ],\n  providers: [FeatureService],\n})\nexport class FeatureModule {}\n\nprocess.env.PRISMA_USER_REDIS_URL = 'redis://:redis_password@localhost:6379';\n\n@Module({\n  imports: [\n    CacheManagerModule.forRoot({\n      staticConfiguration: {\n        type: isInfrastructureMode() ? 'memory' : 'redis',\n        cacheFeatureName: userFeatureName,\n      },\n    }),\n    FeatureModule,\n  ],\n})\nexport class AppModule {}\n\nasync function bootstrap() {\n  const app = await NestFactory.create(AppModule);\n  await app.listen(3000);\n\n  const service = app.get<FeatureService>(FeatureService);\n  const externalUserId = randomUUID();\n  await service.setCache({ externalUserId });\n  console.log(await service.getCache()); // output: '568a823e-65ea-46ba-aa57-0194ee67e0f9'\n}\n\nbootstrap();\n"})}),"\n",(0,t.jsx)(n.h4,{id:"use-in-nestjs-mod",children:"Use in NestJS-mod"}),"\n",(0,t.jsxs)(n.p,{children:["An example of using forRoot with parameters, you can see the full example here ",(0,t.jsx)(n.a,{href:"https://github.com/nestjs-mod/nestjs-mod-contrib/tree/master/apps/example-cache-manager",children:"https://github.com/nestjs-mod/nestjs-mod-contrib/tree/master/apps/example-cache-manager"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"For work with Redis, you must first connect the Docker Compose module and the Docker Compose module to work with the Redis."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { CacheManagerModule } from '@nestjs-mod/cache-manager';\nimport {\n  DefaultNestApplicationInitializer,\n  DefaultNestApplicationListener,\n  InfrastructureMarkdownReportGenerator,\n  PACKAGE_JSON_FILE,\n  ProjectUtils,\n  bootstrapNestApplication,\n  isInfrastructureMode,\n} from '@nestjs-mod/common';\nimport { DOCKER_COMPOSE_FILE, DockerCompose, DockerComposeRedis } from '@nestjs-mod/docker-compose';\nimport { join } from 'path';\nimport { userFeatureName } from './app/app.constants';\nimport { AppModule } from './app/app.module';\n\nconst rootFolder = join(__dirname, '..', '..', '..');\nconst appFolder = join(rootFolder, 'apps', 'example-cache-manager');\n\nbootstrapNestApplication({\n  globalConfigurationOptions: { debug: true },\n  globalEnvironmentsOptions: { debug: true },\n  modules: {\n    system: [\n      ProjectUtils.forRoot({\n        staticConfiguration: {\n          applicationPackageJsonFile: join(\n            __dirname,\n            '..',\n            '..',\n            '..',\n            'apps/example-cache-manager',\n            PACKAGE_JSON_FILE\n          ),\n          packageJsonFile: join(rootFolder, PACKAGE_JSON_FILE),\n          envFile: join(rootFolder, '.env'),\n        },\n      }),\n      DefaultNestApplicationInitializer.forRoot(),\n      DefaultNestApplicationListener.forRoot({\n        staticConfiguration: {\n          // When running in infrastructure mode, the backend server does not start.\n          mode: isInfrastructureMode() ? 'silent' : 'listen',\n        },\n      }),\n    ],\n    core: [\n      CacheManagerModule.forRoot({\n        staticConfiguration: {\n          type: isInfrastructureMode() ? 'memory' : 'redis',\n          cacheFeatureName: userFeatureName,\n        },\n      }),\n    ],\n    feature: [AppModule.forRoot()],\n    infrastructure: [\n      InfrastructureMarkdownReportGenerator.forRoot({\n        staticConfiguration: {\n          markdownFile: join(appFolder, 'INFRASTRUCTURE.MD'),\n          skipEmptySettings: true,\n        },\n      }),\n      DockerCompose.forRoot({\n        configuration: {\n          dockerComposeFileVersion: '3',\n          dockerComposeFile: join(appFolder, DOCKER_COMPOSE_FILE),\n        },\n      }),\n      DockerComposeRedis.forRoot({ staticConfiguration: { featureName: userFeatureName } }),\n    ],\n  },\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:"New environment variable"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"EXAMPLE_CACHE_MANAGER_CACHE_MANAGER_USER_REDIS_URL=redis://:redis_password@localhost:6379\n"})}),"\n",(0,t.jsxs)(n.p,{children:["When launched in the infrastructure documentation generation mode, the module creates an ",(0,t.jsx)(n.code,{children:".env"})," file with a list of all required variables, as well as an example ",(0,t.jsx)(n.code,{children:"example.env"}),", where you can enter example variable values."]}),"\n",(0,t.jsx)(n.h4,{id:"shared-providers",children:"Shared providers"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"CacheManagerService"})}),"\n",(0,t.jsx)(n.h4,{id:"environments",children:"Environments"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Key"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Sources"}),(0,t.jsx)(n.th,{children:"Constraints"}),(0,t.jsx)(n.th,{children:"Default"}),(0,t.jsx)(n.th,{children:"Value"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"redisUrl"})}),(0,t.jsxs)(n.td,{children:["Connection string for Redis, if it empty memoryStore use for store data (example: redis://",":redis_password","@localhost:6379)"]}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"obj['redisUrl']"}),", ",(0,t.jsx)(n.code,{children:"process.env['REDIS_URL']"})]}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"optional"})}),(0,t.jsx)(n.td,{children:"-"}),(0,t.jsx)(n.td,{children:"-"})]})})]}),"\n",(0,t.jsx)(n.h4,{id:"static-configuration",children:"Static configuration"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Key"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Constraints"}),(0,t.jsx)(n.th,{children:"Default"}),(0,t.jsx)(n.th,{children:"Value"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"type"})}),(0,t.jsx)(n.td,{children:"Type of storage for store data (memory or redis)"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"optional"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"memory"})}),(0,t.jsx)(n.td,{children:"-"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"defaultLogger"})}),(0,t.jsx)(n.td,{children:"Default logger"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"optional"})}),(0,t.jsx)(n.td,{children:"-"}),(0,t.jsx)(n.td,{children:"-"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"featureName"})}),(0,t.jsx)(n.td,{children:"Feature name for generate prefix to environments keys"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"optional"})}),(0,t.jsx)(n.td,{children:"-"}),(0,t.jsx)(n.td,{children:"-"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"ttl"})}),(0,t.jsx)(n.td,{children:"TTL"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"optional"})}),(0,t.jsx)(n.td,{children:"-"}),(0,t.jsx)(n.td,{children:"-"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"refreshThreshold"})}),(0,t.jsx)(n.td,{children:"Refresh threshold"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"optional"})}),(0,t.jsx)(n.td,{children:"-"}),(0,t.jsx)(n.td,{children:"-"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"isCacheable"})}),(0,t.jsx)(n.td,{children:"Is cacheable"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"optional"})}),(0,t.jsx)(n.td,{children:"-"}),(0,t.jsx)(n.td,{children:"-"})]})]})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"#modules",children:"Back to Top"})}),"\n",(0,t.jsx)(n.h2,{id:"links",children:"Links"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/nestjs-mod/nestjs-mod",children:"https://github.com/nestjs-mod/nestjs-mod"})," - A collection of utilities for unifying NestJS applications and modules"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/nestjs-mod/nestjs-mod-contrib",children:"https://github.com/nestjs-mod/nestjs-mod-contrib"})," - Contrib repository for the NestJS-mod"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/nestjs-mod/nestjs-mod-example",children:"https://github.com/nestjs-mod/nestjs-mod-example"})," - Example application built with ",(0,t.jsx)(n.a,{href:"https://github.com/nestjs-mod/nestjs-mod/tree/master/libs/schematics",children:"@nestjs-mod/schematics"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/nestjs-mod/nestjs-mod/blob/master/apps/example-basic/INFRASTRUCTURE.MD",children:"https://github.com/nestjs-mod/nestjs-mod/blob/master/apps/example-basic/INFRASTRUCTURE.MD"})," - A simple example of infrastructure documentation."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/nestjs-mod/nestjs-mod-contrib/blob/master/apps/example-prisma/INFRASTRUCTURE.MD",children:"https://github.com/nestjs-mod/nestjs-mod-contrib/blob/master/apps/example-prisma/INFRASTRUCTURE.MD"})," - An extended example of infrastructure documentation with a docker-compose file and a data base."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://dev.to/endykaufman/collection-of-nestjs-mod-utilities-for-unifying-applications-and-modules-on-nestjs-5256",children:"https://dev.to/endykaufman/collection-of-nestjs-mod-utilities-for-unifying-applications-and-modules-on-nestjs-5256"})," - Article about the project NestJS-mod"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"license",children:"License"}),"\n",(0,t.jsx)(n.p,{children:"MIT"})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>c});var t=s(6540);const r={},a=t.createContext(r);function o(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);