"use strict";(self.webpackChunknestjs_mod_com=self.webpackChunknestjs_mod_com||[]).push([[570],{7380:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>a,toc:()=>c});var s=t(4848),r=t(8453);const i={},o="\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u043e\u0433\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0447\u0435\u0440\u0435\u0437 WebSockets \u0438 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0435\u0433\u043e \u0432 Angular-\u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0438",a={id:"ru-posts/fullstack/2024-11-21",title:"\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u043e\u0433\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0447\u0435\u0440\u0435\u0437 WebSockets \u0438 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0435\u0433\u043e \u0432 Angular-\u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0438",description:"\u0412 \u044d\u0442\u043e\u043c \u043f\u043e\u0441\u0442\u0435 \u044f \u043e\u043f\u0438\u0448\u0443 \u043a\u0430\u043a \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0432\u0435\u0431-\u0441\u043e\u043a\u0435\u0442\u043d\u044b\u0439 \u0441\u0442\u0440\u0438\u043c \u0432 \u0431\u044d\u043a\u0435\u043d\u0434\u0435 \u043d\u0430 NestJS \u0438 \u043f\u043e\u0434\u043f\u0438\u0441\u0430\u0442\u044c\u0441\u044f \u043d\u0430 \u043d\u0435\u0433\u043e \u0438\u0437 \u0444\u0440\u043e\u043d\u0442\u0435\u043d\u0434 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f \u043d\u0430 Angular.",source:"@site/docs/ru-posts/fullstack/2024-11-21.md",sourceDirName:"ru-posts/fullstack",slug:"/ru-posts/fullstack/2024-11-21",permalink:"/docs/ru-posts/fullstack/2024-11-21",draft:!1,unlisted:!1,editUrl:"https://github.com/nestjs-mod/nestjs-mod.com/blob/master/docs/ru-posts/fullstack/2024-11-21.md",tags:[],version:"current",frontMatter:{},sidebar:"ruPostsSidebar",previous:{title:"\u041a\u044d\u0448\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u0432 Redis \u043d\u0430 NestJS",permalink:"/docs/ru-posts/fullstack/2024-11-20"},next:{title:"\u0412\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044f REST-\u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u0432 NestJS-\u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0438 \u0438 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043e\u0448\u0438\u0431\u043e\u043a \u0432 \u0444\u043e\u0440\u043c\u0430\u0445 Angular-\u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f",permalink:"/docs/ru-posts/fullstack/2024-11-24"}},l={},c=[{value:"1. \u0423\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u043c \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0438",id:"1-\u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u043c-\u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435-\u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0438",level:3},{value:"2. \u0421\u043e\u0437\u0434\u0430\u0435\u043c \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043e\u0442\u0434\u0430\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u043e\u0435 \u0432\u0440\u0435\u043c\u044f",id:"2-\u0441\u043e\u0437\u0434\u0430\u0435\u043c-\u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440-\u043a\u043e\u0442\u043e\u0440\u044b\u0439-\u043e\u0442\u0434\u0430\u0435\u0442-\u0441\u0435\u0440\u0432\u0435\u0440\u043d\u043e\u0435-\u0432\u0440\u0435\u043c\u044f",level:3},{value:"3. \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u0432 AppModule",id:"3-\u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c-\u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440-\u0432-appmodule",level:3},{value:"4. \u041f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u0435\u043c SDK \u0434\u043b\u044f \u0444\u0440\u043e\u043d\u0442\u0435\u043d\u0434\u0430 \u0438 \u0442\u0435\u0441\u0442\u043e\u0432",id:"4-\u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u0435\u043c-sdk-\u0434\u043b\u044f-\u0444\u0440\u043e\u043d\u0442\u0435\u043d\u0434\u0430-\u0438-\u0442\u0435\u0441\u0442\u043e\u0432",level:3},{value:"5. \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u0443\u0442\u0438\u043b\u0438\u0442\u0443 \u0434\u043b\u044f \u0443\u0434\u043e\u0431\u043d\u043e\u0439 \u0440\u0430\u0431\u043e\u0442\u044b \u0441 \u0432\u0435\u0431-\u0441\u043e\u043a\u0435\u0442\u0430\u043c \u0438\u0437 Angular-\u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f",id:"5-\u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c-\u0443\u0442\u0438\u043b\u0438\u0442\u0443-\u0434\u043b\u044f-\u0443\u0434\u043e\u0431\u043d\u043e\u0439-\u0440\u0430\u0431\u043e\u0442\u044b-\u0441-\u0432\u0435\u0431-\u0441\u043e\u043a\u0435\u0442\u0430\u043c-\u0438\u0437-angular-\u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f",level:3},{value:"6. \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0438 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u043e\u0433\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0432 \u0444\u0443\u0442\u0435\u0440\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b",id:"6-\u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c-\u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435-\u0438-\u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435-\u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e-\u0441\u0435\u0440\u0432\u0435\u0440\u043d\u043e\u0433\u043e-\u0432\u0440\u0435\u043c\u0435\u043d\u0438-\u0432-\u0444\u0443\u0442\u0435\u0440\u0435-\u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b",level:3},{value:"7. \u0421\u043e\u0437\u0434\u0430\u0435\u043c E2E-\u0442\u0435\u0441\u0442 \u0434\u043b\u044f \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0440\u0430\u0431\u043e\u0442\u044b \u043b\u043e\u0433\u0438\u043a \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0445 \u0441 \u0432\u0440\u0435\u043c\u0435\u043d\u0435\u043c",id:"7-\u0441\u043e\u0437\u0434\u0430\u0435\u043c-e2e-\u0442\u0435\u0441\u0442-\u0434\u043b\u044f-\u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438-\u0440\u0430\u0431\u043e\u0442\u044b-\u043b\u043e\u0433\u0438\u043a-\u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0445-\u0441-\u0432\u0440\u0435\u043c\u0435\u043d\u0435\u043c",level:3},{value:"8. \u0417\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u043c \u0438\u043d\u0444\u0440\u0430\u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443 \u0441 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f\u043c\u0438 \u0432 \u0440\u0435\u0436\u0438\u043c\u0435 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u0440\u0430\u0431\u043e\u0442\u0443 \u0447\u0435\u0440\u0435\u0437 E2E-\u0442\u0435\u0441\u0442\u044b",id:"8-\u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u043c-\u0438\u043d\u0444\u0440\u0430\u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443-\u0441-\u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f\u043c\u0438-\u0432-\u0440\u0435\u0436\u0438\u043c\u0435-\u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0438-\u0438-\u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c-\u0440\u0430\u0431\u043e\u0442\u0443-\u0447\u0435\u0440\u0435\u0437-e2e-\u0442\u0435\u0441\u0442\u044b",level:3},{value:"\u0417\u0430\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435",id:"\u0437\u0430\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435",level:3},{value:"\u041f\u043b\u0430\u043d\u044b",id:"\u043f\u043b\u0430\u043d\u044b",level:3},{value:"\u0421\u0441\u044b\u043b\u043a\u0438",id:"\u0441\u0441\u044b\u043b\u043a\u0438",level:3}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"\u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435-\u0441\u0435\u0440\u0432\u0435\u0440\u043d\u043e\u0433\u043e-\u0432\u0440\u0435\u043c\u0435\u043d\u0438-\u0447\u0435\u0440\u0435\u0437-websockets-\u0438-\u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435-\u0435\u0433\u043e-\u0432-angular-\u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0438",children:"\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u043e\u0433\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0447\u0435\u0440\u0435\u0437 WebSockets \u0438 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0435\u0433\u043e \u0432 Angular-\u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0438"}),"\n",(0,s.jsxs)(n.p,{children:["\u0412 \u044d\u0442\u043e\u043c \u043f\u043e\u0441\u0442\u0435 \u044f \u043e\u043f\u0438\u0448\u0443 \u043a\u0430\u043a \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0432\u0435\u0431-\u0441\u043e\u043a\u0435\u0442\u043d\u044b\u0439 \u0441\u0442\u0440\u0438\u043c \u0432 \u0431\u044d\u043a\u0435\u043d\u0434\u0435 \u043d\u0430 ",(0,s.jsx)(n.code,{children:"NestJS"})," \u0438 \u043f\u043e\u0434\u043f\u0438\u0441\u0430\u0442\u044c\u0441\u044f \u043d\u0430 \u043d\u0435\u0433\u043e \u0438\u0437 \u0444\u0440\u043e\u043d\u0442\u0435\u043d\u0434 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f \u043d\u0430 ",(0,s.jsx)(n.code,{children:"Angular"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"1-\u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u043c-\u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435-\u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0438",children:"1. \u0423\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u043c \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0438"}),"\n",(0,s.jsxs)(n.p,{children:["\u0423\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u043c ",(0,s.jsx)(n.code,{children:"NestJS"}),"-\u043c\u043e\u0434\u0443\u043b\u0438 \u0434\u043b\u044f \u0440\u0430\u0431\u043e\u0442\u044b \u0441 ",(0,s.jsx)(n.code,{children:"websockets"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"\u041a\u043e\u043c\u0430\u043d\u0434\u044b"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm install --save @nestjs/websockets @nestjs/platform-socket.io @nestjs/platform-ws\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"\u0412\u044b\u0432\u043e\u0434 \u043a\u043e\u043d\u0441\u043e\u043b\u0438"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"$ npm install --save @nestjs/websockets @nestjs/platform-socket.io @nestjs/platform-ws\n\nadded 4 packages, removed 2 packages, and audited 2938 packages in 1m\n\n360 packages are looking for funding\n  run `npm fund` for details\n\n42 vulnerabilities (21 low, 3 moderate, 18 high)\n\nTo address issues that do not require attention, run:\n  npm audit fix\n\nTo address all issues possible (including breaking changes), run:\n  npm audit fix --force\n\nSome issues need review, and may require choosing\na different dependency.\n\nRun `npm audit` for details.\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-\u0441\u043e\u0437\u0434\u0430\u0435\u043c-\u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440-\u043a\u043e\u0442\u043e\u0440\u044b\u0439-\u043e\u0442\u0434\u0430\u0435\u0442-\u0441\u0435\u0440\u0432\u0435\u0440\u043d\u043e\u0435-\u0432\u0440\u0435\u043c\u044f",children:"2. \u0421\u043e\u0437\u0434\u0430\u0435\u043c \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043e\u0442\u0434\u0430\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u043e\u0435 \u0432\u0440\u0435\u043c\u044f"}),"\n",(0,s.jsx)(n.p,{children:"\u041a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u0438\u043c\u0435\u0435\u0442 \u043c\u0435\u0442\u043e\u0434 \u0432\u044b\u0434\u0430\u0447\u0438 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0438 \u0432\u0435\u0431-\u0441\u043e\u043a\u0435\u0442 \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043a\u0430\u0436\u0434\u0443\u044e \u0441\u0435\u043a\u0443\u043d\u0434\u0443 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0442\u0435\u043a\u0443\u0449\u0435\u0435 \u0432\u0440\u0435\u043c\u044f \u0431\u044d\u043a\u0435\u043d\u0434\u0430."}),"\n",(0,s.jsxs)(n.p,{children:["\u0421\u043e\u0437\u0434\u0430\u0435\u043c \u0444\u0430\u0439\u043b ",(0,s.jsx)(n.em,{children:"apps/server/src/app/time.controller.ts"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { Controller, Get } from '@nestjs/common';\n\nimport { AllowEmptyUser } from '@nestjs-mod/authorizer';\nimport { ApiOkResponse } from '@nestjs/swagger';\nimport { OnGatewayConnection, SubscribeMessage, WebSocketGateway, WsResponse } from '@nestjs/websockets';\nimport { interval, map, Observable } from 'rxjs';\n\nexport const ChangeTimeStream = 'ChangeTimeStream';\n\n@AllowEmptyUser()\n@WebSocketGateway({\n  cors: {\n    origin: '*',\n  },\n  path: '/ws/time',\n  transports: ['websocket'],\n})\n@Controller()\nexport class TimeController implements OnGatewayConnection {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  handleConnection(client: any, ...args: any[]) {\n    client.headers = args[0].headers;\n  }\n\n  @Get('/time')\n  @ApiOkResponse({ type: Date })\n  time() {\n    return new Date();\n  }\n\n  @SubscribeMessage(ChangeTimeStream)\n  onChangeTimeStream(): Observable<WsResponse<Date>> {\n    return interval(1000).pipe(\n      map(() => ({\n        data: new Date(),\n        event: ChangeTimeStream,\n      }))\n    );\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-\u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c-\u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440-\u0432-appmodule",children:"3. \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u0432 AppModule"}),"\n",(0,s.jsxs)(n.p,{children:["\u0422\u0430\u043a \u043a\u0430\u043a \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u0442\u0430\u043a\u0436\u0435 \u0432\u043a\u043b\u044e\u0447\u0430\u0435\u0442 \u0432 \u0441\u0435\u0431\u044f \u043b\u043e\u0433\u0438\u043a\u0443 \u0433\u0435\u0439\u0442\u0432\u0435\u044f, \u0442\u043e \u043f\u0440\u043e\u0432\u0430\u0439\u0434\u0438\u043c \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u0432 \u0441\u0435\u043a\u0446\u0438\u0438 ",(0,s.jsx)(n.code,{children:"controllers"})," \u0438 ",(0,s.jsx)(n.code,{children:"providers"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["\u041e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u043c \u0444\u0430\u0439\u043b ",(0,s.jsx)(n.em,{children:"apps/server/src/app/app.module.ts"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { createNestModule, NestModuleCategory } from '@nestjs-mod/common';\n\nimport { WebhookModule } from '@nestjs-mod-fullstack/webhook';\nimport { PrismaModule } from '@nestjs-mod/prisma';\nimport { ServeStaticModule } from '@nestjs/serve-static';\nimport { join } from 'path';\nimport { AppController } from './app.controller';\nimport { AppService } from './app.service';\nimport { TimeController } from './time.controller';\n\nexport const { AppModule } = createNestModule({\n  moduleName: 'AppModule',\n  moduleCategory: NestModuleCategory.feature,\n  imports: [\n    WebhookModule.forFeature({\n      featureModuleName: 'app',\n    }),\n    PrismaModule.forFeature({\n      contextName: 'app',\n      featureModuleName: 'app',\n    }),\n    ...(process.env.DISABLE_SERVE_STATIC\n      ? []\n      : [\n          ServeStaticModule.forRoot({\n            rootPath: join(__dirname, '..', 'client', 'browser'),\n          }),\n        ]),\n  ],\n  controllers: [AppController, TimeController],\n  providers: [AppService, TimeController],\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"4-\u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u0435\u043c-sdk-\u0434\u043b\u044f-\u0444\u0440\u043e\u043d\u0442\u0435\u043d\u0434\u0430-\u0438-\u0442\u0435\u0441\u0442\u043e\u0432",children:"4. \u041f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u0435\u043c SDK \u0434\u043b\u044f \u0444\u0440\u043e\u043d\u0442\u0435\u043d\u0434\u0430 \u0438 \u0442\u0435\u0441\u0442\u043e\u0432"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"\u041a\u043e\u043c\u0430\u043d\u0434\u044b"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm run generate\n"})}),"\n",(0,s.jsx)(n.h3,{id:"5-\u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c-\u0443\u0442\u0438\u043b\u0438\u0442\u0443-\u0434\u043b\u044f-\u0443\u0434\u043e\u0431\u043d\u043e\u0439-\u0440\u0430\u0431\u043e\u0442\u044b-\u0441-\u0432\u0435\u0431-\u0441\u043e\u043a\u0435\u0442\u0430\u043c-\u0438\u0437-angular-\u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f",children:"5. \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u0443\u0442\u0438\u043b\u0438\u0442\u0443 \u0434\u043b\u044f \u0443\u0434\u043e\u0431\u043d\u043e\u0439 \u0440\u0430\u0431\u043e\u0442\u044b \u0441 \u0432\u0435\u0431-\u0441\u043e\u043a\u0435\u0442\u0430\u043c \u0438\u0437 Angular-\u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f"}),"\n",(0,s.jsxs)(n.p,{children:["\u0421\u043e\u0437\u0434\u0430\u0435\u043c \u0444\u0430\u0439\u043b ",(0,s.jsx)(n.em,{children:"libs/common-angular/src/lib/utils/web-socket.ts"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { Observable, finalize } from 'rxjs';\n\nexport function webSocket<T>({\n  address,\n  eventName,\n  options,\n}: {\n  address: string;\n  eventName: string;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  options?: any;\n}) {\n  const wss = new WebSocket(address.replace('/api', '').replace('http', 'ws'), options);\n  return new Observable<{ data: T; event: string }>((observer) => {\n    wss.addEventListener('open', () => {\n      wss.addEventListener('message', ({ data }) => {\n        observer.next(JSON.parse(data.toString()));\n      });\n      wss.addEventListener('error', (err) => {\n        observer.error(err);\n        if (wss?.readyState == WebSocket.OPEN) {\n          wss.close();\n        }\n      });\n      wss.send(\n        JSON.stringify({\n          event: eventName,\n          data: true,\n        })\n      );\n    });\n  }).pipe(\n    finalize(() => {\n      if (wss?.readyState == WebSocket.OPEN) {\n        wss.close();\n      }\n    })\n  );\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"6-\u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c-\u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435-\u0438-\u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435-\u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e-\u0441\u0435\u0440\u0432\u0435\u0440\u043d\u043e\u0433\u043e-\u0432\u0440\u0435\u043c\u0435\u043d\u0438-\u0432-\u0444\u0443\u0442\u0435\u0440\u0435-\u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b",children:"6. \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0438 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u043e\u0433\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0432 \u0444\u0443\u0442\u0435\u0440\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b"}),"\n",(0,s.jsxs)(n.p,{children:["\u041e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u043c \u0444\u0430\u0439\u043b ",(0,s.jsx)(n.em,{children:"apps/client/src/app/app.component.ts"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { AsyncPipe } from '@angular/common';\nimport { ChangeDetectionStrategy, Component, OnInit } from '@angular/core';\nimport { Router, RouterModule } from '@angular/router';\nimport { User } from '@authorizerdev/authorizer-js';\nimport { AppRestService, TimeRestService } from '@nestjs-mod-fullstack/app-angular-rest-sdk';\nimport { AuthService } from '@nestjs-mod-fullstack/auth-angular';\nimport { webSocket } from '@nestjs-mod-fullstack/common-angular';\nimport { UntilDestroy, untilDestroyed } from '@ngneat/until-destroy';\nimport { NzLayoutModule } from 'ng-zorro-antd/layout';\n\nimport { NzMenuModule } from 'ng-zorro-antd/menu';\nimport { NzTypographyModule } from 'ng-zorro-antd/typography';\nimport { BehaviorSubject, map, merge, Observable, tap } from 'rxjs';\n\n@UntilDestroy()\n@Component({\n  standalone: true,\n  imports: [RouterModule, NzMenuModule, NzLayoutModule, NzTypographyModule, AsyncPipe],\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class AppComponent implements OnInit {\n  title = 'client';\n  serverMessage$ = new BehaviorSubject('');\n  serverTime$ = new BehaviorSubject('');\n  authUser$: Observable<User | undefined>;\n\n  constructor(private readonly timeRestService: TimeRestService, private readonly appRestService: AppRestService, private readonly authService: AuthService, private readonly router: Router) {\n    this.authUser$ = this.authService.profile$.asObservable();\n  }\n\n  ngOnInit() {\n    this.appRestService\n      .appControllerGetData()\n      .pipe(\n        tap((result) => this.serverMessage$.next(result.message)),\n        untilDestroyed(this)\n      )\n      .subscribe();\n\n    merge(\n      this.timeRestService.timeControllerTime(),\n      webSocket<string>({\n        address: this.timeRestService.configuration.basePath + '/ws/time',\n        eventName: 'ChangeTimeStream',\n      }).pipe(map((result) => result.data))\n    )\n      .pipe(\n        tap((result) => this.serverTime$.next(result as string)),\n        untilDestroyed(this)\n      )\n      .subscribe();\n  }\n\n  signOut() {\n    this.authService\n      .signOut()\n      .pipe(\n        tap(() => this.router.navigate(['/home'])),\n        untilDestroyed(this)\n      )\n      .subscribe();\n  }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u041e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u043c \u0444\u0430\u0439\u043b ",(0,s.jsx)(n.em,{children:"apps/client/src/app/app.component.html"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<nz-layout class="layout_\n  <nz-header>\n    <div class="logo flex items-center justify-center_{{ title }}</div>\n    <ul nz-menu nzTheme="dark" nzMode="horizontal_\n      <li nz-menu-item routerLink="/home_Home</li>\n      <li nz-menu-item routerLink="/demo_Demo</li>\n      @if (authUser$|async; as authUser) {\n      <li nz-menu-item routerLink="/webhook_Webhook</li>\n      <li nz-submenu [nzTitle]="\'You are logged in as \' + authUser.email" [style]="{ float: \'right\' }_\n        <ul>\n          <li nz-menu-item routerLink="/profile_Profile</li>\n          <li nz-menu-item (click)="signOut()_Sign-out</li>\n        </ul>\n      </li>\n      } @else {\n      <li nz-menu-item routerLink="/sign-up" [style]="{ float: \'right\' }_Sign-up</li>\n      <li nz-menu-item routerLink="/sign-in" [style]="{ float: \'right\' }_Sign-in</li>\n      }\n    </ul>\n  </nz-header>\n  <nz-content>\n    <router-outlet></router-outlet>\n  </nz-content>\n  <nz-footer class="flex justify-between_\n    <div id="serverMessage_{{ serverMessage$ | async }}</div>\n    <div id="serverTime_{{ serverTime$ | async }}</div>\n  </nz-footer>\n</nz-layout>\n'})}),"\n",(0,s.jsx)(n.h3,{id:"7-\u0441\u043e\u0437\u0434\u0430\u0435\u043c-e2e-\u0442\u0435\u0441\u0442-\u0434\u043b\u044f-\u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438-\u0440\u0430\u0431\u043e\u0442\u044b-\u043b\u043e\u0433\u0438\u043a-\u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0445-\u0441-\u0432\u0440\u0435\u043c\u0435\u043d\u0435\u043c",children:"7. \u0421\u043e\u0437\u0434\u0430\u0435\u043c E2E-\u0442\u0435\u0441\u0442 \u0434\u043b\u044f \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0440\u0430\u0431\u043e\u0442\u044b \u043b\u043e\u0433\u0438\u043a \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0445 \u0441 \u0432\u0440\u0435\u043c\u0435\u043d\u0435\u043c"}),"\n",(0,s.jsxs)(n.p,{children:["\u0421\u043e\u0437\u0434\u0430\u0435\u043c \u0444\u0430\u0439\u043b ",(0,s.jsx)(n.em,{children:"apps/server-e2e/src/server/time.spec.ts"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { RestClientHelper } from '@nestjs-mod-fullstack/testing';\nimport { isDateString } from 'class-validator';\nimport { lastValueFrom, take, toArray } from 'rxjs';\n\ndescribe('Get server time from rest api and ws', () => {\n  jest.setTimeout(60000);\n\n  const correctStringDateLength = '2024-11-20T11:58:03.338Z'.length;\n  const restClientHelper = new RestClientHelper();\n  const timeApi = restClientHelper.getTimeApi();\n\n  it('should return time from rest api', async () => {\n    const time = await timeApi.timeControllerTime();\n\n    expect(time.status).toBe(200);\n    expect(time.data).toHaveLength(correctStringDateLength);\n    expect(isDateString(time.data)).toBeTruthy();\n  });\n\n  it('should return time from ws', async () => {\n    const last3ChangeTimeEvents = await lastValueFrom(\n      restClientHelper\n        .webSocket<string>({\n          path: '/ws/time',\n          eventName: 'ChangeTimeStream',\n        })\n        .pipe(take(3), toArray())\n    );\n\n    expect(last3ChangeTimeEvents).toHaveLength(3);\n    expect(last3ChangeTimeEvents[0].data).toHaveLength(correctStringDateLength);\n    expect(last3ChangeTimeEvents[1].data).toHaveLength(correctStringDateLength);\n    expect(last3ChangeTimeEvents[2].data).toHaveLength(correctStringDateLength);\n    expect(isDateString(last3ChangeTimeEvents[0].data)).toBeTruthy();\n    expect(isDateString(last3ChangeTimeEvents[1].data)).toBeTruthy();\n    expect(isDateString(last3ChangeTimeEvents[2].data)).toBeTruthy();\n  });\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"8-\u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u043c-\u0438\u043d\u0444\u0440\u0430\u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443-\u0441-\u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f\u043c\u0438-\u0432-\u0440\u0435\u0436\u0438\u043c\u0435-\u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0438-\u0438-\u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c-\u0440\u0430\u0431\u043e\u0442\u0443-\u0447\u0435\u0440\u0435\u0437-e2e-\u0442\u0435\u0441\u0442\u044b",children:"8. \u0417\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u043c \u0438\u043d\u0444\u0440\u0430\u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443 \u0441 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f\u043c\u0438 \u0432 \u0440\u0435\u0436\u0438\u043c\u0435 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u0440\u0430\u0431\u043e\u0442\u0443 \u0447\u0435\u0440\u0435\u0437 E2E-\u0442\u0435\u0441\u0442\u044b"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"\u041a\u043e\u043c\u0430\u043d\u0434\u044b"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm run pm2-full:dev:start\nnpm run pm2-full:dev:test:e2e\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u0437\u0430\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435",children:"\u0417\u0430\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435"}),"\n",(0,s.jsx)(n.p,{children:"\u0412 \u0442\u0435\u043a\u0443\u0449\u0435\u043c \u043f\u043e\u0441\u0442\u0435 \u0438 \u043f\u0440\u043e\u0435\u043a\u0442\u0435 \u043f\u0440\u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0435 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0447\u0435\u0440\u0435\u0437 \u0432\u0435\u0431-\u0441\u043e\u043a\u0435\u0442 \u043d\u0435 \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0438 \u0432\u0435\u0431-\u0441\u043e\u043a\u0435\u0442\u043d\u044b\u0439 \u0441\u0442\u0440\u0438\u043c \u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d \u043b\u044e\u0431\u044b\u043c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f\u043c, \u0432 \u0440\u0435\u0430\u043b\u044c\u043d\u043e\u043c \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0438 \u043e\u0431\u044b\u0447\u043d\u043e \u043c\u043d\u043e\u0433\u043e \u0432\u0435\u0431-\u0441\u043e\u043a\u0435\u0442 \u0441\u0442\u0440\u0438\u043c\u043e\u0432 \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u044e\u0442 \u0442\u043e\u043a\u0435\u043d \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438."}),"\n",(0,s.jsxs)(n.p,{children:["\u0412\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0432 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0445 \u043f\u043e\u0441\u0442\u0430\u0445 \u043f\u043e\u044f\u0432\u0438\u0442\u0441\u044f \u043f\u0440\u0438\u043c\u0435\u0440 \u0441 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0439, \u043d\u043e \u043f\u043e\u0434\u0433\u043e\u0442\u043e\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043a\u043e\u0434 \u0435\u0441\u0442\u044c \u0438 \u0432 \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0432\u0435\u0440\u0441\u0438\u0438 (\u0438\u0449\u0438\u0442\u0435: ",(0,s.jsx)(n.code,{children:"handleConnection"}),")."]}),"\n",(0,s.jsx)(n.h3,{id:"\u043f\u043b\u0430\u043d\u044b",children:"\u041f\u043b\u0430\u043d\u044b"}),"\n",(0,s.jsx)(n.p,{children:"\u0412 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u043c \u043f\u043e\u0441\u0442\u0435 \u044f \u0434\u043e\u0431\u0430\u0432\u043b\u044e \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0443 \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u044b\u0445 \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0445 \u043e\u0448\u0438\u0431\u043e\u043a \u043d\u0430 \u0444\u0440\u043e\u043d\u0442\u0435\u043d\u0434\u0435..."}),"\n",(0,s.jsx)(n.h3,{id:"\u0441\u0441\u044b\u043b\u043a\u0438",children:"\u0421\u0441\u044b\u043b\u043a\u0438"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://nestjs.com",children:"https://nestjs.com"})," - \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0439 \u0441\u0430\u0439\u0442 \u0444\u0440\u0435\u0439\u043c\u0432\u043e\u0440\u043a\u0430"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://nestjs-mod.com",children:"https://nestjs-mod.com"})," - \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0439 \u0441\u0430\u0439\u0442 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u0443\u0442\u0438\u043b\u0438\u0442"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://fullstack.nestjs-mod.com",children:"https://fullstack.nestjs-mod.com"})," - \u0441\u0430\u0439\u0442 \u0438\u0437 \u043f\u043e\u0441\u0442\u0430"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/nestjs-mod/nestjs-mod-fullstack",children:"https://github.com/nestjs-mod/nestjs-mod-fullstack"})," - \u043f\u0440\u043e\u0435\u043a\u0442 \u0438\u0437 \u043f\u043e\u0441\u0442\u0430"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/nestjs-mod/nestjs-mod-fullstack/compare/82e050c24a0d1a2111f499460896c6d00e0f5af4..a5efa43f571a7b48402275e1ee6a9b1e325d0eb0",children:"https://github.com/nestjs-mod/nestjs-mod-fullstack/compare/82e050c24a0d1a2111f499460896c6d00e0f5af4..a5efa43f571a7b48402275e1ee6a9b1e325d0eb0"})," - \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"#angular #websockets #nestjsmod #fullstack\n#2024-11-21"})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var s=t(6540);const r={},i=s.createContext(r);function o(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);