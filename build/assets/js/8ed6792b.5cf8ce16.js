"use strict";(self.webpackChunknestjs_mod_com=self.webpackChunknestjs_mod_com||[]).push([[9920],{3807:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>d});var o=t(4848),r=t(8453);const a={},i="Creating a user interface for the Webhook module using Angular",s={id:"en-posts/fullstack/2024-10-25",title:"Creating a user interface for the Webhook module using Angular",description:"In this article, I will describe the creation of a table displaying data and a form for filling it out, the interfaces are based on components from https//formly.dev, for styles used https://tailwindcss.com, there is no state machine.",source:"@site/docs/en-posts/fullstack/2024-10-25.md",sourceDirName:"en-posts/fullstack",slug:"/en-posts/fullstack/2024-10-25",permalink:"/docs/en-posts/fullstack/2024-10-25",draft:!1,unlisted:!1,editUrl:"https://github.com/nestjs-mod/nestjs-mod.com/blob/master/docs/en-posts/fullstack/2024-10-25.md",tags:[],version:"current",frontMatter:{},sidebar:"enPostsSidebar",previous:{title:"Creating a configurable Webhook module for a NestJS application",permalink:"/docs/en-posts/fullstack/2024-10-06"},next:{title:"Integration of external authorization server https://authorizer.dev into a full-stack application on NestJS and Angular",permalink:"/docs/en-posts/fullstack/2024-11-08"}},l={},d=[{value:"1. Creating an empty Angular library",id:"1-creating-an-empty-angular-library",level:3},{value:"2. Creating a common Angular library",id:"2-creating-a-common-angular-library",level:3},{value:"3. Installing additional libraries",id:"3-installing-additional-libraries",level:3},{value:"4. Since the user and company IDs are needed for the module to work, you need to create interfaces for transmitting this data",id:"4-since-the-user-and-company-ids-are-needed-for-the-module-to-work-you-need-to-create-interfaces-for-transmitting-this-data",level:3},{value:"5. We describe a component with a form and a service for creating and editing a Webhook entity",id:"5-we-describe-a-component-with-a-form-and-a-service-for-creating-and-editing-a-webhook-entity",level:3},{value:"5. We describe a component with a table for viewing, creating and editing Webhook entities",id:"5-we-describe-a-component-with-a-table-for-viewing-creating-and-editing-webhook-entities",level:3},{value:"6. Creating an E2E test to check the operation of the form and table",id:"6-creating-an-e2e-test-to-check-the-operation-of-the-form-and-table",level:3},{value:"Conclusion",id:"conclusion",level:3},{value:"Plans",id:"plans",level:3},{value:"Links",id:"links",level:3}];function c(e){const n={a:"a",code:"code",em:"em",h1:"h1",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"creating-a-user-interface-for-the-webhook-module-using-angular",children:"Creating a user interface for the Webhook module using Angular"}),"\n",(0,o.jsxs)(n.p,{children:["In this article, I will describe the creation of a table displaying data and a form for filling it out, the interfaces are based on components from ",(0,o.jsx)(n.a,{href:"https://ng.ant.design",children:"https://ng.ant.design"}),", forms are created and managed using ",(0,o.jsx)(n.a,{href:"https://formly.dev",children:"https://formly.dev"}),", for styles used ",(0,o.jsx)(n.a,{href:"https://tailwindcss.com",children:"https://tailwindcss.com"}),", there is no state machine."]}),"\n",(0,o.jsx)(n.h3,{id:"1-creating-an-empty-angular-library",children:"1. Creating an empty Angular library"}),"\n",(0,o.jsxs)(n.p,{children:["This library contains components for displaying and working with the data of the ",(0,o.jsx)(n.code,{children:"Webhook"})," entity."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.em,{children:"Commands"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Create Angular library\n./node_modules/.bin/nx g @nx/angular:library webhook-angular --buildable --publishable --directory=libs/feature/webhook-angular --simpleName=true --projectNameAndRootFormat=as-provided --strict=true --prefix= --standalone=true --selector= --changeDetection=OnPush --importPath=@nestjs-mod-fullstack/webhook-angular\n\n# Change file with test options\nrm -rf libs/feature/webhook-angular/src/test-setup.ts\ncp apps/client/src/test-setup.ts libs/feature/webhook-angular/src/test-setup.ts\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.em,{children:"Console output"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'$ ./node_modules/.bin/nx g @nx/angular:library webhook-angular --buildable --publishable --directory=libs/feature/webhook-angular --simpleName=true --projectNameAndRootFormat=as-provided --strict=true --prefix= --standalone=true --selector= --changeDetection=OnPush --importPath=@nestjs-mod-fullstack/webhook-angular\n\n NX  Generating @nx/angular:library\n\nCREATE libs/feature/webhook-angular/project.json\nCREATE libs/feature/webhook-angular/README.md\nCREATE libs/feature/webhook-angular/ng-package.json\nCREATE libs/feature/webhook-angular/package.json\nCREATE libs/feature/webhook-angular/tsconfig.json\nCREATE libs/feature/webhook-angular/tsconfig.lib.json\nCREATE libs/feature/webhook-angular/tsconfig.lib.prod.json\nCREATE libs/feature/webhook-angular/src/index.ts\nCREATE libs/feature/webhook-angular/jest.config.ts\nCREATE libs/feature/webhook-angular/src/test-setup.ts\nCREATE libs/feature/webhook-angular/tsconfig.spec.json\nCREATE libs/feature/webhook-angular/src/lib/webhook-angular/webhook-angular.component.css\nCREATE libs/feature/webhook-angular/src/lib/webhook-angular/webhook-angular.component.html\nCREATE libs/feature/webhook-angular/src/lib/webhook-angular/webhook-angular.component.spec.ts\nCREATE libs/feature/webhook-angular/src/lib/webhook-angular/webhook-angular.component.ts\nCREATE libs/feature/webhook-angular/.eslintrc.json\nUPDATE package.json\nUPDATE tsconfig.base.json\n\n> @nestjs-mod-fullstack/source@0.0.9 prepare\n> npx -y husky install\n\ninstall command is DEPRECATED\n\nremoved 2 packages, changed 5 packages, and audited 2726 packages in 13s\n\n332 packages are looking for funding\n  run `npm fund` for details\n\n33 vulnerabilities (4 low, 12 moderate, 17 high)\n\nTo address issues that do not require attention, run:\n  npm audit fix\n\nTo address all issues possible (including breaking changes), run:\n  npm audit fix --force\n\nSome issues need review, and may require choosing\na different dependency.\n\nRun `npm audit` for details.\n\n NX   \ud83d\udc40 View Details of webhook-angular\n\nRun "nx show project webhook-angular" to view details about this project.\n'})}),"\n",(0,o.jsx)(n.h3,{id:"2-creating-a-common-angular-library",children:"2. Creating a common Angular library"}),"\n",(0,o.jsxs)(n.p,{children:["The common library contains functions and classes that are used by other ",(0,o.jsx)(n.code,{children:"Angular"})," libraries."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.em,{children:"Commands"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Create Angular library\n./node_modules/.bin/nx g @nx/angular:library common-angular --buildable --publishable --directory=libs/common-angular --simpleName=true --projectNameAndRootFormat=as-provided --strict=true --prefix= --standalone=true --selector= --changeDetection=OnPush --importPath=@nestjs-mod-fullstack/common-angular\n\n# Change file with test options\nrm -rf libs/common-angular/src/test-setup.ts\ncp apps/client/src/test-setup.ts libs/common-angular/src/test-setup.ts\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.em,{children:"Console output"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'$ ./node_modules/.bin/nx g @nx/angular:library common-angular --buildable --publishable --directory=libs/common-angular --simpleName=true --projectNameAndRootFormat=as-provided --strict=true --prefix= --standalone=true --selector= --changeDetection=OnPush --importPath=@nestjs-mod-fullstack/common-angular\n\n NX  Generating @nx/angular:library\n\nCREATE libs/common-angular/project.json\nCREATE libs/common-angular/README.md\nCREATE libs/common-angular/ng-package.json\nCREATE libs/common-angular/package.json\nCREATE libs/common-angular/tsconfig.json\nCREATE libs/common-angular/tsconfig.lib.json\nCREATE libs/common-angular/tsconfig.lib.prod.json\nCREATE libs/common-angular/src/index.ts\nCREATE libs/common-angular/jest.config.ts\nCREATE libs/common-angular/src/test-setup.ts\nCREATE libs/common-angular/tsconfig.spec.json\nCREATE libs/common-angular/src/lib/common-angular/common-angular.component.css\nCREATE libs/common-angular/src/lib/common-angular/common-angular.component.html\nCREATE libs/common-angular/src/lib/common-angular/common-angular.component.spec.ts\nCREATE libs/common-angular/src/lib/common-angular/common-angular.component.ts\nCREATE libs/common-angular/.eslintrc.json\nUPDATE tsconfig.base.json\n\n NX   \ud83d\udc40 View Details of common-angular\n\nRun "nx show project common-angular" to view details about this project.\n'})}),"\n",(0,o.jsx)(n.h3,{id:"3-installing-additional-libraries",children:"3. Installing additional libraries"}),"\n",(0,o.jsxs)(n.p,{children:["We install the library of visual components ",(0,o.jsx)(n.code,{children:"ng-zorro-antd"}),", the library for working with forms ",(0,o.jsx)(n.code,{children:"@ngx-formly/core"})," and ",(0,o.jsx)(n.code,{children:"@ngx-formly/ng-zorro-antd"}),", the utility for auto-unsubscribing ",(0,o.jsx)(n.code,{children:"@ngneat/until-destroy"})," and the collection of utilities ",(0,o.jsx)(n.code,{children:"Lodash"}),"."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.em,{children:"Commands"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"npm install --save ng-zorro-antd @ngx-formly/core @ngx-formly/ng-zorro-antd @ngneat/until-destroy lodash\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.em,{children:"Console output"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"$ npm install --save ng-zorro-antd @ngx-formly/core @ngx-formly/ng-zorro-antd @ngneat/until-destroy\n\nadded 8 packages, removed 2 packages, and audited 2794 packages in 25s\n\n343 packages are looking for funding\n  run `npm fund` for details\n\n38 vulnerabilities (8 low, 12 moderate, 18 high)\n\nTo address issues that do not require attention, run:\n  npm audit fix\n\nTo address all issues (including breaking changes), run:\n  npm audit fix --force\n\nRun `npm audit` for details.\n"})}),"\n",(0,o.jsx)(n.h3,{id:"4-since-the-user-and-company-ids-are-needed-for-the-module-to-work-you-need-to-create-interfaces-for-transmitting-this-data",children:"4. Since the user and company IDs are needed for the module to work, you need to create interfaces for transmitting this data"}),"\n",(0,o.jsxs)(n.p,{children:["Creating an authorization form and service in the ",(0,o.jsx)(n.code,{children:"Webhook"})," module."]}),"\n",(0,o.jsxs)(n.p,{children:["The service has methods for obtaining a user profile based on the passed ",(0,o.jsx)(n.code,{children:"xExternalUserId"})," and ",(0,o.jsx)(n.code,{children:"xExternalTenantId"}),", as well as storing their values and user profile data."]}),"\n",(0,o.jsxs)(n.p,{children:["The administrator ID is passed from the environment variables ",(0,o.jsx)(n.code,{children:"CI/CD"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["To protect the pages, we will create a special ",(0,o.jsx)(n.code,{children:"Guard"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["Creating a service ",(0,o.jsx)(n.em,{children:"libs/feature/webhook-angular/src/lib/services/webhook-auth.service.ts"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Injectable } from '@angular/core';\nimport { WebhookErrorInterface, WebhookRestService, WebhookUserObjectInterface } from '@nestjs-mod-fullstack/app-angular-rest-sdk';\nimport { UntilDestroy, untilDestroyed } from '@ngneat/until-destroy';\nimport { BehaviorSubject, catchError, of, tap, throwError } from 'rxjs';\n\nexport type WebhookAuthCredentials = {\n  xExternalUserId?: string;\n  xExternalTenantId?: string;\n};\n\n@UntilDestroy()\n@Injectable({ providedIn: 'root' })\nexport class WebhookAuthService {\n  private webhookAuthCredentials$ = new BehaviorSubject<WebhookAuthCredentials>({});\n  private webhookUser$ = new BehaviorSubject<WebhookUserObjectInterface | null>(null);\n\n  constructor(private readonly webhookRestService: WebhookRestService) {}\n\n  getWebhookAuthCredentials() {\n    return this.webhookAuthCredentials$.value;\n  }\n\n  getWebhookUser() {\n    return this.webhookUser$.value;\n  }\n\n  setWebhookAuthCredentials(webhookAuthCredentials: WebhookAuthCredentials) {\n    this.webhookAuthCredentials$.next(webhookAuthCredentials);\n    this.loadWebhookUser().pipe(untilDestroyed(this)).subscribe();\n  }\n\n  loadWebhookUser() {\n    return this.webhookRestService.webhookControllerProfile(this.getWebhookAuthCredentials().xExternalUserId, this.getWebhookAuthCredentials().xExternalTenantId).pipe(\n      tap((profile) => this.webhookUser$.next(profile)),\n      catchError((err: { error?: WebhookErrorInterface }) => {\n        if (err.error?.code === 'WEBHOOK-002') {\n          return of(null);\n        }\n        return throwError(() => err);\n      })\n    );\n  }\n\n  webhookAuthCredentialsUpdates() {\n    return this.webhookAuthCredentials$.asObservable();\n  }\n\n  webhookUserUpdates() {\n    return this.webhookUser$.asObservable();\n  }\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The pseudo authorization form has two fields ",(0,o.jsx)(n.code,{children:"xExternalUserId"})," and ",(0,o.jsx)(n.code,{children:"xExternalTenantId"}),", the form is built and validated through the library ",(0,o.jsx)(n.a,{href:"https://formly.dev",children:"https://formly.dev"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"In addition to the login button, there are also two more buttons on the form:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Fill in the user data - substitutes the ",(0,o.jsx)(n.code,{children:"xExternalUserId"})," and ",(0,o.jsx)(n.code,{children:"xExternalTenantId"})," with the hidden random ",(0,o.jsx)(n.code,{children:"uuid"})," identifiers;"]}),"\n",(0,o.jsxs)(n.li,{children:["Fill in the administrator data - inserts the user ID with the role ",(0,o.jsx)(n.code,{children:"Admin"})," into the ",(0,o.jsx)(n.code,{children:"xExternalUserId"}),", the backend creates this user at startup, and the ID is inserted into the frontend when it is assembled into ",(0,o.jsx)(n.code,{children:"CI\\CD"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Creating a file ",(0,o.jsx)(n.em,{children:"libs/feature/webhook-angular/src/lib/forms/webhook-auth-form/webhook-auth-form.component.ts"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { AsyncPipe, NgIf } from '@angular/common';\nimport { ChangeDetectionStrategy, Component, EventEmitter, Inject, Input, OnInit, Optional, Output } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule, UntypedFormGroup } from '@angular/forms';\nimport { FormlyFieldConfig, FormlyModule } from '@ngx-formly/core';\nimport { NzButtonModule } from 'ng-zorro-antd/button';\nimport { NzFormModule } from 'ng-zorro-antd/form';\nimport { NzInputModule } from 'ng-zorro-antd/input';\nimport { NzMessageService } from 'ng-zorro-antd/message';\nimport { NZ_MODAL_DATA } from 'ng-zorro-antd/modal';\nimport { BehaviorSubject } from 'rxjs';\nimport { WebhookAuthCredentials, WebhookAuthService } from '../../services/webhook-auth.service';\nimport { WEBHOOK_CONFIGURATION_TOKEN, WebhookConfiguration } from '../../services/webhook.configuration';\n\n@Component({\n  standalone: true,\n  imports: [FormlyModule, NzFormModule, NzInputModule, NzButtonModule, FormsModule, ReactiveFormsModule, AsyncPipe, NgIf],\n  selector: 'webhook-auth-form',\n  templateUrl: './webhook-auth-form.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class WebhookAuthFormComponent implements OnInit {\n  @Input()\n  hideButtons?: boolean;\n\n  @Output()\n  afterSignIn = new EventEmitter<WebhookAuthCredentials>();\n\n  form = new UntypedFormGroup({});\n  formlyModel$ = new BehaviorSubject<object | null>(null);\n  formlyFields$ = new BehaviorSubject<FormlyFieldConfig[] | null>(null);\n\n  constructor(\n    @Optional()\n    @Inject(NZ_MODAL_DATA)\n    private readonly nzModalData: WebhookAuthFormComponent,\n    @Inject(WEBHOOK_CONFIGURATION_TOKEN)\n    private readonly webhookConfiguration: WebhookConfiguration,\n    private readonly webhookAuthService: WebhookAuthService,\n    private readonly nzMessageService: NzMessageService\n  ) {}\n\n  ngOnInit(): void {\n    Object.assign(this, this.nzModalData);\n    this.setFieldsAndModel(this.webhookAuthService.getWebhookAuthCredentials());\n  }\n\n  setFieldsAndModel(\n    data: Partial<WebhookAuthCredentials> = {},\n    options: { xExternalTenantIdIsRequired: boolean } = {\n      xExternalTenantIdIsRequired: true,\n    }\n  ) {\n    this.formlyFields$.next([\n      {\n        key: 'xExternalUserId',\n        type: 'input',\n        validation: {\n          show: true,\n        },\n        props: {\n          label: `webhook.form.xExternalUserId`,\n          placeholder: 'xExternalUserId',\n          required: true,\n        },\n      },\n      {\n        key: 'xExternalTenantId',\n        type: 'input',\n        validation: {\n          show: true,\n        },\n        props: {\n          label: `webhook.form.xExternalTenantId`,\n          placeholder: 'xExternalTenantId',\n          required: options.xExternalTenantIdIsRequired,\n        },\n      },\n    ]);\n    this.formlyModel$.next(this.toModel(data));\n  }\n\n  submitForm(): void {\n    if (this.form.valid) {\n      const value = this.toJson(this.form.value);\n      this.afterSignIn.next(value);\n      this.webhookAuthService.setWebhookAuthCredentials(value);\n      this.nzMessageService.success('Success');\n    } else {\n      console.log(this.form.controls);\n      this.nzMessageService.warning('Validation errors');\n    }\n  }\n\n  fillUserCredentials() {\n    this.setFieldsAndModel({\n      xExternalTenantId: '2079150a-f133-405c-9e77-64d3ab8aff77',\n      xExternalUserId: '3072607c-8c59-4fc4-9a37-916825bc0f99',\n    });\n  }\n\n  fillAdminCredentials() {\n    this.setFieldsAndModel(\n      {\n        xExternalTenantId: '',\n        xExternalUserId: this.webhookConfiguration.webhookSuperAdminExternalUserId,\n      },\n      { xExternalTenantIdIsRequired: false }\n    );\n  }\n\n  private toModel(data: Partial<WebhookAuthCredentials>): object | null {\n    return {\n      xExternalUserId: data['xExternalUserId'],\n      xExternalTenantId: data['xExternalTenantId'],\n    };\n  }\n\n  private toJson(data: Partial<WebhookAuthCredentials>) {\n    return {\n      xExternalUserId: data['xExternalUserId'],\n      xExternalTenantId: data['xExternalTenantId'],\n    };\n  }\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Creating a file ",(0,o.jsx)(n.em,{children:"libs/feature/webhook-angular/src/lib/forms/webhook-auth-form/webhook-auth-form.component.html"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-html",children:'@if (formlyFields$ | async; as formlyFields) {\n<form nz-form [formGroup]="form" (ngSubmit)="submitForm()_\n  <formly-form [model]="formlyModel$ | async" [fields]="formlyFields" [form]="form_ </formly-form>\n  @if (!hideButtons) {\n  <nz-form-control>\n    <div class="flex justify-between_\n      <div>\n        <button nz-button type="button" (click)="fillUserCredentials()_Fill user credentials</button>\n        <button nz-button type="button" (click)="fillAdminCredentials()_Fill admin credentials</button>\n      </div>\n      <button nz-button nzType="primary" type="submit" [disabled]="!form.valid_Sign-in</button>\n    </div>\n  </nz-form-control>\n  }\n</form>\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"The administrator ID is passed through the configuration and environment variables."}),"\n",(0,o.jsxs)(n.p,{children:["Updating the file ",(0,o.jsx)(n.em,{children:"apps/client/src/environments/environment.prod.ts"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"export const serverUrl = '';\nexport const webhookSuperAdminExternalUserId = '___CLIENT_WEBHOOK_SUPER_ADMIN_EXTERNAL_USER_ID___';\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Updating the file ",(0,o.jsx)(n.em,{children:"apps/client/src/app/app.config.ts"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { provideHttpClient } from '@angular/common/http';\nimport { ApplicationConfig, ErrorHandler, importProvidersFrom, provideZoneChangeDetection } from '@angular/core';\nimport { provideClientHydration } from '@angular/platform-browser';\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\nimport { provideRouter } from '@angular/router';\nimport { RestClientApiModule, RestClientConfiguration } from '@nestjs-mod-fullstack/app-angular-rest-sdk';\nimport { WEBHOOK_CONFIGURATION_TOKEN, WebhookConfiguration } from '@nestjs-mod-fullstack/webhook-angular';\nimport { FormlyModule } from '@ngx-formly/core';\nimport { FormlyNgZorroAntdModule } from '@ngx-formly/ng-zorro-antd';\nimport { en_US, provideNzI18n } from 'ng-zorro-antd/i18n';\nimport { serverUrl, webhookSuperAdminExternalUserId } from '../environments/environment';\nimport { AppErrorHandler } from './app.error-handler';\nimport { appRoutes } from './app.routes';\n\nexport const appConfig: ApplicationConfig = {\n  providers: [\n    provideClientHydration(),\n    provideZoneChangeDetection({ eventCoalescing: true }),\n    provideRouter(appRoutes),\n    provideHttpClient(),\n    provideNzI18n(en_US),\n    {\n      provide: WEBHOOK_CONFIGURATION_TOKEN,\n      useValue: new WebhookConfiguration({ webhookSuperAdminExternalUserId }), // <-- update\n    },\n    importProvidersFrom(\n      BrowserAnimationsModule,\n      RestClientApiModule.forRoot(\n        () =>\n          new RestClientConfiguration({\n            basePath: serverUrl,\n          })\n      ),\n      FormlyModule.forRoot(),\n      FormlyNgZorroAntdModule\n    ),\n    { provide: ErrorHandler, useClass: AppErrorHandler },\n  ],\n};\n"})}),"\n",(0,o.jsx)(n.p,{children:"We create a page with the login form at the application level, since we do not need to reuse it."}),"\n",(0,o.jsxs)(n.p,{children:["Creating a file ",(0,o.jsx)(n.em,{children:"apps/client/src/app/pages/sign-in/sign-in.component.ts"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { ChangeDetectionStrategy, Component } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { WebhookAuthFormComponent } from '@nestjs-mod-fullstack/webhook-angular';\nimport { NzBreadCrumbModule } from 'ng-zorro-antd/breadcrumb';\n\n@Component({\n  standalone: true,\n  selector: 'app-sign-in',\n  templateUrl: './sign-in.component.html',\n  imports: [NzBreadCrumbModule, WebhookAuthFormComponent],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class SignInComponent {\n  constructor(private readonly router: Router) {}\n  onAfterSignIn() {\n    this.router.navigate(['/webhook']);\n  }\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Creating a file ",(0,o.jsx)(n.em,{children:"apps/client/src/app/pages/sign-in/sign-in.component.html"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-html",children:'<nz-breadcrumb>\n  <nz-breadcrumb-item>Sign-in</nz-breadcrumb-item>\n</nz-breadcrumb>\n<div class="inner-content_\n  <webhook-auth-form (afterSignIn)="onAfterSignIn()_</webhook-auth-form>\n</div>\n'})}),"\n",(0,o.jsxs)(n.p,{children:["The authorization page should be available only when the user has not entered the authorization data, for this we will write ",(0,o.jsx)(n.code,{children:"Guard"})," and close our pages with it."]}),"\n",(0,o.jsxs)(n.p,{children:["Creating a file ",(0,o.jsx)(n.em,{children:"libs/feature/webhook-angular/src/lib/services/webhook-guard.service.ts"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Injectable } from '@angular/core';\nimport { ActivatedRouteSnapshot, CanActivate } from '@angular/router';\nimport { WebhookRoleInterface } from '@nestjs-mod-fullstack/app-angular-rest-sdk';\nimport { map, of } from 'rxjs';\nimport { WebhookAuthService } from './webhook-auth.service';\n\nexport const WEBHOOK_GUARD_DATA_ROUTE_KEY = 'webhookGuardData';\n\nexport class WebhookGuardData {\n  roles?: WebhookRoleInterface[];\n\n  constructor(options?: WebhookGuardData) {\n    Object.assign(this, options);\n  }\n}\n\n@Injectable({ providedIn: 'root' })\nexport class WebhookGuardService implements CanActivate {\n  constructor(private readonly webhookAuthService: WebhookAuthService) {}\n  canActivate(route: ActivatedRouteSnapshot) {\n    if (route.data[WEBHOOK_GUARD_DATA_ROUTE_KEY] instanceof WebhookGuardData) {\n      const webhookGuardData = route.data[WEBHOOK_GUARD_DATA_ROUTE_KEY];\n      return this.webhookAuthService.loadWebhookUser().pipe(\n        map((webhookUser) => {\n          return Boolean((webhookGuardData.roles && webhookUser && webhookGuardData.roles.length > 0 && webhookGuardData.roles.includes(webhookUser.userRole)) || ((webhookGuardData.roles || []).length === 0 && !webhookUser?.userRole));\n        })\n      );\n    }\n    return of(true);\n  }\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Updating the file ",(0,o.jsx)(n.em,{children:"apps/client/src/app/app.routes.ts"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Route } from '@angular/router';\nimport { WEBHOOK_GUARD_DATA_ROUTE_KEY, WebhookGuardData, WebhookGuardService } from '@nestjs-mod-fullstack/webhook-angular';\nimport { HomeComponent } from './pages/home/home.component';\nimport { SignInComponent } from './pages/sign-in/sign-in.component';\nimport { WebhookComponent } from './pages/webhook/webhook.component';\nimport { DemoComponent } from './pages/demo/demo.component';\n\nexport const appRoutes: Route[] = [\n  { path: '', redirectTo: '/home', pathMatch: 'full' },\n  { path: 'home', component: HomeComponent },\n  { path: 'demo', component: DemoComponent },\n  {\n    path: 'webhook',\n    component: WebhookComponent,\n    canActivate: [WebhookGuardService],\n    data: {\n      [WEBHOOK_GUARD_DATA_ROUTE_KEY]: new WebhookGuardData({\n        roles: ['Admin', 'User'],\n      }),\n    },\n  },\n  {\n    path: 'sign-in',\n    component: SignInComponent,\n    canActivate: [WebhookGuardService],\n    data: {\n      [WEBHOOK_GUARD_DATA_ROUTE_KEY]: new WebhookGuardData({ roles: [] }),\n    },\n  },\n];\n"})}),"\n",(0,o.jsx)(n.h3,{id:"5-we-describe-a-component-with-a-form-and-a-service-for-creating-and-editing-a-webhook-entity",children:"5. We describe a component with a form and a service for creating and editing a Webhook entity"}),"\n",(0,o.jsxs)(n.p,{children:["Since the method for working with the ",(0,o.jsx)(n.code,{children:"Webhook"})," entity requires authorization data, we connect the ",(0,o.jsx)(n.code,{children:"WebhookAuthService"})," to the service for working with the backend of the ",(0,o.jsx)(n.code,{children:"Webhook"})," entity."]}),"\n",(0,o.jsxs)(n.p,{children:["Creating a service ",(0,o.jsx)(n.em,{children:"libs/feature/webhook-angular/src/lib/services/webhook.service.ts"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Injectable } from '@angular/core';\nimport { CreateWebhookArgsInterface, UpdateWebhookArgsInterface, WebhookRestService } from '@nestjs-mod-fullstack/app-angular-rest-sdk';\nimport { RequestMeta } from '@nestjs-mod-fullstack/common-angular';\nimport { WebhookAuthService } from './webhook-auth.service';\n\n@Injectable({ providedIn: 'root' })\nexport class WebhookService {\n  constructor(private readonly webhookAuthService: WebhookAuthService, private readonly webhookRestService: WebhookRestService) {}\n\n  findOne(id: string) {\n    return this.webhookRestService.webhookControllerFindOne(id, this.webhookAuthService.getWebhookAuthCredentials().xExternalUserId, this.webhookAuthService.getWebhookAuthCredentials().xExternalTenantId);\n  }\n\n  findMany({ filters, meta }: { filters: Record<string, string>; meta?: RequestMeta }) {\n    return this.webhookRestService.webhookControllerFindMany(\n      this.webhookAuthService.getWebhookAuthCredentials().xExternalUserId,\n      this.webhookAuthService.getWebhookAuthCredentials().xExternalTenantId,\n      meta?.curPage,\n      meta?.perPage,\n      filters['search'],\n      meta?.sort\n        ? Object.entries(meta?.sort)\n            .map(([key, value]) => `${key}:${value}`)\n            .join(',')\n        : undefined\n    );\n  }\n\n  updateOne(id: string, data: UpdateWebhookArgsInterface) {\n    return this.webhookRestService.webhookControllerUpdateOne(id, data, this.webhookAuthService.getWebhookAuthCredentials().xExternalUserId, this.webhookAuthService.getWebhookAuthCredentials().xExternalTenantId);\n  }\n\n  deleteOne(id: string) {\n    return this.webhookRestService.webhookControllerDeleteOne(id, this.webhookAuthService.getWebhookAuthCredentials().xExternalUserId, this.webhookAuthService.getWebhookAuthCredentials().xExternalTenantId);\n  }\n\n  createOne(data: CreateWebhookArgsInterface) {\n    return this.webhookRestService.webhookControllerCreateOne(data, this.webhookAuthService.getWebhookAuthCredentials().xExternalUserId, this.webhookAuthService.getWebhookAuthCredentials().xExternalTenantId);\n  }\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The purpose of this post is to create a simple example of ",(0,o.jsx)(n.code,{children:"CRUD"})," on ",(0,o.jsx)(n.code,{children:"Angular"}),", the form consists of standard types of controls ",(0,o.jsx)(n.code,{children:"(checkbox, input, select, textarea)"}),", and the logic for transforming data into ",(0,o.jsx)(n.code,{children:"formly"})," and back lies in the same component."]}),"\n",(0,o.jsxs)(n.p,{children:["In future articles, additional custom control types will be created for ",(0,o.jsx)(n.code,{children:"formly"})," with their own transformation logics."]}),"\n",(0,o.jsxs)(n.p,{children:["Creating a form class ",(0,o.jsx)(n.em,{children:"libs/feature/webhook-angular/src/lib/forms/webhook-form/webhook-form.component.ts"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { AsyncPipe, NgIf } from '@angular/common';\nimport { ChangeDetectionStrategy, Component, EventEmitter, Inject, Input, OnInit, Optional, Output } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule, UntypedFormGroup } from '@angular/forms';\nimport { WebhookEventInterface, WebhookObjectInterface } from '@nestjs-mod-fullstack/app-angular-rest-sdk';\nimport { safeParseJson } from '@nestjs-mod-fullstack/common-angular';\nimport { UntilDestroy, untilDestroyed } from '@ngneat/until-destroy';\nimport { FormlyFieldConfig, FormlyModule } from '@ngx-formly/core';\nimport { NzButtonModule } from 'ng-zorro-antd/button';\nimport { NzFormModule } from 'ng-zorro-antd/form';\nimport { NzInputModule } from 'ng-zorro-antd/input';\nimport { NzMessageService } from 'ng-zorro-antd/message';\nimport { NZ_MODAL_DATA } from 'ng-zorro-antd/modal';\nimport { BehaviorSubject, tap } from 'rxjs';\nimport { WebhookEventsService } from '../../services/webhook-events.service';\nimport { WebhookService } from '../../services/webhook.service';\n\n@UntilDestroy()\n@Component({\n  standalone: true,\n  imports: [FormlyModule, NzFormModule, NzInputModule, NzButtonModule, FormsModule, ReactiveFormsModule, AsyncPipe, NgIf],\n  selector: 'webhook-form',\n  templateUrl: './webhook-form.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class WebhookFormComponent implements OnInit {\n  @Input()\n  id?: string;\n\n  @Input()\n  hideButtons?: boolean;\n\n  @Output()\n  afterFind = new EventEmitter<WebhookObjectInterface>();\n\n  @Output()\n  afterCreate = new EventEmitter<WebhookObjectInterface>();\n\n  @Output()\n  afterUpdate = new EventEmitter<WebhookObjectInterface>();\n\n  form = new UntypedFormGroup({});\n  formlyModel$ = new BehaviorSubject<object | null>(null);\n  formlyFields$ = new BehaviorSubject<FormlyFieldConfig[] | null>(null);\n\n  events: WebhookEventInterface[] = [];\n\n  constructor(\n    @Optional()\n    @Inject(NZ_MODAL_DATA)\n    private readonly nzModalData: WebhookFormComponent,\n    private readonly webhookService: WebhookService,\n    private readonly webhookEventsService: WebhookEventsService,\n    private readonly nzMessageService: NzMessageService\n  ) {}\n\n  ngOnInit(): void {\n    Object.assign(this, this.nzModalData);\n    this.webhookEventsService\n      .findMany()\n      .pipe(\n        tap((events) => {\n          this.events = events;\n\n          if (this.id) {\n            this.findOne()\n              .pipe(\n                tap((result) => this.afterFind.next(result)),\n                untilDestroyed(this)\n              )\n              .subscribe();\n          } else {\n            this.setFieldsAndModel();\n          }\n        }),\n        untilDestroyed(this)\n      )\n      .subscribe();\n  }\n\n  setFieldsAndModel(data: Partial<WebhookObjectInterface> = {}) {\n    this.formlyFields$.next([\n      {\n        key: 'enabled',\n        type: 'checkbox',\n        validation: {\n          show: true,\n        },\n        props: {\n          label: `webhook.form.enabled`,\n          placeholder: 'enabled',\n          required: true,\n        },\n      },\n      {\n        key: 'endpoint',\n        type: 'input',\n        validation: {\n          show: true,\n        },\n        props: {\n          label: `webhook.form.endpoint`,\n          placeholder: 'endpoint',\n          required: true,\n        },\n      },\n      {\n        key: 'eventName',\n        type: 'select',\n        validation: {\n          show: true,\n        },\n        props: {\n          label: `webhook.form.eventName`,\n          placeholder: 'eventName',\n          required: true,\n          options: this.events.map((e) => ({\n            value: e.eventName,\n            label: e.description,\n          })),\n        },\n      },\n      {\n        key: 'headers',\n        type: 'textarea',\n        validation: {\n          show: true,\n        },\n        props: {\n          label: `webhook.form.headers`,\n          placeholder: 'headers',\n          required: true,\n        },\n      },\n      {\n        key: 'requestTimeout',\n        type: 'input',\n        validation: {\n          show: true,\n        },\n        props: {\n          label: `webhook.form.requestTimeout`,\n          placeholder: 'requestTimeout',\n          required: false,\n        },\n      },\n    ]);\n    this.formlyModel$.next(this.toModel(data));\n  }\n\n  submitForm(): void {\n    if (this.form.valid) {\n      if (this.id) {\n        this.updateOne()\n          .pipe(\n            tap((result) => {\n              this.nzMessageService.success('Success');\n              this.afterUpdate.next(result);\n            }),\n            untilDestroyed(this)\n          )\n          .subscribe();\n      } else {\n        this.createOne()\n          .pipe(\n            tap((result) => {\n              this.nzMessageService.success('Success');\n              this.afterCreate.next(result);\n            }),\n\n            untilDestroyed(this)\n          )\n          .subscribe();\n      }\n    } else {\n      console.log(this.form.controls);\n      this.nzMessageService.warning('Validation errors');\n    }\n  }\n\n  createOne() {\n    return this.webhookService.createOne(this.toJson(this.form.value));\n  }\n\n  updateOne() {\n    if (!this.id) {\n      throw new Error('id not set');\n    }\n    return this.webhookService.updateOne(this.id, this.toJson(this.form.value));\n  }\n\n  findOne() {\n    if (!this.id) {\n      throw new Error('id not set');\n    }\n    return this.webhookService.findOne(this.id).pipe(\n      tap((result) => {\n        this.setFieldsAndModel(result);\n      })\n    );\n  }\n\n  private toModel(data: Partial<WebhookObjectInterface>): object | null {\n    return {\n      enabled: (data['enabled'] as unknown as string) === 'true' || data['enabled'] === true,\n      endpoint: data['endpoint'],\n      eventName: data['eventName'],\n      headers: data['headers'] ? JSON.stringify(data['headers']) : '',\n      requestTimeout: data['requestTimeout'] && !isNaN(+data['requestTimeout']) ? data['requestTimeout'] : '',\n    };\n  }\n\n  private toJson(data: Partial<WebhookObjectInterface>) {\n    return {\n      enabled: data['enabled'] === true,\n      endpoint: data['endpoint'] || '',\n      eventName: data['eventName'] || '',\n      headers: data['headers'] ? safeParseJson(data['headers']) : null,\n      requestTimeout: data['requestTimeout'] && !isNaN(+data['requestTimeout']) ? +data['requestTimeout'] : undefined,\n    };\n  }\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The form markup has the ability to display it as an ",(0,o.jsx)(n.code,{children:"inline"})," on a page with embedded buttons, and it can also be displayed in a modal window that has its own markup for buttons."]}),"\n",(0,o.jsxs)(n.p,{children:["Creating the layout of the form ",(0,o.jsx)(n.em,{children:"libs/feature/webhook-angular/src/lib/forms/webhook-form/webhook-form.component.html"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-html",children:'@if (formlyFields$ | async; as formlyFields) {\n<form nz-form [formGroup]="form" (ngSubmit)="submitForm()_\n  <formly-form [model]="formlyModel$ | async" [fields]="formlyFields" [form]="form_ </formly-form>\n  @if (!hideButtons) {\n  <nz-form-control>\n    <button nzBlock nz-button nzType="primary" type="submit" [disabled]="!form.valid_{{ id ? \'Save\' : \'Create\' }}</button>\n  </nz-form-control>\n  }\n</form>\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"5-we-describe-a-component-with-a-table-for-viewing-creating-and-editing-webhook-entities",children:"5. We describe a component with a table for viewing, creating and editing Webhook entities"}),"\n",(0,o.jsx)(n.p,{children:"The table supports server-side pagination, sorting and searching in text fields."}),"\n",(0,o.jsx)(n.p,{children:"After creating/editing/deleting, the current page of the table is loaded."}),"\n",(0,o.jsx)(n.p,{children:"The creation and editing of records takes place in a modal window with a form."}),"\n",(0,o.jsx)(n.p,{children:"When deleting an entry, a modal window is displayed confirming the action."}),"\n",(0,o.jsxs)(n.p,{children:["Creating a table class ",(0,o.jsx)(n.em,{children:"libs/feature/webhook-angular/src/lib/grids/webhook-grid/webhook-grid.component.ts"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { CommonModule } from '@angular/common';\nimport { ChangeDetectionStrategy, Component, Input, OnInit, ViewContainerRef } from '@angular/core';\nimport { FormControl, FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { RouterModule } from '@angular/router';\nimport { WebhookObjectInterface } from '@nestjs-mod-fullstack/app-angular-rest-sdk';\nimport { UntilDestroy, untilDestroyed } from '@ngneat/until-destroy';\nimport isEqual from 'lodash/fp/isEqual';\nimport omit from 'lodash/fp/omit';\nimport { NzButtonModule } from 'ng-zorro-antd/button';\nimport { NzDividerModule } from 'ng-zorro-antd/divider';\nimport { NzGridModule } from 'ng-zorro-antd/grid';\nimport { NzIconModule } from 'ng-zorro-antd/icon';\nimport { NzInputModule } from 'ng-zorro-antd/input';\nimport { NzLayoutModule } from 'ng-zorro-antd/layout';\nimport { NzMenuModule } from 'ng-zorro-antd/menu';\nimport { NzModalModule, NzModalService } from 'ng-zorro-antd/modal';\nimport { NzTableModule, NzTableQueryParams } from 'ng-zorro-antd/table';\nimport { BehaviorSubject, debounceTime, distinctUntilChanged, tap } from 'rxjs';\n\nimport { WebhookScalarFieldEnumInterface } from '@nestjs-mod-fullstack/app-angular-rest-sdk';\nimport { getQueryMeta, getQueryMetaByParams, NzTableSortOrderDetectorPipe, RequestMeta } from '@nestjs-mod-fullstack/common-angular';\nimport { WebhookFormComponent } from '../../forms/webhook-form/webhook-form.component';\nimport { WebhookService } from '../../services/webhook.service';\n\n@UntilDestroy()\n@Component({\n  standalone: true,\n  imports: [NzGridModule, NzMenuModule, NzLayoutModule, NzTableModule, NzDividerModule, CommonModule, RouterModule, NzModalModule, NzButtonModule, NzInputModule, NzIconModule, FormsModule, ReactiveFormsModule, NzTableSortOrderDetectorPipe],\n  selector: 'webhook-grid',\n  templateUrl: './webhook-grid.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class WebhookGridComponent implements OnInit {\n  items$ = new BehaviorSubject<WebhookObjectInterface[]>([]);\n  meta$ = new BehaviorSubject<RequestMeta | undefined>(undefined);\n  searchField = new FormControl('');\n  selectedIds$ = new BehaviorSubject<string[]>([]);\n  columns = ['id', 'enabled', 'endpoint', 'eventName', 'headers', 'requestTimeout'];\n\n  private filters?: Record<string, string>;\n\n  constructor(private readonly webhookService: WebhookService, private readonly nzModalService: NzModalService, private readonly viewContainerRef: ViewContainerRef) {\n    this.searchField.valueChanges\n      .pipe(\n        debounceTime(700),\n        distinctUntilChanged(),\n        tap(() => this.loadMany({ force: true })),\n        untilDestroyed(this)\n      )\n      .subscribe();\n  }\n\n  ngOnInit(): void {\n    this.loadMany();\n  }\n\n  loadMany(args?: { filters?: Record<string, string>; meta?: RequestMeta; queryParams?: NzTableQueryParams; force?: boolean }) {\n    let meta = { meta: {}, ...(args || {}) }.meta as RequestMeta;\n    const { queryParams, filters } = { filters: {}, ...(args || {}) };\n\n    if (!args?.force && queryParams) {\n      meta = getQueryMetaByParams(queryParams);\n    }\n\n    meta = getQueryMeta(meta, this.meta$.value);\n\n    if (!filters['search'] && this.searchField.value) {\n      filters['search'] = this.searchField.value;\n    }\n\n    if (\n      !args?.force &&\n      isEqual(\n        omit(['totalResults'], { ...meta, ...filters }),\n        omit(['totalResults'], {\n          ...this.meta$.value,\n          ...this.filters,\n        })\n      )\n    ) {\n      return;\n    }\n\n    this.webhookService\n      .findMany({ filters, meta })\n      .pipe(\n        tap((result) => {\n          this.items$.next(\n            result.webhooks.map((item) => ({\n              ...item,\n              // eslint-disable-next-line @typescript-eslint/no-explicit-any\n              headers: JSON.stringify(item.headers) as any,\n            }))\n          );\n          this.meta$.next({ ...result.meta, ...meta });\n          this.filters = filters;\n          this.selectedIds$.next([]);\n        }),\n        untilDestroyed(this)\n      )\n      .subscribe();\n  }\n\n  showCreateOrUpdateModal(id?: string): void {\n    const modal = this.nzModalService.create<WebhookFormComponent, WebhookFormComponent>({\n      nzTitle: id ? 'Update webhook' : 'Create webhook',\n      nzContent: WebhookFormComponent,\n      nzViewContainerRef: this.viewContainerRef,\n      nzData: {\n        hideButtons: true,\n        id,\n      } as WebhookFormComponent,\n      nzFooter: [\n        {\n          label: 'Cancel',\n          onClick: () => {\n            modal.close();\n          },\n        },\n        {\n          label: id ? 'Save' : 'Create',\n          onClick: () => {\n            modal.componentInstance?.afterUpdate\n              .pipe(\n                tap(() => {\n                  modal.close();\n                  this.loadMany({ force: true });\n                }),\n                untilDestroyed(modal.componentInstance)\n              )\n              .subscribe();\n\n            modal.componentInstance?.afterCreate\n              .pipe(\n                tap(() => {\n                  modal.close();\n                  this.loadMany({ force: true });\n                }),\n                untilDestroyed(modal.componentInstance)\n              )\n              .subscribe();\n\n            modal.componentInstance?.submitForm();\n          },\n          type: 'primary',\n        },\n      ],\n    });\n  }\n\n  showDeleteModal(id: string) {\n    this.nzModalService.confirm({\n      nzTitle: `Delete webhook #${id}`,\n      nzOkText: 'Yes',\n      nzCancelText: 'No',\n      nzOnOk: () => {\n        this.webhookService\n          .deleteOne(id)\n          .pipe(\n            tap(() => {\n              this.loadMany({ force: true });\n            }),\n            untilDestroyed(this)\n          )\n          .subscribe();\n      },\n    });\n  }\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Creating a table layout ",(0,o.jsx)(n.em,{children:"libs/feature/webhook-angular/src/lib/grids/webhook-grid/webhook-grid.component.html"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-html",children:'<div class="table-operations" nz-row nzJustify="space-between_\n  <div nz-col nzSpan="4_\n    <button nz-button nzType="primary" (click)="showCreateOrUpdateModal()_Create new</button>\n  </div>\n  <div nz-col nzSpan="4_\n    <nz-input-group nzSearch [nzAddOnAfter]="suffixIconButton_\n      <input type="text" [formControl]="searchField" nz-input placeholder="input search text" />\n    </nz-input-group>\n    <ng-template #suffixIconButton>\n      <button (click)="loadMany({ force: true })" nz-button nzType="primary" nzSearch>\n        <span nz-icon nzType="search_</span>\n      </button>\n    </ng-template>\n  </div>\n</div>\n@if ((meta$ | async); as meta){\n<nz-table\n  #basicTable\n  [nzBordered]="true"\n  [nzOuterBordered]="true"\n  nzShowPagination\n  nzShowSizeChanger\n  [nzFrontPagination]="false"\n  [nzPageSizeOptions]="[1, 5, 10, 20, 30, 40]"\n  [nzPageIndex]="meta.curPage"\n  [nzPageSize]="meta.perPage"\n  [nzTotal]="meta.totalResults || 0"\n  (nzQueryParams)="\n    loadMany({\n      queryParams: $event\n    })\n  "\n  [nzData]="(items$ | async) || []"\n>\n  <thead>\n    <tr>\n      @for (key of columns; track $index) {\n      <th [nzColumnKey]="key" [nzSortFn]="true" [nzSortOrder]="meta.sort[key] | nzTableSortOrderDetector_webhook.grid.{{ key }}</th>\n      }\n      <th>Action</th>\n    </tr>\n  </thead>\n  @if (selectedIds$ | async; as selectedIds) {\n  <tbody>\n    @for (data of basicTable.data; track $index) {\n    <tr (click)="selectedIds$.next(selectedIds[0] === data.id ? [] : [data.id])" [class.selected]="selectedIds[0] === data.id_\n      @for (key of columns; track $index) {\n      <td>{{ data[key] }}</td>\n      }\n      <td>\n        <a (click)="showCreateOrUpdateModal(data.id)_Edit</a>\n        <nz-divider nzType="vertical_</nz-divider>\n        <a (click)="showDeleteModal(data.id)_Delete</a>\n      </td>\n    </tr>\n    }\n  </tbody>\n  }\n</nz-table>\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"6-creating-an-e2e-test-to-check-the-operation-of-the-form-and-table",children:"6. Creating an E2E test to check the operation of the form and table"}),"\n",(0,o.jsx)(n.p,{children:"In the current test, we are adding additional options to record what is happening on video, videos help to quickly understand the errors that occur."}),"\n",(0,o.jsxs)(n.p,{children:["Creating a file ",(0,o.jsx)(n.em,{children:"apps/client-e2e/src/webhook-crud-as-user.spec.ts"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { getRandomExternalHeaders } from '@nestjs-mod-fullstack/testing';\nimport { expect, Page, test } from '@playwright/test';\nimport { join } from 'path';\nimport { setTimeout } from 'timers/promises';\n\ntest.describe('CRUD operations with Webhook as \"User\" role', () => {\n  const user1Headers = getRandomExternalHeaders();\n\n  test.describe.configure({ mode: 'serial' });\n\n  let page: Page;\n  let webhookId: string | null;\n\n  test.beforeAll(async ({ browser }) => {\n    page = await browser.newPage({\n      viewport: { width: 1920, height: 1080 },\n      recordVideo: {\n        dir: join(__dirname, 'video'),\n        size: { width: 1920, height: 1080 },\n      },\n    });\n  });\n\n  test.afterAll(async () => {\n    await page.close();\n  });\n\n  test('sign in as user', async () => {\n    await page.goto('/sign-in', {\n      timeout: 5000,\n    });\n\n    await page.locator('webhook-auth-form').locator('[placeholder=xExternalUserId]').click();\n    await page.keyboard.type(user1Headers['x-external-user-id'], {\n      delay: 50,\n    });\n    await expect(page.locator('webhook-auth-form').locator('[placeholder=xExternalUserId]')).toHaveValue(user1Headers['x-external-user-id']);\n\n    await page.locator('webhook-auth-form').locator('[placeholder=xExternalTenantId]').click();\n    await page.keyboard.type(user1Headers['x-external-tenant-id'], {\n      delay: 50,\n    });\n    await expect(page.locator('webhook-auth-form').locator('[placeholder=xExternalTenantId]')).toHaveValue(user1Headers['x-external-tenant-id']);\n\n    await expect(page.locator('webhook-auth-form').locator('button[type=submit]')).toHaveText('Sign-in');\n\n    await page.locator('webhook-auth-form').locator('button[type=submit]').click();\n  });\n\n  test('should create new webhook', async () => {\n    await page.locator('webhook-grid').locator('button').first().click();\n\n    await setTimeout(5000);\n\n    await page.locator('webhook-form').locator('[placeholder=eventName]').click();\n    await page.keyboard.press('Enter', { delay: 100 });\n    await expect(page.locator('webhook-form').locator('[placeholder=eventName]')).toContainText('create');\n\n    await page.locator('webhook-form').locator('[placeholder=endpoint]').click();\n    await page.keyboard.type('http://example.com', { delay: 50 });\n    await expect(page.locator('webhook-form').locator('[placeholder=endpoint]').first()).toHaveValue('http://example.com');\n\n    await page.locator('webhook-form').locator('[placeholder=headers]').click();\n    await page.keyboard.type(JSON.stringify(user1Headers), { delay: 50 });\n    await expect(page.locator('webhook-form').locator('[placeholder=headers]')).toHaveValue(JSON.stringify(user1Headers));\n\n    await page.locator('[nz-modal-footer]').locator('button').last().click();\n\n    await setTimeout(3000);\n\n    webhookId = await page.locator('webhook-grid').locator('td').nth(0).textContent();\n    await expect(page.locator('webhook-grid').locator('td').nth(1)).toContainText('false');\n    await expect(page.locator('webhook-grid').locator('td').nth(2)).toContainText('http://example.com');\n    await expect(page.locator('webhook-grid').locator('td').nth(3)).toContainText('app-demo.create');\n    await expect(page.locator('webhook-grid').locator('td').nth(4)).toContainText(JSON.stringify(user1Headers));\n    await expect(page.locator('webhook-grid').locator('td').nth(5)).toContainText('');\n  });\n\n  test('should update webhook endpoint', async () => {\n    await page.locator('webhook-grid').locator('td').last().locator('a').first().click();\n\n    await setTimeout(5000);\n\n    await expect(page.locator('webhook-form').locator('[placeholder=eventName]')).toContainText('create');\n\n    await expect(page.locator('webhook-form').locator('[placeholder=endpoint]').first()).toHaveValue('http://example.com');\n\n    await expect(page.locator('webhook-form').locator('[placeholder=headers]')).toHaveValue(JSON.stringify(user1Headers));\n\n    await page.locator('webhook-form').locator('[placeholder=endpoint]').click();\n    await page.keyboard.press('Control+a');\n    await page.keyboard.type('http://example.com/new', { delay: 100 });\n    await expect(page.locator('webhook-form').locator('[placeholder=endpoint]').first()).toHaveValue('http://example.com/new');\n\n    await page.locator('[nz-modal-footer]').locator('button').last().click();\n\n    await setTimeout(3000);\n\n    await expect(page.locator('webhook-grid').locator('td').nth(0)).toContainText(webhookId || 'empty');\n    await expect(page.locator('webhook-grid').locator('td').nth(1)).toContainText('false');\n    await expect(page.locator('webhook-grid').locator('td').nth(2)).toContainText('http://example.com/new');\n    await expect(page.locator('webhook-grid').locator('td').nth(3)).toContainText('app-demo.create');\n    await expect(page.locator('webhook-grid').locator('td').nth(4)).toContainText(JSON.stringify(user1Headers));\n    await expect(page.locator('webhook-grid').locator('td').nth(5)).toContainText('');\n  });\n\n  test('should delete updated webhook', async () => {\n    await page.locator('webhook-grid').locator('td').last().locator('a').last().click();\n\n    await setTimeout(5000);\n\n    await expect(page.locator('nz-modal-confirm-container').locator('.ant-modal-confirm-title')).toContainText(`Delete webhook #${webhookId}`);\n\n    await page.locator('nz-modal-confirm-container').locator('.ant-modal-body').locator('button').last().click();\n\n    await setTimeout(3000);\n\n    await expect(page.locator('webhook-grid').locator('nz-embed-empty')).toContainText(`No Data`);\n  });\n\n  test('sign out', async () => {\n    await expect(page.locator('nz-header').locator('[nz-submenu]')).toContainText(`You are logged in as User`);\n    await page.locator('nz-header').locator('[nz-submenu]').first().click();\n\n    await expect(page.locator('[nz-submenu-none-inline-child]').locator('[nz-menu-item]')).toContainText(`Sign-out`);\n\n    await page.locator('[nz-submenu-none-inline-child]').locator('[nz-menu-item]').first().click();\n\n    await setTimeout(3000);\n\n    await expect(page.locator('nz-header').locator('[nz-menu-item]').last()).toContainText(`Sign-in`);\n  });\n});\n"})}),"\n",(0,o.jsx)(n.h3,{id:"conclusion",children:"Conclusion"}),"\n",(0,o.jsx)(n.p,{children:"In the process of writing the code for this article, we also created: a table for displaying demo data and a form for creating demo data, as well as various utilities and helpers."}),"\n",(0,o.jsxs)(n.p,{children:["The typical development of the project includes a lot of ",(0,o.jsx)(n.code,{children:"boilerplate"})," code, solving problems with the ",(0,o.jsx)(n.code,{children:"boilerplate"})," code is not described in current articles, now various integrations are described, both external and internal."]}),"\n",(0,o.jsx)(n.h3,{id:"plans",children:"Plans"}),"\n",(0,o.jsxs)(n.p,{children:["In the next post, I will connect an external authorization server ",(0,o.jsx)(n.a,{href:"https://authorizer.dev",children:"https://authorizer.dev"})," to the project..."]}),"\n",(0,o.jsx)(n.h3,{id:"links",children:"Links"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"https://nestjs.com",children:"https://nestjs.com"})," - the official website of the framework"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"https://nestjs-mod.com",children:"https://nestjs-mod.com"})," - the official website of additional utilities"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"https://fullstack.nestjs-mod.com",children:"https://fullstack.nestjs-mod.com"})," - website from the post"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"https://github.com/nestjs-mod/nestjs-mod-fullstack",children:"https://github.com/nestjs-mod/nestjs-mod-fullstack"})," - the project from the post"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"https://github.com/nestjs-mod/nestjs-mod-fullstack/compare/ec8de9d574a6dbcef3c3339e876ce156a3974aae..414980df21e585cb798e1ff756300c4547e68a42",children:"https://github.com/nestjs-mod/nestjs-mod-fullstack/compare/ec8de9d574a6dbcef3c3339e876ce156a3974aae..414980df21e585cb798e1ff756300c4547e68a42"})," - current changes"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"https://github.com/nestjs-mod/nestjs-mod-fullstack/actions/runs/11523894922/artifacts/2105784301",children:"https://github.com/nestjs-mod/nestjs-mod-fullstack/actions/runs/11523894922/artifacts/2105784301"})," - video of the tests"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"#angular #webhook #nestjsmod #fullstack\n#2024-10-25"})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>s});var o=t(6540);const r={},a=o.createContext(r);function i(e){const n=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);