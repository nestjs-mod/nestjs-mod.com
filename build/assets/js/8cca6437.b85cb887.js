"use strict";(self.webpackChunknestjs_mod_com=self.webpackChunknestjs_mod_com||[]).push([[208],{1629:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>d,toc:()=>l});var t=r(4848),s=r(8453);const i={},o="@nestjs-mod/authorizer",d={id:"packages/core/authorizer/README",title:"@nestjs-mod/authorizer",description:"Universal javaScript SDK for Authorizer API (Wrapper for https://www.npmjs.com/package/@authorizerdev/authorizer-js)",source:"@site/docs/packages/core/authorizer/README.md",sourceDirName:"packages/core/authorizer",slug:"/packages/core/authorizer/",permalink:"/docs/packages/core/authorizer/",draft:!1,unlisted:!1,editUrl:"https://github.com/nestjs-mod/nestjs-mod.com/blob/master/docs/packages/core/authorizer/README.md",tags:[],version:"current",frontMatter:{},sidebar:"packagesSidebar",previous:{title:"Core",permalink:"/docs/category/core"},next:{title:"@nestjs-mod/cache-manager",permalink:"/docs/packages/core/cache-manager/"}},c={},l=[{value:"Installation",id:"installation",level:2},{value:"Modules",id:"modules",level:2},{value:"Modules descriptions",id:"modules-descriptions",level:2},{value:"AuthorizerModule",id:"authorizermodule",level:3},{value:"Use in NestJS-mod",id:"use-in-nestjs-mod",level:4},{value:"Shared providers",id:"shared-providers",level:4},{value:"Environments",id:"environments",level:4},{value:"Static configuration",id:"static-configuration",level:4},{value:"Links",id:"links",level:2},{value:"License",id:"license",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"nestjs-modauthorizer",children:"@nestjs-mod/authorizer"}),"\n",(0,t.jsxs)(n.p,{children:["Universal javaScript SDK for Authorizer API (Wrapper for ",(0,t.jsx)(n.a,{href:"https://www.npmjs.com/package/@authorizerdev/authorizer-js",children:"https://www.npmjs.com/package/@authorizerdev/authorizer-js"}),")"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://npmjs.org/package/@nestjs-mod/authorizer",children:(0,t.jsx)(n.img,{src:"https://badgen.net/npm/v/@nestjs-mod/authorizer",alt:"NPM version"})})," ",(0,t.jsx)(n.a,{href:"https://npmjs.org/package/@nestjs-mod/authorizer",children:(0,t.jsx)(n.img,{src:"https://badgen.net/npm/dm/@nestjs-mod/authorizer",alt:"monthly downloads"})})," ",(0,t.jsx)(n.a,{href:"https://t.me/nestjs_mod",children:(0,t.jsx)(n.img,{src:"https://img.shields.io/badge/group-telegram-blue.svg?maxAge=2592000",alt:"Telegram bot"})})]}),"\n",(0,t.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm i --save @authorizerdev/authorizer-js@2.0.0 @nestjs-mod/authorizer\n"})}),"\n",(0,t.jsx)(n.h2,{id:"modules",children:"Modules"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Link"}),(0,t.jsx)(n.th,{children:"Category"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"#authorizermodule",children:"AuthorizerModule"})}),(0,t.jsx)(n.td,{children:"core"}),(0,t.jsx)(n.td,{children:"Universal javaScript SDK for Authorizer API"})]})})]}),"\n",(0,t.jsx)(n.h2,{id:"modules-descriptions",children:"Modules descriptions"}),"\n",(0,t.jsx)(n.h3,{id:"authorizermodule",children:"AuthorizerModule"}),"\n",(0,t.jsx)(n.p,{children:"Universal javaScript SDK for Authorizer API"}),"\n",(0,t.jsx)(n.h4,{id:"use-in-nestjs-mod",children:"Use in NestJS-mod"}),"\n",(0,t.jsx)(n.p,{children:"An approximate description of how to connect, an extended description with an example application will be next time (todo: right now I have a lot of work and don\u2019t have time to arrange everything properly \ud83d\ude09)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"@Controller()\nexport class AppController {\n  constructor(private readonly authorizerService: AuthorizerService) {}\n\n  @Get('get-authorizer-client-id')\n  @AllowEmptyUser()\n  getAuthorizerClientID(@CurrentAuthorizerUser() authorizerUser: AuthorizerUser) {\n    console.log(authorizerUser);\n    return this.authorizerService.config.clientID;\n  }\n}\n\nconst { AppModule } = createNestModule({\n  moduleName: 'AppModule',\n  imports: [\n    AuthorizerModule.forFeature({\n      featureModuleName: 'AppModule',\n    }),\n  ],\n  controllers: [AppController],\n});\n\nbootstrapNestApplication({\n  globalConfigurationOptions: { debug: true },\n  globalEnvironmentsOptions: { debug: true },\n  modules: {\n    system: [\n      ProjectUtils.forRoot({\n        staticConfiguration: {\n          applicationPackageJsonFile: join(appFolder, PACKAGE_JSON_FILE),\n          packageJsonFile: join(rootFolder, PACKAGE_JSON_FILE),\n          envFile: join(rootFolder, '.env'),\n        },\n      }),\n      DefaultNestApplicationInitializer.forRoot({\n        staticConfiguration: {\n          bufferLogs: true,\n        },\n      }),\n      DefaultNestApplicationListener.forRoot({\n        staticConfiguration: {\n          // When running in infrastructure mode, the backend server does not start.\n          mode: isInfrastructureMode() ? 'silent' : 'listen',\n        },\n      }),\n    ],\n    core: [\n      AuthorizerModule.forRoot({\n        staticConfiguration: {\n          checkAccessValidator: async (\n            authorizerUser?: AuthorizerUser,\n            options?: CheckAccessOptions,\n            ctx?: ExecutionContext\n          ) => {\n            if (\n              typeof ctx?.getClass === 'function' &&\n              typeof ctx?.getHandler === 'function' &&\n              ctx?.getClass().name === 'TerminusHealthCheckController' &&\n              ctx?.getHandler().name === 'check'\n            ) {\n              return true;\n            }\n\n            return defaultAuthorizerCheckAccessValidator(authorizerUser, options);\n          },\n        },\n      }),\n    ],\n    feature: [AppModule.forRoot()],\n    infrastructure: [\n      InfrastructureMarkdownReportGenerator.forRoot({\n        staticConfiguration: {\n          markdownFile: join(appFolder, 'INFRASTRUCTURE.MD'),\n          skipEmptySettings: true,\n        },\n      }),\n      DockerCompose.forRoot({\n        configuration: {\n          dockerComposeFileVersion: '3',\n          dockerComposeFile: join(appFolder, DOCKER_COMPOSE_FILE),\n        },\n      }),\n      DockerComposePostgreSQL.forFeature({\n        featureModuleName: authorizerFeatureName,\n      }),\n      DockerComposeRedis.forRoot(),\n      DockerComposeAuthorizer.forRoot({\n        staticEnvironments: {\n          redisUrl: '%SERVER_AUTHORIZER_INTERNAL_REDIS_URL%',\n          databaseUrl: '%SERVER_AUTHORIZER_INTERNAL_DATABASE_URL%',\n        },\n        staticConfiguration: {\n          featureName: authorizerFeatureName,\n          organizationName: 'OrganizationName',\n          dependsOnServiceNames: {\n            'postgre-sql-migrations': 'service_completed_successfully',\n            redis: 'service_healthy',\n          },\n        },\n      }),\n    ],\n  },\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:"New environment variable"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"SERVER_AUTHORIZER_DATABASE_URL=postgres://Yk42KA4sOb:B7Ep2MwlRR6fAx0frXGWVTGP850qAxM6@server-postgre-sql:5432/authorizer?schema=public\nSERVER_AUTHORIZER_REDIS_URL=redis://:cgSOXCMczzNFkxAmDJAsoujJYpoMDuTT@server-redis:6379\nSERVER_AUTHORIZER_INTERNAL_DATABASE_URL=postgres://Yk42KA4sOb:B7Ep2MwlRR6fAx0frXGWVTGP850qAxM6@server-postgre-sql:5432/authorizer\nSERVER_AUTHORIZER_INTERNAL_REDIS_URL=redis://:cgSOXCMczzNFkxAmDJAsoujJYpoMDuTT@server-redis:6379\n"})}),"\n",(0,t.jsxs)(n.p,{children:["When launched in the infrastructure documentation generation mode, the module creates an ",(0,t.jsx)(n.code,{children:".env"})," file with a list of all required variables, as well as an example ",(0,t.jsx)(n.code,{children:"example.env"}),", where you can enter example variable values."]}),"\n",(0,t.jsx)(n.h4,{id:"shared-providers",children:"Shared providers"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"AuthorizerService"})}),"\n",(0,t.jsx)(n.h4,{id:"environments",children:"Environments"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Key"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Sources"}),(0,t.jsx)(n.th,{children:"Constraints"}),(0,t.jsx)(n.th,{children:"Default"}),(0,t.jsx)(n.th,{children:"Value"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"clientId"})}),(0,t.jsx)(n.td,{children:"Client ID"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"obj['clientId']"}),", ",(0,t.jsx)(n.code,{children:"process.env['AUTHORIZER_CLIENT_ID']"})]}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"optional"})}),(0,t.jsx)(n.td,{children:"-"}),(0,t.jsx)(n.td,{children:"-"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"authorizerURL"})}),(0,t.jsx)(n.td,{children:"Authorizer URL"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"obj['authorizerURL']"}),", ",(0,t.jsx)(n.code,{children:"process.env['AUTHORIZER_AUTHORIZER_URL']"})]}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.strong,{children:"isNotEmpty"})," (authorizerURL should not be empty)"]}),(0,t.jsx)(n.td,{children:"-"}),(0,t.jsx)(n.td,{children:"-"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"redirectURL"})}),(0,t.jsx)(n.td,{children:"Redirect URL"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"obj['redirectURL']"}),", ",(0,t.jsx)(n.code,{children:"process.env['AUTHORIZER_REDIRECT_URL']"})]}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.strong,{children:"isNotEmpty"})," (redirectURL should not be empty)"]}),(0,t.jsx)(n.td,{children:"-"}),(0,t.jsx)(n.td,{children:"-"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"adminSecret"})}),(0,t.jsx)(n.td,{children:"Admin secret"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"obj['adminSecret']"}),", ",(0,t.jsx)(n.code,{children:"process.env['AUTHORIZER_ADMIN_SECRET']"})]}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"optional"})}),(0,t.jsx)(n.td,{children:"-"}),(0,t.jsx)(n.td,{children:"-"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"allowedExternalAppIds"})}),(0,t.jsx)(n.td,{children:"Allowed identifiers of external applications, if you have logged in previously and do not need to log in again in the authorization service, these identifiers must be private and can be used for testing."}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"obj['allowedExternalAppIds']"}),", ",(0,t.jsx)(n.code,{children:"process.env['AUTHORIZER_ALLOWED_EXTERNAL_APP_IDS']"})]}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"optional"})}),(0,t.jsx)(n.td,{children:"-"}),(0,t.jsx)(n.td,{children:"-"})]})]})]}),"\n",(0,t.jsx)(n.h4,{id:"static-configuration",children:"Static configuration"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Key"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Constraints"}),(0,t.jsx)(n.th,{children:"Default"}),(0,t.jsx)(n.th,{children:"Value"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"featureName"})}),(0,t.jsx)(n.td,{children:"Feature name for generate prefix to environments keys"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"optional"})}),(0,t.jsx)(n.td,{children:"-"}),(0,t.jsx)(n.td,{children:"-"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"extraHeaders"})}),(0,t.jsx)(n.td,{children:"Extra headers"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"optional"})}),(0,t.jsx)(n.td,{children:"-"}),(0,t.jsx)(n.td,{children:"-"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"getRequestFromContext"})}),(0,t.jsx)(n.td,{children:"Function for resolve request from execution context"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"optional"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"getRequestFromExecutionContext"})}),(0,t.jsx)(n.td,{children:"-"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"checkAccessValidator"})}),(0,t.jsx)(n.td,{children:"External function for validate permissions"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"optional"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"defaultAuthorizerCheckAccessValidator"})}),(0,t.jsx)(n.td,{children:"-"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"externalUserIdHeaderName"})}),(0,t.jsx)(n.td,{children:"A header for searching for an external user ID, if you have logged in previously and do not need to log in again in the authorization service, can be used during testing."}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"optional"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"x-external-user-id"})}),(0,t.jsx)(n.td,{children:"-"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"externalAppIdHeaderName"})}),(0,t.jsx)(n.td,{children:"Header for searching for external application identifiers, if you have logged in previously and do not need to log in again in the authorization service, these identifiers must be private and can be used for testing."}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"optional"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"x-external-app-id"})}),(0,t.jsx)(n.td,{children:"-"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"getAuthorizerUserFromExternalUserId"})}),(0,t.jsx)(n.td,{children:"Function for resolve authorizer user by externalUserId"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"optional"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"defaultAuthorizerGetAuthorizerUserFromExternalUserId"})}),(0,t.jsx)(n.td,{children:"-"})]})]})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"#modules",children:"Back to Top"})}),"\n",(0,t.jsx)(n.h2,{id:"links",children:"Links"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/nestjs-mod/nestjs-mod",children:"https://github.com/nestjs-mod/nestjs-mod"})," - A collection of utilities for unifying NestJS applications and modules"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/nestjs-mod/nestjs-mod-contrib",children:"https://github.com/nestjs-mod/nestjs-mod-contrib"})," - Contrib repository for the NestJS-mod"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/nestjs-mod/nestjs-mod-example",children:"https://github.com/nestjs-mod/nestjs-mod-example"})," - Example application built with ",(0,t.jsx)(n.a,{href:"https://github.com/nestjs-mod/nestjs-mod/tree/master/libs/schematics",children:"@nestjs-mod/schematics"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/nestjs-mod/nestjs-mod/blob/master/apps/example-basic/INFRASTRUCTURE.MD",children:"https://github.com/nestjs-mod/nestjs-mod/blob/master/apps/example-basic/INFRASTRUCTURE.MD"})," - A simple example of infrastructure documentation."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/nestjs-mod/nestjs-mod-contrib/blob/master/apps/example-prisma/INFRASTRUCTURE.MD",children:"https://github.com/nestjs-mod/nestjs-mod-contrib/blob/master/apps/example-prisma/INFRASTRUCTURE.MD"})," - An extended example of infrastructure documentation with a docker-compose file and a data base."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://dev.to/endykaufman/collection-of-nestjs-mod-utilities-for-unifying-applications-and-modules-on-nestjs-5256",children:"https://dev.to/endykaufman/collection-of-nestjs-mod-utilities-for-unifying-applications-and-modules-on-nestjs-5256"})," - Article about the project NestJS-mod"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"license",children:"License"}),"\n",(0,t.jsx)(n.p,{children:"MIT"})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>d});var t=r(6540);const s={},i=t.createContext(s);function o(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);