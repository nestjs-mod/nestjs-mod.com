"use strict";(self.webpackChunknestjs_mod_com=self.webpackChunknestjs_mod_com||[]).push([[6093],{1474:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>m,frontMatter:()=>a,metadata:()=>o,toc:()=>d});var t=s(4848),r=s(8453);const a={},i="An example of a simple update of NestJS-mod libraries",o={id:"en-posts/fullstack/2024-08-14-updating-NestJS-mod-libraries",title:"An example of a simple update of NestJS-mod libraries",description:"When writing the last post, I found small errors and urgently fixed them.",source:"@site/docs/en-posts/fullstack/2024-08-14-updating-NestJS-mod-libraries.md",sourceDirName:"en-posts/fullstack",slug:"/en-posts/fullstack/2024-08-14-updating-NestJS-mod-libraries",permalink:"/docs/en-posts/fullstack/2024-08-14-updating-NestJS-mod-libraries",draft:!1,unlisted:!1,editUrl:"https://github.com/nestjs-mod/nestjs-mod.com/blob/master/docs/en-posts/fullstack/2024-08-14-updating-NestJS-mod-libraries.md",tags:[],version:"current",frontMatter:{},sidebar:"enPostsSidebar",previous:{title:"Connecting PrismaORM to the NestJS-mod application and checking its operation via REST",permalink:"/docs/en-posts/fullstack/2024-08-13"},next:{title:"Adding Swagger documentation to the NestJS-mod application and generating a REST client for the Angular application",permalink:"/docs/en-posts/fullstack/2024-08-14"}},c={},d=[{value:"1. Run the package version update command and install them",id:"1-run-the-package-version-update-command-and-install-them",level:3},{value:"2. We go to the repository with an example of generation and study the commit with changes",id:"2-we-go-to-the-repository-with-an-example-of-generation-and-study-the-commit-with-changes",level:3},{value:"3. We are making similar edits in our project",id:"3-we-are-making-similar-edits-in-our-project",level:3},{value:"4. Since the generation example contains only basic differences between versions, other differences need to be looked at through the release descriptions.",id:"4-since-the-generation-example-contains-only-basic-differences-between-versions-other-differences-need-to-be-looked-at-through-the-release-descriptions",level:3},{value:"Links",id:"links",level:3}];function l(e){const n={a:"a",code:"code",em:"em",h1:"h1",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"an-example-of-a-simple-update-of-nestjs-mod-libraries",children:"An example of a simple update of NestJS-mod libraries"}),"\n",(0,t.jsx)(n.p,{children:"When writing the last post, I found small errors and urgently fixed them."}),"\n",(0,t.jsx)(n.p,{children:"NestJS-mod decided to describe the process of updating libraries in the form of a small unscheduled article."}),"\n",(0,t.jsx)(n.h3,{id:"1-run-the-package-version-update-command-and-install-them",children:"1. Run the package version update command and install them"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:"Commands"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Update all dependencies\nnpm run update:nestjs-mod-versions\n\n# Install all dependencies\nnpm i\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:"Console output"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"$ npm run update:nestjs-mod-versions\n\n> @nestjs-mod-fullstack/source@0.0.0 update:nestjs-mod-versions\n> npx -y npm-check-updates @nestjs-mod/* nestjs-mod -u\n\nUpgrading /home/endy/Projects/nestjs-mod/nestjs-mod-fullstack/package.json\n[====================] 10/10 100%\n\n @nestjs-mod/common           2.14.0  \u2192   2.14.2\n @nestjs-mod/docker-compose  ^1.15.0  \u2192  ^1.15.2\n @nestjs-mod/flyway           ^1.6.0  \u2192   ^1.6.2\n @nestjs-mod/pino             1.14.0  \u2192   1.14.2\n @nestjs-mod/pm2              1.12.0  \u2192   1.12.2\n @nestjs-mod/prisma           ^1.9.0  \u2192   ^1.9.2\n @nestjs-mod/reports          2.14.0  \u2192   2.14.2\n @nestjs-mod/schematics       ^2.9.2  \u2192   ^2.9.5\n @nestjs-mod/terminus         1.13.0  \u2192   1.13.2\n @nestjs-mod/testing          2.14.0  \u2192   2.14.2\n\nRun npm install to install new versions.\n\nnpm i\n\nchanged 10 packages, and audited 2768 packages in 12s\n\n331 packages are looking for funding\n  run `npm fund` for details\n\n18 vulnerabilities (6 moderate, 12 high)\n\nTo address issues that do not require attention, run:\n  npm audit fix\n\nTo address all issues (including breaking changes), run:\n  npm audit fix --force\n\nRun `npm audit` for details.\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-we-go-to-the-repository-with-an-example-of-generation-and-study-the-commit-with-changes",children:"2. We go to the repository with an example of generation and study the commit with changes"}),"\n",(0,t.jsxs)(n.p,{children:["Repository with an example of generation: ",(0,t.jsx)(n.a,{href:"https://github.com/nestjs-mod/nestjs-mod-example",children:"https://github.com/nestjs-mod/nestjs-mod-example"}),"\nThe required commit: ",(0,t.jsx)(n.a,{href:"https://github.com/nestjs-mod/nestjs-mod-example/commit/1c01ef9b7e5dec1a93b239326740780a4a756dea",children:"https://github.com/nestjs-mod/nestjs-mod-example/commit/1c01ef9b7e5dec1a93b239326740780a4a756dea"})]}),"\n",(0,t.jsx)(n.p,{children:"We do not pay attention to various changes in the documentation, we are only interested in changes in the code and package.json"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:"Changes in the package.json"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-diff",children:'...\n-    "docs:infrastructure": "export NESTJS_MODE=infrastructure && ./node_modules/.bin/nx run-many --exclude=@project-name/source --all -t=start --parallel=1",\n+    "docs:infrastructure": "export NESTJS_MODE=infrastructure && ./node_modules/.bin/nx run-many --exclude=@project-name/source --all -t=serve --parallel=1 -- --watch=false --inspect=false",\n...\n-    "manual:prepare": "npm run generate && npm run build && npm run docs:infrastructure && npm run test",\n+    "manual:prepare": "npm run generate && npm run docs:infrastructure && npm run test",\n...\n'})}),"\n",(0,t.jsx)(n.h3,{id:"3-we-are-making-similar-edits-in-our-project",children:"3. We are making similar edits in our project"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:"Changes in the package.json"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-diff",children:'...\n-    "docs:infrastructure": "export NESTJS_MODE=infrastructure && ./node_modules/.bin/nx run-many --exclude=@nestjs-mod-fullstack/source --all -t=start --parallel=1 --watch=false",\n+    "docs:infrastructure": "export NESTJS_MODE=infrastructure && ./node_modules/.bin/nx run-many --exclude=@nestjs-mod-fullstack/source,client* --all -t=serve --parallel=1 -- --watch=false --inspect=false",\n...\n-    "manual:prepare": "npm run generate && npm run build && npm run docs:infrastructure && npm run test",\n+    "manual:prepare": "npm run generate && npm run docs:infrastructure && npm run test",\n...\n'})}),"\n",(0,t.jsx)(n.p,{children:"We see that when starting in infrastructure mode, another option is now passed, we find similar places and change them there."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:"Changes in apps/server/project.json"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-diff",children:'...\n-    "export NESTJS_MODE=infrastructure && ./node_modules/.bin/nx serve server --host=0.0.0.0 --watch=false",\n+    "export NESTJS_MODE=infrastructure && ./node_modules/.bin/nx serve server --host=0.0.0.0 --watch=false --inspect=false",\n...\n'})}),"\n",(0,t.jsx)(n.h3,{id:"4-since-the-generation-example-contains-only-basic-differences-between-versions-other-differences-need-to-be-looked-at-through-the-release-descriptions",children:"4. Since the generation example contains only basic differences between versions, other differences need to be looked at through the release descriptions."}),"\n",(0,t.jsx)(n.p,{children:"Since the NestJS-mod project has automatic semantic versioning enabled, it is sometimes difficult to understand exactly where the changes were."}),"\n",(0,t.jsx)(n.p,{children:"The current changes are just difficult to analyze, since I am the only developer of these packages, I am the only one who knows what happened (perhaps in the future commits for changes will have a description of how to migrate the code)."}),"\n",(0,t.jsxs)(n.p,{children:["The current major emergency changes relate to the package ",(0,t.jsx)(n.code,{children:"@nestjs-mod/pm2"}),", the list of changes for it: ",(0,t.jsx)(n.a,{href:"https://github.com/nestjs-mod/nestjs-mod-contrib/blob/master/libs/infrastructure/pm2/CHANGELOG.md",children:"https://github.com/nestjs-mod/nestjs-mod-contrib/blob/master/libs/infrastructure/pm2/CHANGELOG.md"})]}),"\n",(0,t.jsxs)(n.p,{children:["We are interested in the commit: ",(0,t.jsx)(n.a,{href:"https://github.com/nestjs-mod/nestjs-mod-contrib/commit/4d126b8b42fdc50b2f4222202e6151ba49568baa",children:"https://github.com/nestjs-mod/nestjs-mod-contrib/commit/4d126b8b42fdc50b2f4222202e6151ba49568baa"})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:"Changes in libs/infrastructure/pm2/src/lib/pm2.service.ts"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-diff",children:"...\n    currentConfig.apps = currentConfig.apps.map((app) => {\n      if (app.name === appName) {\n-        return currentApp;\n+        return { ...currentApp, ...app };\n      }\n      return app;\n    }) as StartOptions[];\n...\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:"Logic before changes:"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["After running the ",(0,t.jsx)(n.code,{children:"npm run generate"})," command, the file ",(0,t.jsx)(n.code,{children:"ecosystem.config.json"})," is created"]}),"\n",(0,t.jsxs)(n.li,{children:["After manually editing the file ",(0,t.jsx)(n.code,{children:"ecosystem.config.json"})," and re-running the command ",(0,t.jsx)(n.code,{children:"npm run generate"}),", all manual changes were erased."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:"Logic after changes:"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["After running the ",(0,t.jsx)(n.code,{children:"npm run generate"})," command, the file ",(0,t.jsx)(n.code,{children:"ecosystem.config.json"})," is created"]}),"\n",(0,t.jsxs)(n.li,{children:["After manually editing the file ",(0,t.jsx)(n.code,{children:"ecosystem.config.json"})," and running the command ",(0,t.jsx)(n.code,{children:"npm run generate"})," again, all manual changes remain."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"links",children:"Links"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://nestjs.com",children:"https://nestjs.com"})," - the official website of the framework"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://nestjs-mod.com",children:"https://nestjs-mod.com"})," - the official website of additional utilities"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/nestjs-mod/nestjs-mod-fullstack",children:"https://github.com/nestjs-mod/nestjs-mod-fullstack"})," - the project from the post"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/nestjs-mod/nestjs-mod-fullstack/commit/554f2fa53a62b6171a63d465a67fcdde7b333f69",children:"https://github.com/nestjs-mod/nestjs-mod-fullstack/commit/554f2fa53a62b6171a63d465a67fcdde7b333f69"})," - commit to current changes"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"#pm2 #bug #nestjsmod #fullstack\n#2024-08-14-updating-NestJS-mod-libraries"})]})}function m(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>o});var t=s(6540);const r={},a=t.createContext(r);function i(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);