<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-ru-posts/fullstack/2024-08-22" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Ручной деплой NestJS и Angular приложений на выделенном сервер через &quot;Docker Compose&quot; и &quot;PM2&quot; | NestJS-mod</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://nestjs-mod.com/img/fon-nest.png"><meta data-rh="true" name="twitter:image" content="https://nestjs-mod.com/img/fon-nest.png"><meta data-rh="true" property="og:url" content="https://nestjs-mod.com/docs/ru-posts/fullstack/2024-08-22"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Ручной деплой NestJS и Angular приложений на выделенном сервер через &quot;Docker Compose&quot; и &quot;PM2&quot; | NestJS-mod"><meta data-rh="true" name="description" content="Покупаем выделенный сервер и настраиваем SSH доступ к нему с локального компьютера."><meta data-rh="true" property="og:description" content="Покупаем выделенный сервер и настраиваем SSH доступ к нему с локального компьютера."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://nestjs-mod.com/docs/ru-posts/fullstack/2024-08-22"><link data-rh="true" rel="alternate" href="https://nestjs-mod.com/docs/ru-posts/fullstack/2024-08-22" hreflang="en"><link data-rh="true" rel="alternate" href="https://nestjs-mod.com/docs/ru-posts/fullstack/2024-08-22" hreflang="x-default"><link rel="preconnect" href="https://mc.yandex.ru">
<script>!function(e,t,a,c,n,r,i){e[n]=e[n]||function(){(e[n].a=e[n].a||[]).push(arguments)},e[n].l=1*new Date,r=t.createElement(a),i=t.getElementsByTagName(a)[0],r.async=1,r.src="https://mc.yandex.ru/metrika/tag.js",i.parentNode.insertBefore(r,i)}(window,document,"script",0,"ym"),ym(98948842,"init",{defer:!0,clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!0,ecommerce:!1,trackHash:!0})</script>
<noscript>
                            <div><img src="https://mc.yandex.ru/watch/98948842" style="position:absolute; left:-9999px;" alt=""></div>
                        </noscript><link rel="stylesheet" href="/assets/css/styles.4fd952a5.css">
<script src="/assets/js/runtime~main.fdd65bd3.js" defer="defer"></script>
<script src="/assets/js/main.d2d25786.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="NestJS-mod" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="NestJS-mod" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">NestJS-mod</b></a><a class="navbar__item navbar__link" href="/docs/guides/introduction">Docs</a><a class="navbar__item navbar__link" href="/docs/category/common">Packages</a><a class="navbar__item navbar__link" href="/docs/category/fullstack">Posts</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/category/fullstack-1">Посты</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/nestjs-mod" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/fullstack-1">Fullstack</a><button aria-label="Collapse sidebar category &#x27;Fullstack&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-02-14">Как я развернул фулстек-приложение на &quot;NestJS&quot; с &quot;Angular&quot; в &quot;Supabase&quot; и &quot;Vercel&quot;</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-08-08">Создание пустого проекта с помощью NestJS-mod</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-08-09">Создание пустого Angular проекта и связь его с существующим сервером на NestJS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-08-11">Добавление базы данных Postgres в проект и запуск миграций через Flyway для NestJS-mod приложения</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-08-13">Подключение PrismaORM в NestJS-mod приложение и проверка его работы через REST</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-08-14-обновление-NestJS-mod-библиотек">Пример простого обновления NestJS-mod библиотек</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-08-14">Добавление Swagger документации в NestJS-mod приложение и генерация REST-клиента для Angular-приложения</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-08-20">Сборка приложений на NestJS и Angular и запуск их в двух вариантах: через PM2 и через &quot;Docker Compose&quot;</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/ru-posts/fullstack/2024-08-22">Ручной деплой NestJS и Angular приложений на выделенном сервер через &quot;Docker Compose&quot; и &quot;PM2&quot;</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-08-26">Добавляем CI/CD конфиг для деплоя NestJS и Angular приложений на выделенный сервер с помощью GitHub Actions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-09-08">Ускорение деплоя NestJS и Angular с помощью общественных Github-раннеров и создания промежуточных Docker-образов</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-09-13">Установка Kubernetes через MicroK8s и настройка деплоя NestJS и Angular приложений</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-09-15">Доступ к сайту на NestJS и Angular по доменному имени c SSL - сертификатом в Kubernetes через Ingress</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-09-16">Семантическое версионирование NestJS и Angular приложений в NX-монорепозитории</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-09-17">Добавляем lint-staged в NestJS и Angular приложения, включаем семантическое версионирование фронтенда</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-10-06">Создание конфигурируемого Webhook-модуля для NestJS-приложении</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-10-25">Создание пользовательского интерфейса для модуля Webhook с помощью Angular</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-11-08">Интеграция внешнего сервера авторизации https://authorizer.dev в фулстек приложение на NestJS и Angular</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-11-15">Интеграция внешнего файлового сервера https://min.io в фулстек приложение на NestJS и Angular</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-11-20">Кэширование информации в Redis на NestJS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-11-21">Получение серверного времени через WebSockets и отображение его в Angular-приложении</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-11-24">Валидация REST-запросов в NestJS-приложении и отображение ошибок в формах Angular-приложения</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-12-03">Добавление поддержки нескольких языков в NestJS и Angular приложениях</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-12-12">Поддержка временных зон в фулстек-приложении на основе NestJS и Angular: работа с REST и WebSockets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-12-16">Интеграция и сохранение выбранного языка пользователя в базу данных в фулстек-приложении на &quot;Angular&quot; и &quot;NestJS&quot;</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-12-29">Конвертация даты по временной зоне пользователя в &quot;NestJS&quot;, а также ввод и отображение даты в &quot;Angular&quot;</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/fullstack-1"><span itemprop="name">Fullstack</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Ручной деплой NestJS и Angular приложений на выделенном сервер через &quot;Docker Compose&quot; и &quot;PM2&quot;</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Ручной деплой NestJS и Angular приложений на выделенном сервер через &quot;Docker Compose&quot; и &quot;PM2&quot;</h1>
<p>Покупаем выделенный сервер и настраиваем SSH доступ к нему с локальног о компьютера.</p>
<p>Добавляем <a href="https://github.com/SteveLTN/https-portal" target="_blank" rel="noopener noreferrer">https://github.com/SteveLTN/https-portal</a> в &quot;Docker compose&quot; для автоматической генерации и продления сертификатов.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-находим-бесплатный-или-покупаем-выделенный-сервер">1. Находим бесплатный или покупаем выделенный сервер<a class="hash-link" aria-label="Direct link to 1. Находим бесплатный или покупаем выделенный сервер" title="Direct link to 1. Находим бесплатный или покупаем выделенный сервер" href="/docs/ru-posts/fullstack/2024-08-22#1-находим-бесплатный-или-покупаем-выделенный-сервер">​</a></h3>
<p>Шаги по этому пункту не буду расписывать, я уже расписывал ранее в разделе &quot;Buy VPS&quot; другого поста - <a href="https://dev.to/endykaufman/deploy-nestjs-project-to-vps-with-dokku-31c5" target="_blank" rel="noopener noreferrer">Deploy nestjs project to VPS with dokku</a>.</p>
<p>В рамках текущих постов я купил на том же сайте самый дешевый выделенный сервер.</p>
<p><em>Операционная система</em>: <code>Ubuntu 22.04 x64</code>
<em>Доступ в мир</em>: <code>100 MB/sec (shared)</code>
<em>RAM</em>: <code>2GB</code>
<em>CPU</em>: <code>2 vCPU</code>
<em>Количество IPv4 адресов</em>: <code>1</code></p>
<p>При покупке выделенного сервера мне также дали домен третьего уровня: vps1724252356.tech0.ru, в будущем этот проект переедет на домен <a href="https://fullstack.nestjs-mod.com" target="_blank" rel="noopener noreferrer">https://fullstack.nestjs-mod.com</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-настройка-подключение-к-выделенному-серверу-по-ssh">2. Настройка подключение к выделенному серверу по SSH<a class="hash-link" aria-label="Direct link to 2. Настройка подключение к выделенному серверу по SSH" title="Direct link to 2. Настройка подключение к выделенному серверу по SSH" href="/docs/ru-posts/fullstack/2024-08-22#2-настройка-подключение-к-выделенному-серверу-по-ssh">​</a></h3>
<p>После покупки необходимо установить пароль если он не был установлен, разные сайты имеют свои интерфейсы для этого, в моем случаи установка пароля находится на странице <a href="https://ztv.su/clientarea.php?action=productdetails&amp;id=33376#tabChangepw" target="_blank" rel="noopener noreferrer">https://ztv.su/clientarea.php?action=productdetails&amp;id=33376#tabChangepw</a>.</p>
<p>Копируем наш локальный публичный SSH на удаленный сервер, при запуске появится запрос на ввод пароля, необходимо ввести свой пароль и нажать &quot;Enter&quot;.</p>
<p>Если SSH-ключа на компьютере не было, то его нужно создать с помощью команды <code>ssh-keygen</code></p>
<p><em>Команды</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh-copy-id root@194.226.49.162</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>Вывод консоли</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ssh-copy-id root@194.226.49.162</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &quot;/home/user/.ssh/id_rsa.pub&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The authenticity of host &#x27;194.226.49.162 (194.226.49.162)&#x27; can&#x27;t be established.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ECDSA key fingerprint is SHA256:SOME_SYMBOLS.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@194.226.49.162&#x27;s password:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Number of key(s) added: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Now try logging into the machine, with:   &quot;ssh &#x27;root@194.226.49.162&#x27;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and check to make sure that only the key(s) you wanted were added.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-подключение-к-удаленному-серверу">3. Подключение к удаленному серверу<a class="hash-link" aria-label="Direct link to 3. Подключение к удаленному серверу" title="Direct link to 3. Подключение к удаленному серверу" href="/docs/ru-posts/fullstack/2024-08-22#3-подключение-к-удаленному-серверу">​</a></h3>
<p><em>Команды</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh root@194.226.49.162</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>Вывод консоли</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ssh root@194.226.49.162</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Welcome to Ubuntu 22.04.3 LTS (GNU/Linux 5.15.0-91-generic x86_64)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Documentation:  https://help.ubuntu.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Management:     https://landscape.canonical.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Support:        https://ubuntu.com/advantage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  System information as of Wed Aug 21 18:42:37 MSK 2024</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  System load:  0.02734375        Processes:             103</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Usage of /:   9.4% of 24.05GB   Users logged in:       0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Memory usage: 10%               IPv4 address for eth0: 194.226.49.162</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Swap usage:   0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Strictly confined Kubernetes makes edge and IoT secure. Learn how MicroK8s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   just raised the bar for easy, resilient and secure K8s cluster deployment.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   https://ubuntu.com/engage/secure-kubernetes-at-the-edge</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Expanded Security Maintenance for Applications is not enabled.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 updates can be applied immediately.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enable ESM Apps to receive additional future security updates.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">See https://ubuntu.com/esm or run: sudo pro status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The list of available updates is more than a week old.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">To check for new updates run: sudo apt update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Last login: Wed Aug 21 18:41:46 2024 from X.X.X.X</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@vps1724252356:~#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-установка-всех-необходимых-пакетов-на-выделенный-сервер">4. Установка всех необходимых пакетов на выделенный сервер<a class="hash-link" aria-label="Direct link to 4. Установка всех необходимых пакетов на выделенный сервер" title="Direct link to 4. Установка всех необходимых пакетов на выделенный сервер" href="/docs/ru-posts/fullstack/2024-08-22#4-установка-всех-необходимых-пакетов-на-выделенный-сервер">​</a></h3>
<p><em>Команды</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo snap install curl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -fsSL https://get.docker.com -o get-docker.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sh get-docker.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo groupadd docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo usermod -aG docker $USER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install git -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export NVM_DIR=&quot;$HOME/.nvm&quot; &amp;&amp; . &quot;$NVM_DIR/nvm.sh&quot; --no-use</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nvm install v20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nvm use v20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm install --global yarn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install default-jre -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install -y unzip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf &amp;&amp; sudo sysctl -p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo reboot</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>Вывод консоли</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@vps1724252356:~# sudo snap install curl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl 8.1.2 from Wouter van Bommel (woutervb) installed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@vps1724252356:~# curl -fsSL https://get.docker.com -o get-docker.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sh get-docker.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo groupadd docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo usermod -aG docker $USER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Executing docker install script, commit: 0d6f72e671ba87f7aa4c6991646a1a5b9f9dae84</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ sh -c apt-get update -qq &gt;/dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ sh -c DEBIAN_FRONTEND=noninteractive apt-get install -y -qq ca-certificates curl &gt;/dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ sh -c install -m 0755 -d /etc/apt/keyrings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ sh -c curl -fsSL &quot;https://download.docker.com/linux/ubuntu/gpg&quot; -o /etc/apt/keyrings/docker.asc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ sh -c chmod a+r /etc/apt/keyrings/docker.asc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ sh -c echo &quot;deb [arch=amd64 signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu jammy stable&quot; &gt; /etc/apt/sources.list.d/docker.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ sh -c apt-get update -qq &gt;/dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ sh -c DEBIAN_FRONTEND=noninteractive apt-get install -y -qq docker-ce docker-ce-cli containerd.io docker-compose-plugin docker-ce-rootless-extras docker-buildx-plugin &gt;/dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ sh -c docker version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Client: Docker Engine - Community</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Version:           27.1.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> API version:       1.46</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Go version:        go1.21.13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Git commit:        d01f264</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Built:             Mon Aug 12 11:50:12 2024</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> OS/Arch:           linux/amd64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Context:           default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Server: Docker Engine - Community</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Engine:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Version:          27.1.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  API version:      1.46 (minimum version 1.24)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Go version:       go1.21.13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Git commit:       f9522e5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Built:            Mon Aug 12 11:50:12 2024</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  OS/Arch:          linux/amd64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Experimental:     false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> containerd:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Version:          1.7.20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  GitCommit:        8fc6bcff51318944179630522a095cc9dbf9f353</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> runc:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Version:          1.1.13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  GitCommit:        v1.1.13-0-g58aa920</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> docker-init:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Version:          0.19.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  GitCommit:        de40ad0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">================================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">To run Docker as a non-privileged user, consider setting up the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Docker daemon in rootless mode for your user:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dockerd-rootless-setuptool.sh install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Visit https://docs.docker.com/go/rootless/ to learn about rootless mode.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">To run the Docker daemon as a fully privileged service, but granting non-root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">users access, refer to https://docs.docker.com/go/daemon-access/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WARNING: Access to the remote API on a privileged Docker daemon is equivalent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         to root access on the host. Refer to the &#x27;Docker daemon attack surface&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         documentation for details: https://docs.docker.com/go/attack-surface/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">================================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">groupadd: group &#x27;docker&#x27; already exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@vps1724252356:~# sudo apt install git -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Reading package lists... Done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Building dependency tree... Done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Reading state information... Done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Suggested packages:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  git-daemon-run | git-daemon-sysvinit git-doc git-email git-gui gitk gitweb git-cvs git-mediawiki git-svn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The following packages will be upgraded:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 upgraded, 0 newly installed, 0 to remove and 137 not upgraded.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Need to get 3165 kB of archives.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">After this operation, 16.4 kB of additional disk space will be used.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Get:1 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 git amd64 1:2.34.1-1ubuntu1.11 [3165 kB]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Fetched 3165 kB in 1s (2408 kB/s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(Reading database ... 94596 files and directories currently installed.)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Preparing to unpack .../git_1%3a2.34.1-1ubuntu1.11_amd64.deb ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Unpacking git (1:2.34.1-1ubuntu1.11) over (1:2.34.1-1ubuntu1.10) ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Setting up git (1:2.34.1-1ubuntu1.11) ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Scanning processes...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Scanning linux images...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Running kernel seems to be up-to-date.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No services need to be restarted.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No containers need to be restarted.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No user sessions are running outdated binaries.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No VM guests are running outdated hypervisor (qemu) binaries on this host.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@vps1724252356:~# curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export NVM_DIR=&quot;$HOME/.nvm&quot; &amp;&amp; . &quot;$NVM_DIR/nvm.sh&quot; --no-use</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nvm install v20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nvm use v20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 Dload  Upload   Total   Spent    Left  Speed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">100 15037  100 15037    0     0  36871      0 --:--:-- --:--:-- --:--:-- 36945</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=&gt; Downloading nvm from git to &#x27;/root/.nvm&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=&gt; Cloning into &#x27;/root/.nvm&#x27;...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">remote: Enumerating objects: 376, done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">remote: Counting objects: 100% (376/376), done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">remote: Compressing objects: 100% (320/320), done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">remote: Total 376 (delta 46), reused 176 (delta 29), pack-reused 0 (from 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Receiving objects: 100% (376/376), 372.57 KiB | 2.13 MiB/s, done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Resolving deltas: 100% (46/46), done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* (HEAD detached at FETCH_HEAD)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=&gt; Compressing and cleaning up git repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=&gt; Appending nvm source string to /root/.bashrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=&gt; Appending bash_completion source string to /root/.bashrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=&gt; Close and reopen your terminal to start using nvm or run the following to use it now:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export NVM_DIR=&quot;$HOME/.nvm&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ -s &quot;$NVM_DIR/nvm.sh&quot; ] &amp;&amp; \. &quot;$NVM_DIR/nvm.sh&quot;  # This loads nvm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ -s &quot;$NVM_DIR/bash_completion&quot; ] &amp;&amp; \. &quot;$NVM_DIR/bash_completion&quot;  # This loads nvm bash_completion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Downloading and installing node v20.16.0...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Downloading https://nodejs.org/dist/v20.16.0/node-v20.16.0-linux-x64.tar.xz...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">################################################################################################################################################################ 100.0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Computing checksum with sha256sum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Checksums matched!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Now using node v20.16.0 (npm v10.8.1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Creating default alias: default -&gt; v20 (-&gt; v20.16.0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Now using node v20.16.0 (npm v10.8.1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@vps1724252356:~# npm install --global yarn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">added 1 package in 2s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm notice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm notice New patch version of npm available! 10.8.1 -&gt; 10.8.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm notice Changelog: https://github.com/npm/cli/releases/tag/v10.8.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm notice To update run: npm install -g npm@10.8.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm notice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@vps1724252356:~# sudo apt install -y unzip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Reading package lists... Done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Building dependency tree... Done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Reading state information... Done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Suggested packages:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The following NEW packages will be installed:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  unzip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 upgraded, 1 newly installed, 0 to remove and 137 not upgraded.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Need to get 175 kB of archives.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">After this operation, 386 kB of additional disk space will be used.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Get:1 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 unzip amd64 6.0-26ubuntu3.2 [175 kB]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Fetched 175 kB in 0s (485 kB/s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Selecting previously unselected package unzip.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(Reading database ... 96234 files and directories currently installed.)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Preparing to unpack .../unzip_6.0-26ubuntu3.2_amd64.deb ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Unpacking unzip (6.0-26ubuntu3.2) ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Setting up unzip (6.0-26ubuntu3.2) ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Processing triggers for man-db (2.10.2-1) ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Scanning processes...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Scanning linux images...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Running kernel seems to be up-to-date.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No services need to be restarted.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No containers need to be restarted.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No user sessions are running outdated binaries.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No VM guests are running outdated hypervisor (qemu) binaries on this host.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@vps1724252356:~# sudo reboot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection to 194.226.49.162 closed by remote host.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection to 194.226.49.162 closed.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-генерация-ssh-ключа-на-выделенном-сервере">5. Генерация SSH-ключа на выделенном сервере<a class="hash-link" aria-label="Direct link to 5. Генерация SSH-ключа на выделенном сервере" title="Direct link to 5. Генерация SSH-ключа на выделенном сервере" href="/docs/ru-posts/fullstack/2024-08-22#5-генерация-ssh-ключа-на-выделенном-сервере">​</a></h3>
<p>Это нужно для того чтобы мы могли скачать репозиторий на выделенный сервер</p>
<p><em>Команды</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh-keygen</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>Вывод консоли</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@vps1724252356:~# ssh-keygen</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Generating public/private rsa key pair.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter file in which to save the key (/root/.ssh/id_rsa):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter passphrase (empty for no passphrase):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter same passphrase again:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Your identification has been saved in /root/.ssh/id_rsa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Your public key has been saved in /root/.ssh/id_rsa.pub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The key fingerprint is:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SHA256:SOME_RANDOM_SYMBOLS root@vps1724252356</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The key&#x27;s randomart image is:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---[RSA 3072]----+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  .o*oo.         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----[SHA256]-----+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-привязка-публичного-ключа-выдленного-сервера-к-github">6. Привязка публичного ключа выдленного сервера к GitHub<a class="hash-link" aria-label="Direct link to 6. Привязка публичного ключа выдленного сервера к GitHub" title="Direct link to 6. Привязка публичного ключа выдленного сервера к GitHub" href="/docs/ru-posts/fullstack/2024-08-22#6-привязка-публичного-ключа-выдленного-сервера-к-github">​</a></h3>
<p>Необходимо запустить команды <code>cat /root/.ssh/id_rsa.pub</code> и ответ вставить в настройки проекта, у меня они тут: <a href="https://github.com/nestjs-mod/nestjs-mod-fullstack/settings/keys/new" target="_blank" rel="noopener noreferrer">https://github.com/nestjs-mod/nestjs-mod-fullstack/settings/keys/new</a></p>
<p><em>Команды</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@vps1724252356:~# cat /root/.ssh/id_rsa.pub</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>Вывод консоли</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># cat /root/.ssh/id_rsa.pub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh-rsa AAAARANDOM_SYMBOLS= root@vps1724252356</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="7-клонируем-проект">7. Клонируем проект<a class="hash-link" aria-label="Direct link to 7. Клонируем проект" title="Direct link to 7. Клонируем проект" href="/docs/ru-posts/fullstack/2024-08-22#7-клонируем-проект">​</a></h3>
<p><em>Команды</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git clone git@github.com:nestjs-mod/nestjs-mod-fullstack.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd nestjs-mod-fullstack</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>Вывод консоли</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@vps1724252356:~# git clone git@github.com:nestjs-mod/nestjs-mod-fullstack.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Cloning into &#x27;nestjs-mod-fullstack&#x27;...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The authenticity of host &#x27;github.com (140.82.121.3)&#x27; can&#x27;t be established.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ED25519 key fingerprint is SHA256:+SOME_RANDOM_SYMBOLS.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This key is not known by any other names</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Warning: Permanently added &#x27;github.com&#x27; (ED25519) to the list of known hosts.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">remote: Enumerating objects: 426, done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">remote: Counting objects: 100% (426/426), done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">remote: Compressing objects: 100% (294/294), done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">remote: Total 426 (delta 190), reused 340 (delta 106), pack-reused 0 (from 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Receiving objects: 100% (426/426), 536.69 KiB | 1.56 MiB/s, done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Resolving deltas: 100% (190/190), done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@vps1724252356:~# cd nestjs-mod-fullstack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@vps1724252356:~/nestjs-mod-fullstack#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="8-устанавливаем-зависимости-и-прогоняем-запуск-и-тестирование-двух-режимов-pm2-продакшен-и-docker-compose">8. Устанавливаем зависимости и прогоняем запуск и тестирование двух режимов: PM2-продакшен и &quot;Docker Compose&quot;<a class="hash-link" aria-label="Direct link to 8. Устанавливаем зависимости и прогоняем запуск и тестирование двух режимов: PM2-продакшен и &quot;Docker Compose&quot;" title="Direct link to 8. Устанавливаем зависимости и прогоняем запуск и тестирование двух режимов: PM2-продакшен и &quot;Docker Compose&quot;" href="/docs/ru-posts/fullstack/2024-08-22#8-устанавливаем-зависимости-и-прогоняем-запуск-и-тестирование-двух-режимов-pm2-продакшен-и-docker-compose">​</a></h3>
<p>E2E-тесты запускаем указывая внешний глобальный ИП адрес приложений.</p>
<p><em>Команды</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npm i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npx playwright install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npx playwright install-deps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm run test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp example.env .env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm run pm2-full:prod:start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export BASE_URL=http://194.226.49.162:3000 &amp;&amp; npm run test:e2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm run pm2-full:prod:stop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm run docker-compose-full:prod:start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export BASE_URL=http://194.226.49.162:8080 &amp;&amp; npm run test:e2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm run docker-compose-full:prod:stop</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>E2E-тестирование в режиме &quot;Docker Compose&quot; упало с ошибкой, в следующих шагах будем их исправлять на локальном компьютере и затем через коммит в репозиторий проекта, донесем их на выделенный сервер.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="9-на-локальном-компьютере-обновляем-и-добавляем-новые-npm-скрипты">9. На локальном компьютере, обновляем и добавляем новые npm-скрипты<a class="hash-link" aria-label="Direct link to 9. На локальном компьютере, обновляем и добавляем новые npm-скрипты" title="Direct link to 9. На локальном компьютере, обновляем и добавляем новые npm-скрипты" href="/docs/ru-posts/fullstack/2024-08-22#9-на-локальном-компьютере-обновляем-и-добавляем-новые-npm-скрипты">​</a></h3>
<p>При локальной разработке для запуска использовался отдельно установленное приложение &quot;docker-compose&quot;, а на выделенном сервере используется compose встроенный в Docker.</p>
<p>Удаляем скрипт для копирования статики <code>copy-front-to-backend</code>, так как теперь мы напрямую из бэкенд-приложения идем смотреть собранную статику фронтенда.</p>
<p>Для создания баз данных и применения миграций создаем отдельный npm-скрипт, так как при попытке запуска двух npm комманд внутри контейнера, запускался только один.</p>
<p>Обновляем файл <code>package.json</code></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;scripts&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;_____docker-compose-full prod infra_____&quot;: &quot;_____docker-compose-full prod infra_____&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;docker-compose-full:prod:start&quot;: &quot;export NX_DAEMON=false &amp;&amp; export DISABLE_SERVE_STATIC=true &amp;&amp; npm run generate &amp;&amp; npm run build -- -c production &amp;&amp; npm run docker:build:server:latest &amp;&amp; export COMPOSE_INTERACTIVE_NO_CLI=1 &amp;&amp; docker compose -f ./.docker/docker-compose-full.yml --env-file ./.docker/docker-compose-full.env --compatibility up -d&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;docker-compose-full:prod:stop&quot;: &quot;export COMPOSE_INTERACTIVE_NO_CLI=1 &amp;&amp; docker compose -f ./.docker/docker-compose-full.yml --env-file ./.docker/docker-compose-full.env --compatibility down&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;docker-compose-full:prod:only-start&quot;: &quot;export COMPOSE_INTERACTIVE_NO_CLI=1 &amp;&amp; docker compose -f ./.docker/docker-compose-full.yml --env-file ./.docker/docker-compose-full.env --compatibility up -d&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;docker-compose-full:prod:fill:database&quot;: &quot;npm run db:create &amp;&amp; npm run flyway:migrate&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;_____docker-compose prod-infra_____&quot;: &quot;_____docker-compose prod-infra_____&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;docker-compose:start-prod:server&quot;: &quot;export COMPOSE_INTERACTIVE_NO_CLI=1 &amp;&amp; docker compose -f ./apps/server/docker-compose-prod.yml --env-file ./apps/server/docker-compose-prod.env --compatibility up -d&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;docker-compose:stop-prod:server&quot;: &quot;export COMPOSE_INTERACTIVE_NO_CLI=1 &amp;&amp; docker compose -f ./apps/server/docker-compose-prod.yml --env-file ./apps/server/docker-compose-prod.env down&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="10-на-локальном-компьютере-обновляем-параметры-контейнера-с-миграциями-в-docker-compose---файле">10. На локальном компьютере, обновляем параметры контейнера с миграциями в &quot;Docker Compose&quot; - файле<a class="hash-link" aria-label="Direct link to 10. На локальном компьютере, обновляем параметры контейнера с миграциями в &quot;Docker Compose&quot; - файле" title="Direct link to 10. На локальном компьютере, обновляем параметры контейнера с миграциями в &quot;Docker Compose&quot; - файле" href="/docs/ru-posts/fullstack/2024-08-22#10-на-локальном-компьютере-обновляем-параметры-контейнера-с-миграциями-в-docker-compose---файле">​</a></h3>
<p>Обновленный файл <code>.docker/docker-compose-full.yml</code></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;3&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-network</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">driver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;bridge&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-postgre-sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;bitnami/postgresql:15.5.0&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-postgre-sql&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-network&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-postgre-sql-volume:/bitnami/postgresql&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">healthcheck</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">test</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;CMD-SHELL&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;pg_isready -U postgres&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">interval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;5s&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;5s&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">retries</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">tty</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;always&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">POSTGRESQL_USERNAME</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${SERVER_POSTGRE_SQL_POSTGRESQL_USERNAME}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">POSTGRESQL_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${SERVER_POSTGRE_SQL_POSTGRESQL_PASSWORD}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">POSTGRESQL_DATABASE</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${SERVER_POSTGRE_SQL_POSTGRESQL_DATABASE}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-postgre-sql-migrations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;node:20-bullseye-slim&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-postgre-sql-migrations&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-network&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">working_dir</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/app&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;./../:/app&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;npm run docker-compose-full:prod:fill:database&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">tty</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">NX_SKIP_NX_CACHE</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;true&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">SERVER_ROOT_DATABASE_URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${SERVER_ROOT_DATABASE_URL}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">SERVER_APP_DATABASE_URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${SERVER_APP_DATABASE_URL}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-postgre-sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;service_healthy&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-server:latest&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-server&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-network&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">healthcheck</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">test</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;CMD-SHELL&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;npx -y wait-on --timeout= --interval=1000 --window --verbose --log http://localhost:8080/api/health&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">interval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">retries</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">tty</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">SERVER_APP_DATABASE_URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${SERVER_APP_DATABASE_URL}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;always&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-postgre-sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service_healthy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-postgre-sql-migrations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service_completed_successfully</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">alpine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-nginx&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-network&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ../.docker/nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/etc/nginx/conf.d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ../dist/apps/client/browser</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/usr/share/nginx/html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;always&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service_healthy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;8080:8080&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-https-portal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> steveltn/https</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">portal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-https-portal&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-network&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;80:80&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;443:443&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">links</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> nestjs</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">mod</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">fullstack</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">STAGE</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${HTTPS_PORTAL_STAGE}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">FORCE_RENEW</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;true&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">DOMAINS</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${SERVER_DOMAIN} -&gt; http://nestjs-mod-fullstack-nginx:8080&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service_started</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> nestjs</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">mod</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">fullstack</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">https</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">portal</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">volume</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/var/lib/https</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">portal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-postgre-sql-volume</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-postgre-sql-volume&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-https-portal-volume</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-https-portal-volume&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-на-локальном-компьютере-открываем-доступ-к-swagger-интерфейсу-бэкенда-в-nginx">11. На локальном компьютере, открываем доступ к Swagger-интерфейсу бэкенда в Nginx<a class="hash-link" aria-label="Direct link to 11. На локальном компьютере, открываем доступ к Swagger-интерфейсу бэкенда в Nginx" title="Direct link to 11. На локальном компьютере, открываем доступ к Swagger-интерфейсу бэкенда в Nginx" href="/docs/ru-posts/fullstack/2024-08-22#11-на-локальном-компьютере-открываем-доступ-к-swagger-интерфейсу-бэкенда-в-nginx">​</a></h3>
<p>Обновленный файл <code>.docker/nginx/nginx.conf</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">map $sent_http_content_type $expires {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;text/html&quot; epoch;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;text/html; charset=utf-8&quot; epoch;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default off;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">map $http_upgrade $connection_upgrade {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default upgrade;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;&#x27; close;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen 8080;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name localhost;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gzip on;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gzip_proxied any;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gzip_types text/plain application/xml text/css application/javascript application/json;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gzip_min_length 1000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gzip_vary on;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gzip_disable &quot;MSIE [1-6]\.(?!.*SV1)&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client_max_body_size 50m;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_connect_timeout 5m;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_send_timeout 5m;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_read_timeout 5m;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    send_timeout 5m;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_max_temp_file_size 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    root /usr/share/nginx/html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    index index.html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location /api {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_pass http://nestjs-mod-fullstack-server:8080;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_http_version 1.1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header Upgrade $http_upgrade;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header Connection $connection_upgrade;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header Host $host;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header Origin $http_origin;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header X-Real-IP $remote_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # kill cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        add_header Last-Modified $date_gmt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        add_header Cache-Control &#x27;no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if_modified_since off;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        expires off;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        etag off;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location /swagger {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_pass http://nestjs-mod-fullstack-server:8080;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_http_version 1.1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header Upgrade $http_upgrade;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header Connection $connection_upgrade;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header Host $host;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header Origin $http_origin;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header X-Real-IP $remote_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # kill cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        add_header Last-Modified $date_gmt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        add_header Cache-Control &#x27;no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if_modified_since off;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        expires off;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        etag off;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        expires $expires;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_redirect off;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header Host $host;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header Origin $http_origin;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header X-Real-IP $remote_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header X-Forwarded-Proto $scheme;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_read_timeout 1m;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_connect_timeout 1m;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_intercept_errors on;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        error_page 404 =200 /index.html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        root /usr/share/nginx/html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-на-локальном-компьютере-добавляем-возможность-отключения-nestjs-модуля-по-выдаче-статики">12. На локальном компьютере, добавляем возможность отключения NestJS модуля по выдаче статики<a class="hash-link" aria-label="Direct link to 12. На локальном компьютере, добавляем возможность отключения NestJS модуля по выдаче статики" title="Direct link to 12. На локальном компьютере, добавляем возможность отключения NestJS модуля по выдаче статики" href="/docs/ru-posts/fullstack/2024-08-22#12-на-локальном-компьютере-добавляем-возможность-отключения-nestjs-модуля-по-выдаче-статики">​</a></h3>
<p>Так как в режиме &quot;Docker Compose&quot; мы раздаем статику через Nginx, то нам не нужно собирать бэкенд с встроенной статикой и значит не нужны дополнительные обработчики для поддержки выдачи статики.</p>
<p>Обновленный файл <code>apps/server/src/app/app.module.ts</code></p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> createNestModule</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> NestModuleCategory </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@nestjs-mod/common&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> PrismaModule </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@nestjs-mod/prisma&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> ServeStaticModule </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@nestjs/serve-static&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> join </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;path&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> AppController </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;./app.controller&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> AppService </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;./app.service&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> AppModule </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createNestModule</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  moduleName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;AppModule&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  moduleCategory</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> NestModuleCategory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">feature</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  imports</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PrismaModule</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">forFeature</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> featureModuleName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;app&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">DISABLE_SERVE_STATIC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ServeStaticModule</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">forRoot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            rootPath</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__dirname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;assets&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;client&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  controllers</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">AppController</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  providers</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">AppService</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-на-локальном-компьютере-повтороно-прогоняем-запуск-и-тестирование-двух-режимов-pm2-продакшен-и-docker-compose">13. На локальном компьютере, повтороно прогоняем запуск и тестирование двух режимов: PM2-продакшен и &quot;Docker Compose&quot;<a class="hash-link" aria-label="Direct link to 13. На локальном компьютере, повтороно прогоняем запуск и тестирование двух режимов: PM2-продакшен и &quot;Docker Compose&quot;" title="Direct link to 13. На локальном компьютере, повтороно прогоняем запуск и тестирование двух режимов: PM2-продакшен и &quot;Docker Compose&quot;" href="/docs/ru-posts/fullstack/2024-08-22#13-на-локальном-компьютере-повтороно-прогоняем-запуск-и-тестирование-двух-режимов-pm2-продакшен-и-docker-compose">​</a></h3>
<p>E2E-тесты запускаем указывая внешний глобальный ИП адрес приложений.</p>
<p><em>Команды</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npm i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npx playwright install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npx playwright install-deps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm run test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp example.env .env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm run pm2-full:prod:start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export BASE_URL=http://194.226.49.162:3000 &amp;&amp; npm run test:e2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm run pm2-full:prod:stop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm run docker-compose-full:prod:start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export BASE_URL=http://194.226.49.162:8080 &amp;&amp; npm run test:e2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm run docker-compose-full:prod:stop</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Тесты успешно прошли</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="14-на-локальном-компьютере-добавляем-дополнительный-контейнер-с-https-portal-в-docker-compose-fullyml-для-проксирования-http-в-https-и-добавляем-во-все-кроме-migrations-контейнеры-опцию-restart-always">14. На локальном компьютере, добавляем дополнительный контейнер с <code>https-portal</code> в <code>docker-compose-full.yml</code> для проксирования <code>http</code> в <code>https</code> и добавляем во все (кроме migrations) контейнеры опцию <code>restart: &#x27;always&#x27;</code><a class="hash-link" aria-label="Direct link to 14-на-локальном-компьютере-добавляем-дополнительный-контейнер-с-https-portal-в-docker-compose-fullyml-для-проксирования-http-в-https-и-добавляем-во-все-кроме-migrations-контейнеры-опцию-restart-always" title="Direct link to 14-на-локальном-компьютере-добавляем-дополнительный-контейнер-с-https-portal-в-docker-compose-fullyml-для-проксирования-http-в-https-и-добавляем-во-все-кроме-migrations-контейнеры-опцию-restart-always" href="/docs/ru-posts/fullstack/2024-08-22#14-на-локальном-компьютере-добавляем-дополнительный-контейнер-с-https-portal-в-docker-compose-fullyml-для-проксирования-http-в-https-и-добавляем-во-все-кроме-migrations-контейнеры-опцию-restart-always">​</a></h3>
<p>Обновленный файл <code>.docker/docker-compose-full.yml</code></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;3&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-network</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">driver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;bridge&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-postgre-sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;bitnami/postgresql:15.5.0&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-postgre-sql&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-network&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-postgre-sql-volume:/bitnami/postgresql&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">healthcheck</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">test</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;CMD-SHELL&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;pg_isready -U postgres&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">interval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;5s&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;5s&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">retries</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">tty</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;always&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">POSTGRESQL_USERNAME</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${SERVER_POSTGRE_SQL_POSTGRESQL_USERNAME}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">POSTGRESQL_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${SERVER_POSTGRE_SQL_POSTGRESQL_PASSWORD}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">POSTGRESQL_DATABASE</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${SERVER_POSTGRE_SQL_POSTGRESQL_DATABASE}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-postgre-sql-migrations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;node:20-bullseye-slim&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-postgre-sql-migrations&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-network&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">working_dir</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/app&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;./../:/app&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;npm run docker-compose-full:prod:fill:database&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">tty</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">NX_SKIP_NX_CACHE</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;true&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">SERVER_ROOT_DATABASE_URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${SERVER_ROOT_DATABASE_URL}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">SERVER_APP_DATABASE_URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${SERVER_APP_DATABASE_URL}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-postgre-sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;service_healthy&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-server:latest&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-server&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-network&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">healthcheck</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">test</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;CMD-SHELL&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;npx -y wait-on --timeout= --interval=1000 --window --verbose --log http://localhost:8080/api/health&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">interval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">retries</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">tty</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">SERVER_APP_DATABASE_URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${SERVER_APP_DATABASE_URL}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;always&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-postgre-sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service_healthy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-postgre-sql-migrations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service_completed_successfully</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">alpine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-nginx&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-network&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ../.docker/nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/etc/nginx/conf.d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ../dist/apps/client/browser</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/usr/share/nginx/html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;always&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service_healthy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;8080:8080&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-https-portal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> steveltn/https</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">portal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-https-portal&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-network&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;80:80&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;443:443&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">links</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> nestjs</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">mod</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">fullstack</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">STAGE</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${HTTPS_PORTAL_STAGE}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">FORCE_RENEW</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;true&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">DOMAINS</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${SERVER_DOMAIN} -&gt; http://nestjs-mod-fullstack-nginx:8080&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service_started</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> nestjs</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">mod</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">fullstack</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">https</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">portal</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">volume</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/var/lib/https</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">portal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-postgre-sql-volume</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-postgre-sql-volume&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-https-portal-volume</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-https-portal-volume&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="15-на-локальном-компьютере-добавляем-новую-переменную-окружения-с-нашим-доменом-vps1724252356tech0ru">15. На локальном компьютере, добавляем новую переменную окружения с нашим доменом vps1724252356.tech0.ru<a class="hash-link" aria-label="Direct link to 15. На локальном компьютере, добавляем новую переменную окружения с нашим доменом vps1724252356.tech0.ru" title="Direct link to 15. На локальном компьютере, добавляем новую переменную окружения с нашим доменом vps1724252356.tech0.ru" href="/docs/ru-posts/fullstack/2024-08-22#15-на-локальном-компьютере-добавляем-новую-переменную-окружения-с-нашим-доменом-vps1724252356tech0ru">​</a></h3>
<p>Обновленный файл <code>.docker/docker-compose-full.env</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SERVER_ROOT_DATABASE_URL=postgres://postgres:postgres_password@nestjs-mod-fullstack-postgre-sql:5432/postgres?schema=public</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVER_APP_DATABASE_URL=postgres://app:app_password@nestjs-mod-fullstack-postgre-sql:5432/app?schema=public</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVER_POSTGRE_SQL_POSTGRESQL_USERNAME=postgres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVER_POSTGRE_SQL_POSTGRESQL_PASSWORD=postgres_password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVER_POSTGRE_SQL_POSTGRESQL_DATABASE=postgres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVER_DOMAIN=vps1724252356.tech0.ru</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTPS_PORTAL_STAGE=production # local|production</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="17-на-локальном-компьютере-коммитим-изменения-в-репозиторий">17. На локальном компьютере, коммитим изменения в репозиторий<a class="hash-link" aria-label="Direct link to 17. На локальном компьютере, коммитим изменения в репозиторий" title="Direct link to 17. На локальном компьютере, коммитим изменения в репозиторий" href="/docs/ru-posts/fullstack/2024-08-22#17-на-локальном-компьютере-коммитим-изменения-в-репозиторий">​</a></h3>
<p><em>Команды</em></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git commit -m &quot;fix: some updates&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git push</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="18-подключаемся-к-удаленному-серверу-получаем-новые-изменения-и-останавливаем-pm2-и-docker-compose-режимы">18. Подключаемся к удаленному серверу, получаем новые изменения и останавливаем &quot;PM2&quot; и &quot;Docker Compose&quot; режимы<a class="hash-link" aria-label="Direct link to 18. Подключаемся к удаленному серверу, получаем новые изменения и останавливаем &quot;PM2&quot; и &quot;Docker Compose&quot; режимы" title="Direct link to 18. Подключаемся к удаленному серверу, получаем новые изменения и останавливаем &quot;PM2&quot; и &quot;Docker Compose&quot; режимы" href="/docs/ru-posts/fullstack/2024-08-22#18-подключаемся-к-удаленному-серверу-получаем-новые-изменения-и-останавливаем-pm2-и-docker-compose-режимы">​</a></h3>
<p><em>Команды</em></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh root@194.226.49.162</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd nestjs-mod-fullstack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm run pm2-full:prod:stop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm run docker-compose-full:prod:stop</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="19-перезапускаем-все-приложения-в-режиме-docker-compose-и-прогоняем-e2e-тесты-адрес-сервера-указываем-httpsvps1724252356tech0ru">19. Перезапускаем все приложения в режиме &quot;Docker Compose&quot; и прогоняем E2E-тесты, адрес сервера указываем <a href="https://vps1724252356.tech0.ru" target="_blank" rel="noopener noreferrer">https://vps1724252356.tech0.ru</a><a class="hash-link" aria-label="Direct link to 19-перезапускаем-все-приложения-в-режиме-docker-compose-и-прогоняем-e2e-тесты-адрес-сервера-указываем-httpsvps1724252356tech0ru" title="Direct link to 19-перезапускаем-все-приложения-в-режиме-docker-compose-и-прогоняем-e2e-тесты-адрес-сервера-указываем-httpsvps1724252356tech0ru" href="/docs/ru-posts/fullstack/2024-08-22#19-перезапускаем-все-приложения-в-режиме-docker-compose-и-прогоняем-e2e-тесты-адрес-сервера-указываем-httpsvps1724252356tech0ru">​</a></h3>
<p><em>Команды</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npm run docker-compose-full:prod:start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export BASE_URL=https://vps1724252356.tech0.ru &amp;&amp; npm run test:e2e</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>Вывод консоли</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@vps1724252356:~/nestjs-mod-fullstack# npm run docker-compose-full:prod:start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 docker-compose-full:prod:start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; export NX_DAEMON=false &amp;&amp; export DISABLE_SERVE_STATIC=true &amp;&amp; npm run generate &amp;&amp; npm run build -- -c production &amp;&amp; npm run docker:build:server:latest &amp;&amp; export COMPOSE_INTERACTIVE_NO_CLI=1 &amp;&amp; docker compose -f ./.docker/docker-compose-full.yml --env-file ./.docker/docker-compose-full.env --compatibility up -d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 generate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ./node_modules/.bin/nx run-many --exclude=@nestjs-mod-fullstack/source --all -t=generate --skip-nx-cache=true &amp;&amp; npm run make-ts-list &amp;&amp; npm run lint:fix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run server:generate (42s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Successfully ran target generate for project server (42s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 make-ts-list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ./node_modules/.bin/rucken make-ts-list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 lint:fix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; npm run tsc:lint &amp;&amp; ./node_modules/.bin/nx run-many --exclude=@nestjs-mod-fullstack/source --all -t=lint --fix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 tsc:lint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ./node_modules/.bin/tsc --noEmit -p tsconfig.base.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run app-angular-rest-sdk:lint  [existing outputs match the cache, left as is]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run server:lint  [existing outputs match the cache, left as is]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run client:lint  [existing outputs match the cache, left as is]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run server-e2e:lint  [existing outputs match the cache, left as is]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Successfully ran target lint for 4 projects (357ms)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      With additional flags:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --fix=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Nx read the output from the cache instead of running the command for 4 out of 4 tasks.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; npm run generate &amp;&amp; npm run tsc:lint &amp;&amp; ./node_modules/.bin/nx run-many --exclude=@nestjs-mod-fullstack/source --all -t=build --skip-nx-cache=true -c production</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 generate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ./node_modules/.bin/nx run-many --exclude=@nestjs-mod-fullstack/source --all -t=generate --skip-nx-cache=true &amp;&amp; npm run make-ts-list &amp;&amp; npm run lint:fix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run server:generate (38s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Successfully ran target generate for project server (38s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 make-ts-list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ./node_modules/.bin/rucken make-ts-list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 lint:fix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; npm run tsc:lint &amp;&amp; ./node_modules/.bin/nx run-many --exclude=@nestjs-mod-fullstack/source --all -t=lint --fix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 tsc:lint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ./node_modules/.bin/tsc --noEmit -p tsconfig.base.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run app-angular-rest-sdk:lint  [existing outputs match the cache, left as is]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run server:lint  [existing outputs match the cache, left as is]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run client:lint  [existing outputs match the cache, left as is]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run server-e2e:lint  [existing outputs match the cache, left as is]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Successfully ran target lint for 4 projects (350ms)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      With additional flags:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --fix=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Nx read the output from the cache instead of running the command for 4 out of 4 tasks.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 tsc:lint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ./node_modules/.bin/tsc --noEmit -p tsconfig.base.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run app-rest-sdk:build (8s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run app-angular-rest-sdk:build:production (9s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run server:build:production (13s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run client:build:production (19s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Successfully ran target build for 4 projects (28s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 docker:build:server:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; docker build -t nestjs-mod-fullstack-server:latest -f ./.docker/server.Dockerfile . --progress=plain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#0 building with &quot;default&quot; instance using docker driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#1 [internal] load build definition from server.Dockerfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#1 transferring dockerfile: 1.65kB done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#1 DONE 0.0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#2 [internal] load metadata for docker.io/library/node:20.16.0-alpine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#2 DONE 1.2s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#3 [internal] load .dockerignore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#3 transferring context: 79B 0.0s done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#3 DONE 0.0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#4 [builder 1/7] FROM docker.io/library/node:20.16.0-alpine@sha256:eb8101caae9ac02229bd64c024919fe3d4504ff7f329da79ca60a04db08cef52</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#4 DONE 0.0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#5 [internal] load build context</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#5 transferring context: 1.20MB 0.2s done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#5 DONE 0.2s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#6 [builder 2/7] WORKDIR /usr/src/app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#6 CACHED</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#7 [builder 3/7] COPY . .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#7 DONE 0.2s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#8 [builder 4/7] RUN apk add dumb-init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#8 0.630 fetch https://dl-cdn.alpinelinux.org/alpine/v3.20/main/x86_64/APKINDEX.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#8 1.055 fetch https://dl-cdn.alpinelinux.org/alpine/v3.20/community/x86_64/APKINDEX.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#8 1.791 (1/1) Installing dumb-init (1.2.5-r3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#8 1.820 Executing busybox-1.36.1-r29.trigger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#8 1.836 OK: 11 MiB in 17 packages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#8 DONE 2.0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#9 [builder 5/7] RUN apk add jq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#9 1.136 (1/2) Installing oniguruma (6.9.9-r0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#9 1.302 (2/2) Installing jq (1.7.1-r0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#9 1.361 Executing busybox-1.36.1-r29.trigger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#9 1.379 OK: 12 MiB in 19 packages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#9 DONE 1.7s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#10 [builder 6/7] RUN echo $(cat package.json | jq &#x27;del(.devDependencies)&#x27;) &gt; package.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#10 DONE 0.5s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 [builder 7/7] RUN rm -rf nx.json package-lock.json .dockerignore &amp;&amp;     cp .docker/nx.json nx.json &amp;&amp;     cp .docker/.dockerignore .dockerignore &amp;&amp;     npm install &amp;&amp;     npm install --save-dev nx@19.5.3 prisma@5.18.0 prisma-class-generator@0.2.11 &amp;&amp;     echo &#x27;&#x27; &gt; .env &amp;&amp;     npm run prisma:generate &amp;&amp;     rm -rf /usr/src/app/node_modules/@nx &amp;&amp;     rm -rf /usr/src/app/node_modules/@prisma-class-generator &amp;&amp;     rm -rf /usr/src/app/node_modules/@angular  &amp;&amp;     rm -rf /usr/src/app/node_modules/@swc  &amp;&amp;     rm -rf /usr/src/app/node_modules/@babel  &amp;&amp;     rm -rf /usr/src/app/node_modules/@angular-devkit &amp;&amp;     rm -rf /usr/src/app/node_modules/@ngneat &amp;&amp;     rm -rf /usr/src/app/node_modules/@types &amp;&amp;     rm -rf /usr/src/app/node_modules/@ng-packagr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 112.9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 112.9 added 408 packages, and audited 409 packages in 2m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 112.9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 112.9 53 packages are looking for funding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 112.9   run `npm fund` for details</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 112.9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 112.9 5 moderate severity vulnerabilities</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 112.9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 112.9 To address all issues (including breaking changes), run:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 112.9   npm audit fix --force</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 112.9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 112.9 Run `npm audit` for details.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 112.9 npm notice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 112.9 npm notice New patch version of npm available! 10.8.1 -&gt; 10.8.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 112.9 npm notice Changelog: https://github.com/npm/cli/releases/tag/v10.8.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 112.9 npm notice To update run: npm install -g npm@10.8.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 112.9 npm notice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 166.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 166.3 added 106 packages, and audited 515 packages in 53s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 166.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 166.3 66 packages are looking for funding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 166.3   run `npm fund` for details</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 166.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 166.4 5 moderate severity vulnerabilities</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 166.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 166.4 To address all issues (including breaking changes), run:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 166.4   npm audit fix --force</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 166.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 166.4 Run `npm audit` for details.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 166.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 166.7 &gt; @nestjs-mod-fullstack/source@0.0.0 prisma:generate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 166.7 &gt; ./node_modules/.bin/nx run-many -t=prisma-generate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 166.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 169.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 169.4  NX   Running target prisma-generate for project server:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 169.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 169.4 - server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 169.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 169.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 177.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 177.6 &gt; nx run server:prisma-generate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 177.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 177.6 &gt; ./node_modules/.bin/prisma generate --schema=./apps/server/src/prisma/app-schema.prisma</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 177.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 177.6 Environment variables loaded from .env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 177.6 Prisma schema loaded from apps/server/src/prisma/app-schema.prisma</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 177.6 prisma:info [Prisma Class Generator]:Handler Registered.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 177.6 prisma:info [Prisma Class Generator]:Generate /usr/src/app/apps/server/src/app/generated/rest/dto/app_demo.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 177.6 prisma:info [Prisma Class Generator]:Generate /usr/src/app/apps/server/src/app/generated/rest/dto/migrations.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 177.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 177.6 ✔ Generated Prisma Client (v5.18.0, engine=binary) to ./node_modules/@prisma/app-client in 308ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 177.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 177.6 ✔ Generated Prisma Class Generator to ./apps/server/src/app/generated/rest/dto in 408ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 177.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 177.6 Start by importing your Prisma Client (See: http://pris.ly/d/importing-client)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 177.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 177.6 Tip: Easily identify and fix slow SQL queries in your app. Optimize helps you enhance your visibility: https://pris.ly/--optimize</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 177.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 177.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 177.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 177.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 177.6  NX   Successfully ran target prisma-generate for project server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 177.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 177.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#11 DONE 178.9s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#12 [stage-1 3/4] COPY --from=builder /usr/src/app/ /usr/src/app/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#12 DONE 8.3s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#13 [stage-1 4/4] COPY --from=builder /usr/bin/dumb-init /usr/bin/dumb-init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#13 DONE 0.1s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#14 exporting to image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#14 exporting layers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#14 exporting layers 8.7s done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#14 writing image sha256:049c6f471ddfe18b811e6aac12cccd777dfab0bb1d599b00c91beb51d1ff188f done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#14 naming to docker.io/library/nestjs-mod-fullstack-server:latest done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#14 DONE 8.7s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WARN[0000] /root/nestjs-mod-fullstack/.docker/docker-compose-full.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Running 5/5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✔ Container nestjs-mod-fullstack-postgre-sql             Healthy                                                                                                13.9s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✔ Container nestjs-mod-fullstack-postgre-sql-migrations  Exited                                                                                                 30.9s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✔ Container nestjs-mod-fullstack-server                  Healthy                                                                                                65.1s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✔ Container nestjs-mod-fullstack-nginx                   Started                                                                                                65.1s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✔ Container nestjs-mod-fullstack-https-portal            Started                                                                                                65.2s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@vps1724252356:~/nestjs-mod-fullstack# export BASE_URL=https://vps1724252356.tech0.ru &amp;&amp; npm run test:e2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 test:e2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ./node_modules/.bin/nx run-many --exclude=@nestjs-mod-fullstack/source --all -t=e2e --skip-nx-cache=true --output-style=stream-without-prefixes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; nx run client-e2e:e2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; playwright test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Running target e2e for 2 projects and 1 task they depend on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Running target e2e for 2 projects and 1 task they depend on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   →  Executing 1/3 remaining tasks...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run client-e2e:e2e (25s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run server:build:production (14s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Running target e2e for 2 projects and 1 task they depend on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   →  Executing 1/1 remaining tasks...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ⠹  nx run server-e2e:e2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  2/2 succeeded [0 read from cache]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> PASS   server-e2e  apps/server-e2e/src/server/server.spec.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  GET /api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ✓ should return a message (160 ms)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run server-e2e:e2e (10s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Successfully ran target e2e for 2 projects and 1 task they depend on (50s)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="20-перезапускаем-все-приложения-в-режиме-pm2-продакшен-и-прогоняем-e2e-тесты-адрес-сервера-указываем-httpvps1724252356tech0ru3000">20. Перезапускаем все приложения в режиме PM2-продакшен и прогоняем E2E-тесты, адрес сервера указываем <a href="http://vps1724252356.tech0.ru:3000" target="_blank" rel="noopener noreferrer">http://vps1724252356.tech0.ru:3000</a><a class="hash-link" aria-label="Direct link to 20-перезапускаем-все-приложения-в-режиме-pm2-продакшен-и-прогоняем-e2e-тесты-адрес-сервера-указываем-httpvps1724252356tech0ru3000" title="Direct link to 20-перезапускаем-все-приложения-в-режиме-pm2-продакшен-и-прогоняем-e2e-тесты-адрес-сервера-указываем-httpvps1724252356tech0ru3000" href="/docs/ru-posts/fullstack/2024-08-22#20-перезапускаем-все-приложения-в-режиме-pm2-продакшен-и-прогоняем-e2e-тесты-адрес-сервера-указываем-httpvps1724252356tech0ru3000">​</a></h3>
<p><em>Команды</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npm run pm2-full:prod:start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export BASE_URL=http://vps1724252356.tech0.ru:3000 &amp;&amp; npm run test:e2e</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>Вывод консоли</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@vps1724252356:~/nestjs-mod-fullstack# npm run pm2-full:prod:start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 pm2-full:prod:start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; npm run generate &amp;&amp; npm run build -- -c production &amp;&amp; npm run docker-compose:start-prod:server &amp;&amp; npm run db:create &amp;&amp; npm run flyway:migrate &amp;&amp; npm run pm2:start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 generate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ./node_modules/.bin/nx run-many --exclude=@nestjs-mod-fullstack/source --all -t=generate --skip-nx-cache=true &amp;&amp; npm run make-ts-list &amp;&amp; npm run lint:fix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run server:generate (1m)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————— ———————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Successfully ran target generate for project server (1m)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 make-ts-list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ./node_modules/.bin/rucken make-ts-list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 lint:fix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; npm run tsc:lint &amp;&amp; ./node_modules/.bin/nx run-many --exclude=@nestjs-mod-fullstack/source --all -t=lint --fix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 tsc:lint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ./node_modules/.bin/tsc --noEmit -p tsconfig.base.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run app-angular-rest-sdk:lint  [existing outputs match the cache, left as is]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run client:lint  [existing outputs match the cache, left as is]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run server-e2e:lint  [existing outputs match the cache, left as is]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run server:lint (4s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Successfully ran target lint for 4 projects (5s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      With additional flags:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --fix=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Nx read the output from the cache instead of running the command for 3 out of 4 tasks.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; npm run generate &amp;&amp; npm run tsc:lint &amp;&amp; ./node_modules/.bin/nx run-many --exclude=@nestjs-mod-fullstack/source --all -t=build --skip-nx-cache=true -c production</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 generate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ./node_modules/.bin/nx run-many --exclude=@nestjs-mod-fullstack/source --all -t=generate --skip-nx-cache=true &amp;&amp; npm run make-ts-list &amp;&amp; npm run lint:fix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run server:generate (43s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Successfully ran target generate for project server (43s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 make-ts-list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ./node_modules/.bin/rucken make-ts-list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 lint:fix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; npm run tsc:lint &amp;&amp; ./node_modules/.bin/nx run-many --exclude=@nestjs-mod-fullstack/source --all -t=lint --fix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 tsc:lint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ./node_modules/.bin/tsc --noEmit -p tsconfig.base.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run app-angular-rest-sdk:lint  [existing outputs match the cache, left as is]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run client:lint  [existing outputs match the cache, left as is]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run server:lint  [existing outputs match the cache, left as is]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run server-e2e:lint  [existing outputs match the cache, left as is]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">———————————————————————————————————————————————————————————————————————————————————————————————————— ——————————————————————————————————————————————————————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Successfully ran target lint for 4 projects (373ms)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      With additional flags:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --fix=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Nx read the output from the cache instead of running the command for 4 out of 4 tasks.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 tsc:lint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ./node_modules/.bin/tsc --noEmit -p tsconfig.base.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run app-rest-sdk:build (1m)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run app-angular-rest-sdk:build:production (1m)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run server:build:production (1m)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run client:build:production (23s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Successfully ran target build for 4 projects (2m)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 docker-compose:start-prod:server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; export COMPOSE_INTERACTIVE_NO_CLI=1 &amp;&amp; docker compose -f ./apps/server/docker-compose-prod.yml --env-file ./apps/server/docker-compose-prod.env --compatibility up -d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WARN[0000] /root/nestjs-mod-fullstack/apps/server/docker-compose-prod.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Running 1/1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✔ Container server-postgre-sql  Started                                                                                                                          0.7s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 db:create</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ./node_modules/.bin/nx run-many -t=db-create</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run server:db-create (3s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Successfully ran target db-create for project server (4s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 flyway:migrate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ./node_modules/.bin/nx run-many -t=flyway-migrate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run server:flyway-migrate (5s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————  ———————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Successfully ran target flyway-migrate for project server (5s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 pm2:start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ./node_modules/.bin/pm2 start ./ecosystem-prod.config.json &amp;&amp; npm run wait-on -- --log http://localhost:3000/api/health --log http://localhost:3000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[PM2] Spawning PM2 daemon with pm2_home=/root/.pm2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[PM2] PM2 Successfully daemonized</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[PM2][WARN] Applications nestjs-mod-fullstack not running, starting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[PM2] App [nestjs-mod-fullstack] launched (1 instances)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌────┬─────────────────────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬────── ─────┬──────────┬──────────┬──────────┬──────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ id │ name                    │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├────┼─────────────────────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ 0  │ nestjs-mod-fullstack    │ default     │ N/A     │ fork    │ 505154   │ 0s     │ 0    │ online    │ 0%       │ 28.8mb   │ root     │ disabled │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└────┴─────────────────────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 wait-on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ./node_modules/.bin/wait-on --timeout=240000 --interval=1000 --window --verbose --log http://localhost:3000/api/health --log http://localhost:3000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">waiting for 2 resources: http://localhost:3000/api/health, http://localhost:3000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">making HTTP(S) head request to  url:http://localhost:3000/api/health ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">making HTTP(S) head request to  url:http://localhost:3000 ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HTTP(S) error for http://localhost:3000/api/health AggregateError</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HTTP(S) error for http://localhost:3000 AggregateError</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">making HTTP(S) head request to  url:http://localhost:3000/api/health ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">making HTTP(S) head request to  url:http://localhost:3000 ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HTTP(S) error for http://localhost:3000/api/health AggregateError</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HTTP(S) error for http://localhost:3000 AggregateError</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">making HTTP(S) head request to  url:http://localhost:3000/api/health ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HTTP(S) error for http://localhost:3000/api/health AggregateError</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">making HTTP(S) head request to  url:http://localhost:3000 ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HTTP(S) error for http://localhost:3000 AggregateError</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">making HTTP(S) head request to  url:http://localhost:3000/api/health ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">making HTTP(S) head request to  url:http://localhost:3000 ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HTTP(S) result for http://localhost:3000/api/health: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  status: 200,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  statusText: &#x27;OK&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  headers: Object [AxiosHeaders] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;x-powered-by&#x27;: &#x27;Express&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vary: &#x27;Origin&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;access-control-allow-credentials&#x27;: &#x27;true&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;x-request-id&#x27;: &#x27;bd416d0d-2e53-4f4a-8402-58e367c833c5&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;cache-control&#x27;: &#x27;no-cache, no-store, must-revalidate&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;content-type&#x27;: &#x27;application/json; charset=utf-8&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;content-length&#x27;: &#x27;107&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    etag: &#x27;W/&quot;6b-ouXVoNOXyOxnMfI7caewF8/p97A&quot;&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    date: &#x27;Thu, 22 Aug 2024 18:58:09 GMT&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    connection: &#x27;keep-alive&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;keep-alive&#x27;: &#x27;timeout=5&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  data: &#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">waiting for 1 resources: http://localhost:3000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HTTP(S) result for http://localhost:3000: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  status: 200,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  statusText: &#x27;OK&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  headers: Object [AxiosHeaders] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;x-powered-by&#x27;: &#x27;Express&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vary: &#x27;Origin&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;access-control-allow-credentials&#x27;: &#x27;true&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;accept-ranges&#x27;: &#x27;bytes&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;cache-control&#x27;: &#x27;public, max-age=0&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;last-modified&#x27;: &#x27;Thu, 22 Aug 2024 18:57:47 GMT&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    etag: &#x27;W/&quot;8e8-1917b73ba3d&quot;&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;content-type&#x27;: &#x27;text/html; charset=UTF-8&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;content-length&#x27;: &#x27;2280&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    date: &#x27;Thu, 22 Aug 2024 18:58:09 GMT&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    connection: &#x27;keep-alive&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;keep-alive&#x27;: &#x27;timeout=5&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  data: &#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wait-on(505210) complete</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@vps1724252356:~/nestjs-mod-fullstack# export BASE_URL=http://vps1724252356.tech0.ru:3000 &amp;&amp; npm run test:e2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 test:e2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ./node_modules/.bin/nx run-many --exclude=@nestjs-mod-fullstack/source --all -t=e2e --skip-nx-cache=true --output-style=stream-without-prefixes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; nx run client-e2e:e2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; playwright test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Running target e2e for 2 projects and 1 task they depend on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Running target e2e for 2 projects and 1 task they depend on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   →  Executing 1/3 remaining tasks...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run client-e2e:e2e (39s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————— ——————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run server:build:production (16s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Running target e2e for 2 projects and 1 task they depend on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   →  Executing 1/1 remaining tasks...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ⠴  nx run server-e2e:e2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  2/2 succeeded [0 read from cache]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> PASS   server-e2e  apps/server-e2e/src/server/server.spec.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  GET /api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ✓ should return a message (74 ms)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run server-e2e:e2e (11s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————  ————————————————————————————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Successfully ran target e2e for 2 projects and 1 task they depend on (1m)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-настраиваем-автоматический-перезапуск-pm2-продакшен-режима-при-перезагрузке-выделенного-сервера">21. Настраиваем автоматический перезапуск PM2-продакшен режима при перезагрузке выделенного сервера<a class="hash-link" aria-label="Direct link to 21. Настраиваем автоматический перезапуск PM2-продакшен режима при перезагрузке выделенного сервера" title="Direct link to 21. Настраиваем автоматический перезапуск PM2-продакшен режима при перезагрузке выделенного сервера" href="/docs/ru-posts/fullstack/2024-08-22#21-настраиваем-автоматический-перезапуск-pm2-продакшен-режима-при-п ерезагрузке-выделенного-сервера">​</a></h3>
<p><em>Команды</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./node_modules/.bin/pm2 startup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./node_modules/.bin/pm2 save</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>Вывод консоли</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@vps1724252356:~/nestjs-mod-fullstack# ./node_modules/.bin/pm2 startup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[PM2] Init System found: systemd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Platform systemd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Template</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Unit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Description=PM2 process manager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Documentation=https://pm2.keymetrics.io/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">After=network.target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Service]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Type=forking</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User=root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LimitNOFILE=infinity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LimitNPROC=infinity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LimitCORE=infinity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Environment=PATH=/root/.vscode-server/cli/servers/Stable-fee1edb8d6d72a0ddff41e5f71a671c23ed924b9/server/bin/remote-cli:/root/.nvm/versions/node/v20.16.0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Environment=PM2_HOME=/root/.pm2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PIDFile=/root/.pm2/pm2.pid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Restart=on-failure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExecStart=/root/nestjs-mod-fullstack/node_modules/pm2/bin/pm2 resurrect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExecReload=/root/nestjs-mod-fullstack/node_modules/pm2/bin/pm2 reload all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExecStop=/root/nestjs-mod-fullstack/node_modules/pm2/bin/pm2 kill</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Install]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WantedBy=multi-user.target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Target path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/systemd/system/pm2-root.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Command list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ &#x27;systemctl enable pm2-root&#x27; ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[PM2] Writing init configuration in /etc/systemd/system/pm2-root.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[PM2] Making script booting at startup...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[PM2] [-] Executing: systemctl enable pm2-root...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Created symlink /etc/systemd/system/multi-user.target.wants/pm2-root.service → /etc/systemd/system/pm2-root.service.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[PM2] [v] Command successfully executed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[PM2] Freeze a process list on reboot via:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ pm2 save</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[PM2] Remove init script via:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ pm2 unstartup systemd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@vps1724252356:~/nestjs-mod-fullstack# ./node_modules/.bin/pm2 save</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[PM2] Saving current process list...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[PM2] Successfully saved in /root/.pm2/dump.pm2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-перезагружаем-и-проверяем-через-e2e-тест-работу-обоих-режимом">22. Перезагружаем и проверяем через E2E-тест работу обоих режимом<a class="hash-link" aria-label="Direct link to 22. Перезагружаем и проверяем через E2E-тест работу обоих режимом" title="Direct link to 22. Перезагружаем и проверяем через E2E-тест работу обоих режимом" href="/docs/ru-posts/fullstack/2024-08-22#22-перезагружаем-и-проверяем-через-e2e-тест-работу-обоих-режимом">​</a></h3>
<p><em>Команды</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo reboot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd nestjs-mod-fullstack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export BASE_URL=http://vps1724252356.tech0.ru:3000 &amp;&amp; npm run test:e2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export BASE_URL=https://vps1724252356.tech0.ru &amp;&amp; npm run test:e2e</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>Вывод консоли</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@vps1724252356:~/nestjs-mod-fullstack# export BASE_URL=http://vps1724252356.tech0.ru:3000 &amp;&amp; npm run test:e2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 test:e2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ./node_modules/.bin/nx run-many --exclude=@nestjs-mod-fullstack/source --all -t=e2e --skip-nx-cache=true --output-style=stream-without-prefixes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; nx run client-e2e:e2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; playwright test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Running target e2e for 2 projects and 1 task they depend on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Running target e2e for 2 projects and 1 task they depend on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   →  Executing 1/3 remaining tasks...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run client-e2e:e2e (29s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">—————————————————————————————————————————————————————————————————————————————————————————————————————————————————  ——————————————————————————————————————————————————————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run server:build:production (15s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Running target e2e for 2 projects and 1 task they depend on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   →  Executing 1/1 remaining tasks...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ⠏  nx run server-e2e:e2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  2/2 succeeded [0 read from cache]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> PASS   server-e2e  apps/server-e2e/src/server/server.spec.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  GET /api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ✓ should return a message (73 ms)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✔  nx run server-e2e:e2e (12s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Successfully ran target e2e for 2 projects and 1 task they depend on (56s)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>В следующем посте я добавлю CI/CD конфиг для деплоя на выделенный сервер с помощью GitHub Actions...</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ссылки">Ссылки<a class="hash-link" aria-label="Direct link to Ссылки" title="Direct link to Ссылки" href="/docs/ru-posts/fullstack/2024-08-22#ссылки">​</a></h3>
<ul>
<li><a href="https://nestjs.com" target="_blank" rel="noopener noreferrer">https://nestjs.com</a> - официальный сайт фреймворка</li>
<li><a href="https://nestjs-mod.com" target="_blank" rel="noopener noreferrer">https://nestjs-mod.com</a> - официальный сайт дополнительных утилит</li>
<li><a href="https://github.com/nestjs-mod/nestjs-mod-fullstack" target="_blank" rel="noopener noreferrer">https://github.com/nestjs-mod/nestjs-mod-fullstack</a> - проект из поста</li>
<li><a href="https://github.com/nestjs-mod/nestjs-mod-fullstack/commit/b9715a203364877a4ffae6e7cb3a1dff59ede6d6" target="_blank" rel="noopener noreferrer">https://github.com/nestjs-mod/nestjs-mod-fullstack/commit/b9715a203364877a4ffae6e7cb3a1dff59ede6d6</a> - коммит на текущие изменения</li>
</ul>
<p>#pm2 #docker #nestjsmod #fullstack
#2024-08-22</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/nestjs-mod/nestjs-mod.com/blob/master/docs/ru-posts/fullstack/2024-08-22.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/ru-posts/fullstack/2024-08-20"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Сборка приложений на NestJS и Angular и запуск их в двух вариантах: через PM2 и через &quot;Docker Compose&quot;</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/ru-posts/fullstack/2024-08-26"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Добавляем CI/CD конфиг для деплоя NestJS и Angular приложений на выделенный сервер с помощью GitHub Actions</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-08-22#1-находим-бесплатный-или-покупаем-выделенный-сервер">1. Находим бесплатный или покупаем выделенный сервер</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-08-22#2-настройка-подключение-к-выделенному-серверу-по-ssh">2. Настройка подключение к выделенному серверу по SSH</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-08-22#3-подключение-к-удаленному-серверу">3. Подключение к удаленному серверу</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-08-22#4-установка-всех-необходимых-паке тов-на-выделенный-сервер">4. Установка всех необходимых пакетов на выделенный сервер</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-08-22#5-генерация-ssh-ключа-на-выделенном-сервере">5. Генерация SSH-ключа на выделенном сервере</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-08-22#6-привязка-публичного-ключа-выдленного-сервера-к-github">6. Привязка публичного ключа выдленного сервера к GitHub</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-08-22#7-клонируем-проект">7. Клонируем проект</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-08-22#8-устанавливаем-зависимости-и-прогоняем-запуск-и-тестирование-двух-режимов-pm2-продакшен-и-docker-compose">8. Устанавливаем зависимости и прогоняем запуск и тестирование двух режимов: PM2-продакшен и &quot;Docker Compose&quot;</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-08-22#9-на-локальном-компьютере-обновляем-и-добавляем-новые-npm-скрипты">9. На локальном компьютере, обновляем и добавляем новые npm-скрипты</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-08-22#10-на-локальном-компьютере-обновляем-параметры-контейнера-с-миграциями-в-docker-compose---файле">10. На локальном компьютере, обновляем пар аметры контейнера с миграциями в &quot;Docker Compose&quot; - файле</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-08-22#11-на-локальном-компьютере-открываем-доступ-к-swagger-интерфейсу-бэкенда-в-nginx">11. На локальном компьютере, открываем доступ к Swagger-интерфейсу бэкенда в Nginx</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-08-22#12-на-локальном-компьютере-добавляем-возможность-отключения-nestjs-модуля-по-выдаче-статики">12. На локальном компьютере, добавляем возможность отключения NestJS модуля по выдаче статики</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-08-22#13-на-локальном-компьютере-повтороно-прогоняем-запуск-и-тестирование-двух-режимов-pm2-продакшен-и-docker-compose">13. На локальном компьютере, повтороно прогоняем запуск и тестирование двух режимов: PM2-продакшен и &quot;Docker Compose&quot;</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-08-22#14-на-локальном-компьютере-добавляем-дополнительный-контейнер-с-https-portal-в-docker-compose-fullyml-для-проксирования-http-в-https-и-добавляем-во-все-кроме-migrations-контейнеры-опцию-restart-always">14. На локальном компьютере, добавляем дополнительный контейнер с <code>https-portal</code> в <code>docker-compose-full.yml</code> для проксирования <code>http</code> в <code>https</code> и добавляем во все (кроме migrations) контейнеры опцию <code>restart: &#39;always&#39;</code></a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-08-22#15-на-локальном-компьютере-добавляем-новую-переменную-окружения-с-нашим-доменом-vps1724252356tech0ru">15. На локальном компьютере, добавляем новую переменную окружения с нашим доменом vps1724252356.tech0.ru</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-08-22#17-на-локальном-компьютере-коммитим-изменения-в-репозиторий">17. На локальном компьютере, коммитим изменения в репозиторий</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-08-22#18-подключаемся-к-удаленному-серверу-получаем-новые-изменения-и-останавливаем-pm2-и-docker-compose-режимы">18. Подключаемся к удаленному серверу, получаем новые изменения и останавливаем &quot;PM2&quot; и &quot;Docker Compose&quot; режимы</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-08-22#19-перезапускаем-все-приложения-в-режиме-docker-compose-и-прогоняем-e2e-тесты-адрес-сервера-указываем-httpsvps1724252356tech0ru">19. Перезапускаем все приложения в режиме &quot;Docker Compose&quot; и прогоняем E2E-тесты, адрес сервера указываем https://vps1724252356.tech0.ru</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-08-22#20-перезапускаем-все-приложения-в-режиме-pm2-продакшен-и-прогоняем-e2e-тесты-адрес-сервера-указываем-httpvps1724252356tech0ru3000">20. Перезапускаем все приложения в режиме PM2-продакшен и прогоняем E2E-тесты, адрес сервера указываем http://vps1724252356.tech0.ru:3000</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-08-22#21-настраиваем-автоматический-перезапуск-pm2-продакшен-режима-при-перезагрузке-выделенного-сервера">21. Настраиваем автоматический перезапуск PM2-продакшен режима при перезагрузке выделенного сервера</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-08-22#22-перезагружаем-и-проверяем-через-e2e-тест-работу-обоих-режимом">22. Перезагружаем и проверяем через E2E-тест работу обоих режимом</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-08-22#ссылки">Ссылки</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/guides/introduction">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/drpg5rTmgG" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://t.me/nestjs_mod" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Links</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://dev.to/t/nestjsmod" target="_blank" rel="noopener noreferrer" class="footer__link-item">Posts on Dev.to<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://habr.com/ru/search/?q=[nestjsmod]" target="_blank" rel="noopener noreferrer" class="footer__link-item">Posts on Habr.com<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/nestjs-mod" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.npmjs.com/org/nestjs-mod" target="_blank" rel="noopener noreferrer" class="footer__link-item">NPM<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 NestJS-mod</div></div></div></footer></div>
</body>
</html>