<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-ru-posts/fullstack/2024-09-08" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Ускорение деплоя NestJS и Angular с помощью общественных Github-раннеров и создания промежуточных Docker-образов | NestJS-mod</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://nestjs-mod.com/img/fon-nest.png"><meta data-rh="true" name="twitter:image" content="https://nestjs-mod.com/img/fon-nest.png"><meta data-rh="true" property="og:url" content="https://nestjs-mod.com/docs/ru-posts/fullstack/2024-09-08"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Ускорение деплоя NestJS и Angular с помощью общественных Github-раннеров и создания промежуточных Docker-образов | NestJS-mod"><meta data-rh="true" name="description" content="В этом посте я настрою сборку Docker-образов:"><meta data-rh="true" property="og:description" content="В этом посте я настрою сборку Docker-образов:"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://nestjs-mod.com/docs/ru-posts/fullstack/2024-09-08"><link data-rh="true" rel="alternate" href="https://nestjs-mod.com/docs/ru-posts/fullstack/2024-09-08" hreflang="en"><link data-rh="true" rel="alternate" href="https://nestjs-mod.com/docs/ru-posts/fullstack/2024-09-08" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.4fd952a5.css">
<script src="/assets/js/runtime~main.805fa267.js" defer="defer"></script>
<script src="/assets/js/main.81132467.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="NestJS-mod" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="NestJS-mod" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">NestJS-mod</b></a><a class="navbar__item navbar__link" href="/docs/guides/introduction">Docs</a><a class="navbar__item navbar__link" href="/docs/category/common">Packages</a><a class="navbar__item navbar__link" href="/docs/category/fullstack">Posts</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/category/fullstack-1">Посты</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/nestjs-mod" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/fullstack-1">Fullstack</a><button aria-label="Collapse sidebar category &#x27;Fullstack&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-08-08">Созд ание пустого проекта с помощью NestJS-mod</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-08-09">Создание пустого Angular проекта и связь его с существующим сервером на NestJS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-08-11">Добавление базы данных Postgres в проект и запуск миграций через Flyway для NestJS-mod приложения</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-08-13">Подключение PrismaORM в NestJS-mod приложение и проверка его работы через REST</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-08-14-обновление-NestJS-mod-библиотек">Пример простого обновления NestJS-mod библиотек</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-08-14">Добавление Swagger документации в NestJS-mod приложение и генерация REST-клиента для Angular-приложения</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-08-20">Сборка приложений на NestJS и Angular и запуск их в двух вариантах: через PM2 и через &quot;Docker Compose&quot;</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-08-22">Ручной деплой NestJS и Angular приложений на выделенном сервер через &quot;Docker Compose&quot; и &quot;PM2&quot;</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-08-26">Добавляем CI/CD конфиг для деплоя NestJS и Angular приложений на выделенный сервер с помощью GitHub Actions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/ru-posts/fullstack/2024-09-08">Ускорение деплоя NestJS и Angular с помощью общественных Github-раннеров и создания промежуточных Docker-образов</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-09-13">Установка Kubernetes через MicroK8s и настройка деплоя NestJS и Angular приложений</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-09-15">Доступ к сайту на NestJS и Angular по доменному имени c SSL - сертификатом в Kubernetes через Ingress</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-09-16">Семантическое версионирование NestJS и Angular приложений в NX-монорепозитории</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-09-17">Добавляем lint-staged в NestJS и Angular приложения, включаем семантическое версионирование фронтенда</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-10-06">Создание конфигурируемого Webhook-модуля для NestJS-приложении</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-10-25">Создание пользовательского интерфейса для модуля Webhook с помощью Angular</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-11-08">Интеграция внешнего сервера авторизации https://authorizer.dev в фулстек приложение на NestJS и Angular</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ru-posts/fullstack/2024-11-15">Интеграция внешнего файлового сервера https://min.io в фулстек приложение на NestJS и Angular</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/fullstack-1"><span itemprop="name">Fullstack</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Ускорение деплоя NestJS и Angular с помощью общественных Github-раннеров и создания промежуточных Docker-образов</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Ускорение деплоя NestJS и Angular с помощью общественных Github-раннеров и создания промежуточных Docker-образов</h1>
<p>В этом посте я настрою сборку Docker-образов:</p>
<ul>
<li>Билдер NestJS и Angular приложений;</li>
<li>Мигратор баз данных с помощью Flyway;</li>
<li>Тест-раннер для запуска фронтенд и бэкенд E2E-тестов;</li>
<li>Nginx c встроенной статикой Angular приложения;</li>
<li>NestJS приложение.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-создаем-docker-образ-со-всеми-зависимостями">1. Создаем Docker-образ со всеми зависимостями<a class="hash-link" aria-label="Direct link to 1. Создаем Docker-образ со всеми зависимостями" title="Direct link to 1. Создаем Docker-образ со всеми зависимостями" href="/docs/ru-posts/fullstack/2024-09-08#1-создаем-docker-образ-со-всеми-зависимостями">​</a></h3>
<p>В данном посте код и Docker-образа будут собираться на публичных раннерах, которые имеют лимит в месяц по общему времени выполнения и при интенсивной разработке этот лимит можно легко исчерпать, так что нужно быть готовыми переехать на собственный раннер.</p>
<p>В предыдущем посте зависимости устанавливались на хост машину в которой и происходила сборка кода, это было сделано в качестве примера того как можно, но так делать не нужно.</p>
<p>На хост машину нужно ставить минимальное количество программ и библиотек, так как любой сторонний софт может нести в себе вредоносное ПО, поэтому сборку кода нужно производить внутри специализированного Docker-контейнера.</p>
<p>Так как зависимости мы устанавливаем редко, то можно создать специальный Docker-образ который будет использоваться при сборке кода.</p>
<p>Папка с исходными файлами для сборки и папка для собранных файлов монтируется как <code>volume</code> в контейнер при запуске.</p>
<p>Пересборка данного Docker-образа будет происходить при смене версии корневого <code>package.json</code>.</p>
<p>Создаем файл <code>.docker/builder.Dockerfile</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM node:20.16.0-alpine AS builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR /usr/src/app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy all files in repository to image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --chown=node:node . .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Install utils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN apk add dumb-init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Clean up</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN rm -rf /var/cache/apk/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Install deps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN npm install --prefer-offline --no-audit --progress=false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Some utilities require a &quot;.env&quot; file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN echo &#x27;&#x27; &gt; .env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM node:20.16.0-alpine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR /usr/src/app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Disable nx daemon</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV NX_DAEMON=false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Disable the statics server built into NestJS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV DISABLE_SERVE_STATIC=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy node_modules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/node_modules /usr/src/app/node_modules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy utility for &quot;To work as a PID 1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/bin/dumb-init /usr/bin/dumb-init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy the settings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/.docker/.dockerignore /usr/src/app/.dockerignore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/.docker/nx.json /usr/src/app/nx.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/package.json /usr/src/app/package.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/rucken.json /usr/src/app/rucken.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/tsconfig.base.json /usr/src/app/tsconfig.base.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/.env /usr/src/app/.env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy the settings for linting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/.nxignore /usr/src/app/.nxignore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/.eslintrc.json /usr/src/app/.eslintrc.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/.eslintignore /usr/src/app/.eslintignore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/.prettierignore /usr/src/app/.prettierignore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/.prettierrc /usr/src/app/.prettierrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/jest.config.ts /usr/src/app/jest.config.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/jest.preset.js /usr/src/app/jest.preset.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Install java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN apk add openjdk11-jre</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Clean up</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN rm -rf /var/cache/apk/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># We build the source code as the &quot;node&quot; user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># and set permissions for new files: full access from outside the container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMD npm run build:prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Для сборки кода, необходимо запустить контейнер с данным образом и смонтировать директории <code>apps</code>, <code>libs</code> и <code>dist</code>.</p>
<p>Пример запуска:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker run -v ./dist:/usr/src/app/dist -v ./apps:/usr/src/app/apps -v ./libs:/usr/src/app/libs ghcr.io/nestjs-mod/nestjs-mod-fullstack-builder:latest</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-создаем-базовый-docker-образ-для-запуска-nestjs-приложения">2. Создаем базовый Docker-образ для запуска NestJS-приложения<a class="hash-link" aria-label="Direct link to 2. Создаем базовый Docker-образ для запуска NestJS-приложения" title="Direct link to 2. Создаем базовый Docker-образ для запуска NestJS-приложения" href="/docs/ru-posts/fullstack/2024-09-08#2-создаем-базовый-docker-образ-для-запуска-nestjs-приложения">​</a></h3>
<p>Данный образ будет включать зависимости используемые при работе NestJS-приложения, это необходимо для уменьшения итогового образа и для ускорения процесса деплоя.</p>
<p>Пересборка данного Docker-образа будет происходить при смене версии корневого <code>package.json</code>.</p>
<p>Создаем файл <code>.docker/base-server.Dockerfile</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM node:20.16.0-alpine AS builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR /usr/src/app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy all files in repository to image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --chown=node:node . .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Install utils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN apk add jq dumb-init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Clean up</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN rm -rf /var/cache/apk/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Remove dev dependencies info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN echo $(cat package.json | jq &#x27;del(.devDependencies)&#x27;) &gt; package.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Install deps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN npm install --prefer-offline --no-audit --progress=false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Installing utilities to generate additional files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN npm install --prefer-offline --no-audit --progress=false --save-dev nx@19.5.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN npm install --prefer-offline --no-audit --progress=false --save-dev prisma@5.18.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN npm install --prefer-offline --no-audit --progress=false --save-dev prisma-class-generator@0.2.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Some utilities require a &quot;.env&quot; file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN echo &#x27;&#x27; &gt; .env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM node:20.16.0-alpine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR /usr/src/app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy node_modules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/node_modules /usr/src/app/node_modules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy utility for &quot;To work as a PID 1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/bin/dumb-init /usr/bin/dumb-init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy the settings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/.docker/.dockerignore /usr/src/app/.dockerignore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/.docker/nx.json /usr/src/app/nx.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/package.json /usr/src/app/package.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/rucken.json /usr/src/app/rucken.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/tsconfig.base.json /usr/src/app/tsconfig.base.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/.env /usr/src/app/.env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-создаем-docker-образ-для-запуска-nestjs-приложения">3. Создаем Docker-образ для запуска NestJS-приложения<a class="hash-link" aria-label="Direct link to 3. Создаем Docker-образ для запуска NestJS-приложения" title="Direct link to 3. Создаем Docker-образ для запуска NestJS-приложения" href="/docs/ru-posts/fullstack/2024-09-08#3-создаем-docker-образ-для-запуска-nestjs-приложения">​</a></h3>
<p>Так как установку зависимостей мы производим при создании &quot;базового Docker-образа для запуска NestJS-приложения&quot;, а сборку кода производим через запуск &quot;Docker-образа со всеми зависимостями&quot;, то теперь необходимо это все соединить вместе.</p>
<p>Пересборка данного Docker-образа будет происходить при смене версии <code>apps/server/package.json</code>.</p>
<p>Создаем файл <code>.docker/server.Dockerfile</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ARG BASE_SERVER_IMAGE_TAG=latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ARG REGISTRY=ghcr.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ARG BASE_SERVER_IMAGE_NAME=nestjs-mod/nestjs-mod-fullstack-base-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM ${REGISTRY}/${BASE_SERVER_IMAGE_NAME}:${BASE_SERVER_IMAGE_TAG} AS builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR /usr/src/app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Disable nx daemon</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV NX_DAEMON=false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy the generated code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --chown=node:node ./dist ./dist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy prisma schema files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --chown=node:node ./apps ./apps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --chown=node:node ./libs ./libs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy the application&#x27;s package.json file to use its information at runtime.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --chown=node:node ./apps/server/package.json ./dist/apps/server/package.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Generating additional code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN npm run prisma:generate -- --verbose</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Remove unnecessary packages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN rm -rf /usr/src/app/node_modules/@nx &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rm -rf /usr/src/app/node_modules/@prisma-class-generator &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rm -rf /usr/src/app/node_modules/@angular  &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rm -rf /usr/src/app/node_modules/@swc  &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rm -rf /usr/src/app/node_modules/@babel  &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rm -rf /usr/src/app/node_modules/@angular-devkit &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rm -rf /usr/src/app/node_modules/@ngneat &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rm -rf /usr/src/app/node_modules/@types &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rm -rf /usr/src/app/node_modules/@ng-packagr &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rm -rf /usr/src/app/apps &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rm -rf /usr/src/app/libs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM node:20.16.0-alpine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR /usr/src/app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Set server port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV SERVER_PORT=8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy all project files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/ /usr/src/app/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy utility for &quot;To work as a PID 1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/bin/dumb-init /usr/bin/dumb-init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Expose server port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE 8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Run server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMD [&quot;dumb-init&quot;,&quot;node&quot;, &quot;dist/apps/server/main.js&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-создаем-docker-образ-для-запуска-миграций-в-базы-данных">4. Создаем Docker-образ для запуска миграций в базы данных<a class="hash-link" aria-label="Direct link to 4. Создаем Docker-образ для запуска миграций в базы данных" title="Direct link to 4. Создаем Docker-образ для запуска миграций в базы данных" href="/docs/ru-posts/fullstack/2024-09-08#4-создаем-docker-образ-для-запуска-миграций-в-базы-данных">​</a></h3>
<p>Так как мы не хотим ставить лишние зависимости на хост машине, то для запуска миграций собираем Docker-образ с необходимыми зависимостями.</p>
<p>В своих проектах я использую мигратор &quot;Flyway&quot;, но для его работы нужно скачать дополнительные файлы которые сильно увеличивают итоговый образ, если взять другой мигратор, то образ будет меньше.</p>
<p>Файлы с миграциями не кладутся в сам образ, они лежат рядом с исходным кодом, который монтируется через <code>volume</code> в контейнер при старте.</p>
<p>Пересборка данного Docker-образа будет происходить при смене версии корневого <code>package.json</code>.</p>
<p>Создаем файл <code>.docker/migrations.Dockerfile</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM node:20-bullseye-slim AS builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR /usr/src/app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Disable nx daemon</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV NX_DAEMON=false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy all files in repository to image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --chown=node:node . .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy the settings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY ./.docker/migrations-package.json package.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY ./.docker/.dockerignore .dockerignore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY ./.docker/nx.json nx.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Install dependencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN rm -rf package-lock.json &amp;&amp; npm install --prefer-offline --no-audit --progress=false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Some utilities require a &quot;.env&quot; file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN echo &#x27;&#x27; &gt; .env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Generate additional files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN ./node_modules/.bin/flyway -c ./.flyway.js info || echo &#x27;skip flyway errors&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM node:20-bullseye-slim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR /usr/src/app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy node_modules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/node_modules /usr/src/app/node_modules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy the settings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/.docker/.dockerignore /usr/src/app/.dockerignore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/.docker/nx.json /usr/src/app/nx.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/package.json /usr/src/app/package.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/rucken.json /usr/src/app/rucken.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/tsconfig.base.json /usr/src/app/tsconfig.base.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/.env /usr/src/app/.env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy files for flyway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/tmp /usr/src/app/tmp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=builder /usr/src/app/.flyway.js /usr/src/app/.flyway.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy folders with migrations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># COPY --chown=node:node ./apps ./apps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># COPY --chown=node:node ./libs ./libs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMD [&quot;npm&quot;,&quot;run&quot;, &quot;db:create-and-fill&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Список зависимостей отличается от рутового списка это нужно для уменьшения итогового образа.</p>
<p>Создаем файл с необходимыми зависимостями <code>.docker/migrations-package.json</code></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;name&quot;: &quot;@nestjs-mod-fullstack/source&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;version&quot;: &quot;0.0.0&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;license&quot;: &quot;MIT&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;scripts&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;_____db_____&quot;: &quot;_____db_____&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;db:create&quot;: &quot;./node_modules/.bin/nx run-many -t=db-create&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;db:create-and-fill&quot;: &quot;npm run db:create &amp;&amp; npm run flyway:migrate&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;_____flyway_____&quot;: &quot;_____flyway_____&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;flyway:migrate&quot;: &quot;./node_modules/.bin/nx run-many -t=flyway-migrate&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;private&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;devDependencies&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;node-flywaydb&quot;: &quot;^3.0.7&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;nx&quot;: &quot;19.5.3&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;rucken&quot;: &quot;^4.8.1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;dependencies&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;dotenv&quot;: &quot;^16.4.5&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-создаем-docker-образ-для-запуска-e2e-тестов">5. Создаем Docker-образ для запуска E2E-тестов<a class="hash-link" aria-label="Direct link to 5. Создаем Docker-образ для запуска E2E-тестов" title="Direct link to 5. Создаем Docker-образ для запуска E2E-тестов" href="/docs/ru-posts/fullstack/2024-09-08#5-создаем-docker-образ-для-запуска-e2e-тестов">​</a></h3>
<p>Так как мы не хотим ставить лишние зависимости на хост машине, то для запуска E2E-тестов собираем Docker-образ с необходимыми зависимос тями..</p>
<p>Клиентские E2E-тесты запускаются через playwright и используют при работе браузерные движки: chromium, firefox и webkit, для их работы нужно скачать дополнительные файлы которые сильно увеличивают итоговый образ, если исключить часть движков или вообще отключить клиенсткие тесты, то образ будет меньше.</p>
<p>Файлы с тестами не кладутся в сам образ, они лежат рядом с исходным кодом, который монтируется через <code>volume</code> в контейнер при старте.</p>
<p>Пересборка данного Docker-образа будет происходить при смене версии корневого <code>package.json</code>.</p>
<p>Создаем файл <code>.docker/e2e-tests.Dockerfile</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM node:20-bullseye-slim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR /usr/src/app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Disable nx daemon</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV NX_DAEMON=false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Url with stage to run e2e tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV BASE_URL=http://localhost:8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy all files in repository to image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --chown=node:node . .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy the settings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY ./.docker/e2e-tests-package.json package.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY ./.docker/e2e-tests-nx.json nx.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY ./.docker/.dockerignore .dockerignore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Some utilities require a &quot;.env&quot; file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN echo &#x27;&#x27; &gt; .env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Install dependencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN rm -rf package-lock.json &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    npm install --prefer-offline --no-audit --progress=false &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Install external utils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    npx playwright install --with-deps &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Clear cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    npm cache clean --force</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy folders with migrations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># COPY --chown=node:node ./apps ./apps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># COPY --chown=node:node ./libs ./libs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMD [&quot;npm&quot;,&quot;run&quot;, &quot;test:e2e&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Список зависимостей отличается от рутового списка это нужно для уменьшения итогового образа.</p>
<p>Создаем файл с необходимыми зависимостями <code>.docker/e2e-tests-package.json</code></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;name&quot;: &quot;@nestjs-mod-fullstack/source&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;version&quot;: &quot;0.0.0&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;license&quot;: &quot;MIT&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;scripts&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;test:e2e&quot;: &quot;./node_modules/.bin/nx run-many --exclude=@nestjs-mod-fullstack/source --all -t=e2e --skip-nx-cache=true --output-style=stream-without-prefixes&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;private&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;devDependencies&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;@nx/jest&quot;: &quot;19.5.3&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;@nx/playwright&quot;: &quot;19.5.3&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;@playwright/test&quot;: &quot;^1.36.0&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;@types/jest&quot;: &quot;^29.4.0&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;@types/node&quot;: &quot;~18.16.9&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;jest&quot;: &quot;^29.4.1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;nx&quot;: &quot;19.5.3&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ts-jest&quot;: &quot;^29.1.0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;dependencies&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;dotenv&quot;: &quot;^16.4.5&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;rxjs&quot;: &quot;^7.8.0&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;tslib&quot;: &quot;^2.3.0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Миграции запускаются с помощью nx, для полного запуска которого нужно ставить дополнительные зависимости.</p>
<p>Чтобы не увеличивать итоговый размер образа для запуска тестов, необходимо создать урезанный вариант nx конфига.</p>
<p>Создаем файл <code>.docker/e2e-tests-nx.json</code></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;$schema&quot;: &quot;./node_modules/nx/schemas/nx-schema.json&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;namedInputs&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;default&quot;: [&quot;{projectRoot}/**/*&quot;, &quot;sharedGlobals&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;production&quot;: [&quot;default&quot;, &quot;!{projectRoot}/.eslintrc.json&quot;, &quot;!{projectRoot}/eslint.config.js&quot;, &quot;!{projectRoot}/**/?(*.)+(spec|test).[jt]s?(x)?(.snap)&quot;, &quot;!{projectRoot}/tsconfig.spec.json&quot;, &quot;!{projectRoot}/jest.config.[jt]s&quot;, &quot;!{projectRoot}/src/test-setup.[jt]s&quot;, &quot;!{projectRoot}/test-setup.[jt]s&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;sharedGlobals&quot;: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;plugins&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;plugin&quot;: &quot;@nx/playwright/plugin&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;options&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;targetName&quot;: &quot;e2e&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-клиентский-код-отдается-через-nginx-так-что-создаем-docker-образ-с-встроенным-nginx-и-статичными-файлами">6. Клиентский код отдается через Nginx, так что создаем Docker-образ с встроенным Nginx и статичными файлами<a class="hash-link" aria-label="Direct link to 6. Клиентский код отдается через Nginx, так что создаем Docker-образ с встроенным Nginx и статичными файлами" title="Direct link to 6. Клиентский код отдается через Nginx, так что создаем Docker-образ с встроенным Nginx и статичными файлами" href="/docs/ru-posts/fullstack/2024-09-08#6-клиентский-код-отдается-через-nginx-так-что-создаем-docker-образ-с-встроенным-nginx-и-статичными-файлами">​</a></h3>
<p>Часть параметров Nginx конфигурации должны быть переопределяемыми, так как будут несколько вариантов запуска инфраструктуры: Docker Compose и Kubernetes, в каждом варианте полное название сервисов в пределах сети инфраструктуры отличается.</p>
<p>Стартовой точкой данного образа будет не Nginx, а Bash-скрипт который предварительно пропатчить конфигурацию Nginx.</p>
<p>Создаем файл <code>.docker/nginx.Dockerfile</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM nginx:alpine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Set server port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV SERVER_PORT=8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Set nginx port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV NGINX_PORT=8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy nginx config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --chown=node:node ../.docker/nginx /etc/nginx/conf.d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy frontend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --chown=node:node ../dist/apps/client/browser /usr/share/nginx/html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Install Bash Shell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN apk add --update bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Clean up</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN rm -rf /var/cache/apk/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Add a startup script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --chown=node:node ../.docker/nginx/start.sh /start.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN chmod 755 /start.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Expose nginx port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE 8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMD [&quot;/start.sh&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Обновляем файл c конфигурацией Nginx <code>.docker/nginx/nginx.conf</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">map $sent_http_content_type $expires {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;text/html&quot; epoch;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;text/html; charset=utf-8&quot; epoch;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default off;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">map $http_upgrade $connection_upgrade {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default upgrade;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;&#x27; close;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upstream nestjs-mod-fullstack-server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Dynamic name of the server container and the port it runs on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server ___SERVER_NAME___:___SERVER_PORT___;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Dynamic Nginx port that is shared externally</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen ___NGINX_PORT___;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name localhost;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gzip on;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gzip_proxied any;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gzip_types text/plain application/xml text/css application/javascript application/json;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gzip_min_length 1000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gzip_vary on;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gzip_disable &quot;MSIE [1-6]\.(?!.*SV1)&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client_max_body_size 50m;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_connect_timeout 5m;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_send_timeout 5m;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_read_timeout 5m;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    send_timeout 5m;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_max_temp_file_size 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    root /usr/share/nginx/html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    index index.html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location /api {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_pass http://nestjs-mod-fullstack-server;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_http_version 1.1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header Upgrade $http_upgrade;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header Connection $connection_upgrade;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header Host $host;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header Origin $http_origin;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header X-Real-IP $remote_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # kill cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        add_header Last-Modified $date_gmt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        add_header Cache-Control &#x27;no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if_modified_since off;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        expires off;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        etag off;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location /swagger {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_pass http://nestjs-mod-fullstack-server;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_http_version 1.1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header Upgrade $http_upgrade;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header Connection $connection_upgrade;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header Host $host;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header Origin $http_origin;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header X-Real-IP $remote_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # kill cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        add_header Last-Modified $date_gmt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        add_header Cache-Control &#x27;no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if_modified_since off;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        expires off;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        etag off;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        expires $expires;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_redirect off;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header Host $host;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header Origin $http_origin;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header X-Real-IP $remote_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header X-Forwarded-Proto $scheme;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_read_timeout 1m;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_connect_timeout 1m;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_intercept_errors on;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        error_page 404 =200 /index.html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        root /usr/share/nginx/html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Создаем Bash-скрипт для пачтинга конфигурации Nginx и его запуск <code>.docker/nginx/start.sh</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [[ -z &quot;${SERVER_PORT}&quot; ]]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SERVER_PORT=&quot;8080&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SERVER_PORT=&quot;${SERVER_PORT}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [[ -z &quot;${SERVER_NAME}&quot; ]]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SERVER_NAME=&quot;nestjs-mod-fullstack-server&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SERVER_NAME=&quot;${SERVER_NAME}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [[ -z &quot;${NGINX_PORT}&quot; ]]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    NGINX_PORT=&quot;8080&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    NGINX_PORT=&quot;${NGINX_PORT}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Replacing Nginx Dynamic Parameters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &quot;s/___SERVER_NAME___/$SERVER_NAME/g&quot; /etc/nginx/conf.d/nginx.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &quot;s/___SERVER_PORT___/$SERVER_PORT/g&quot; /etc/nginx/conf.d/nginx.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &quot;s/___NGINX_PORT___/$NGINX_PORT/g&quot; /etc/nginx/conf.d/nginx.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Launch Nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/sbin/nginx -g &quot;daemon off;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="7-обновляем-файлы-для-запуска-в-режиме-docker-compose">7. Обновляем файлы для запуска в режиме &quot;Docker Compose&quot;<a class="hash-link" aria-label="Direct link to 7. Обновляем файлы для запуска в режиме &quot;Docker Compose&quot;" title="Direct link to 7. Обновляем файлы для запуска в режиме &quot;Docker Compose&quot;" href="/docs/ru-posts/fullstack/2024-09-08#7-обновляем-файлы-для-запуска-в-режиме-docker-compose">​</a></h3>
<p>Часть переменных окружения для сборки и запуска образов будет формироваться в специальном Bash-скрипте и экспортироваться в активный процесс.</p>
<p>Создаем файл <code>.docker/set-env.sh</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set -e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export REPOSITORY=nestjs-mod/nestjs-mod-fullstack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export REGISTRY=ghcr.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export BASE_SERVER_IMAGE_NAME=&quot;${REPOSITORY}-base-server&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export BUILDER_IMAGE_NAME=&quot;${REPOSITORY}-builder&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export MIGRATIONS_IMAGE_NAME=&quot;${REPOSITORY}-migrations&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export SERVER_IMAGE_NAME=&quot;${REPOSITORY}-server&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export NGINX_IMAGE_NAME=&quot;${REPOSITORY}-nginx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export E2E_TESTS_IMAGE_NAME=&quot;${REPOSITORY}-e2e-tests&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export COMPOSE_INTERACTIVE_NO_CLI=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export NX_DAEMON=false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export NX_PARALLEL=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export NX_SKIP_NX_CACHE=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export DISABLE_SERVE_STATIC=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export ROOT_VERSION=$(npm pkg get version --workspaces=false | tr -d \&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export SERVER_VERSION=$(cd ./apps/server &amp;&amp; npm pkg get version --workspaces=false | tr -d \&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Обновляем файл <code>.docker/docker-compose-full.yml</code></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;3&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-network</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">driver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;bridge&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-postgre-sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;bitnami/postgresql:15.5.0&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-postgre-sql&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-network&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">healthcheck</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">test</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;CMD-SHELL&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;pg_isready -U postgres&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">interval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;5s&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;5s&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">retries</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">tty</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;always&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">POSTGRESQL_USERNAME</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${SERVER_POSTGRE_SQL_POSTGRESQL_USERNAME}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">POSTGRESQL_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${SERVER_POSTGRE_SQL_POSTGRESQL_PASSWORD}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">POSTGRESQL_DATABASE</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${SERVER_POSTGRE_SQL_POSTGRESQL_DATABASE}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-postgre-sql-volume:/bitnami/postgresql&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-postgre-sql-migrations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ghcr.io/nestjs-mod/nestjs-mod-fullstack-migrations:${ROOT_VERSION}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-postgre-sql-migrations&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-network&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">tty</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">NX_SKIP_NX_CACHE</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;true&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">SERVER_ROOT_DATABASE_URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${SERVER_ROOT_DATABASE_URL}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">SERVER_APP_DATABASE_URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${SERVER_APP_DATABASE_URL}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-postgre-sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;service_healthy&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">working_dir</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/usr/src/app&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;./../apps:/usr/src/app/apps&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;./../libs:/usr/src/app/libs&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ghcr.io/nestjs-mod/nestjs-mod-fullstack-server:${SERVER_VERSION}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-server&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-network&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">healthcheck</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">test</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;CMD-SHELL&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;npx -y wait-on --timeout= --interval=1000 --window --verbose --log http://localhost:${SERVER_PORT}/api/health&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">interval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">retries</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">tty</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">SERVER_APP_DATABASE_URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${SERVER_APP_DATABASE_URL}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">SERVER_PORT</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${SERVER_PORT}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;always&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-postgre-sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service_healthy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-postgre-sql-migrations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service_completed_successfully</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ghcr.io/nestjs-mod/nestjs-mod-fullstack-nginx:${SERVER_VERSION}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-nginx&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-network&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">healthcheck</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">test</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;CMD-SHELL&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;curl -so /dev/null http://localhost:${NGINX_PORT} || exit 1&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">interval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">retries</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">SERVER_PORT</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${SERVER_PORT}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">NGINX_PORT</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${NGINX_PORT}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;always&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service_healthy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${NGINX_PORT}:${NGINX_PORT}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-e2e-tests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ghcr.io/nestjs-mod/nestjs-mod-fullstack-e2e-tests:${ROOT_VERSION}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-e2e-tests&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-network&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">BASE_URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;http://nestjs-mod-fullstack-nginx:${NGINX_PORT}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service_healthy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">working_dir</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/usr/src/app&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;./../apps:/usr/src/app/apps&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;./../libs:/usr/src/app/libs&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-https-portal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> steveltn/https</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">portal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-https-portal&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-network&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;80:80&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;443:443&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">links</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> nestjs</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">mod</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">fullstack</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">STAGE</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${HTTPS_PORTAL_STAGE}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">DOMAINS</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;${SERVER_DOMAIN} -&gt; http://nestjs-mod-fullstack-nginx:${NGINX_PORT}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service_healthy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> nestjs</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">mod</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">fullstack</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">https</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">portal</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">volume</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/var/lib/https</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">portal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-postgre-sql-volume</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-postgre-sql-volume&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nestjs-mod-fullstack-https-portal-volume</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;nestjs-mod-fullstack-https-portal-volume&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Обновляем файл с переменными окружения <code>.docker/docker-compose-full.env</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SERVER_PORT=9090</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NGINX_PORT=8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVER_ROOT_DATABASE_URL=postgres://postgres:postgres_password@nestjs-mod-fullstack-postgre-sql:5432/postgres?schema=public</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVER_APP_DATABASE_URL=postgres://app:app_password@nestjs-mod-fullstack-postgre-sql:5432/app?schema=public</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVER_POSTGRE_SQL_POSTGRESQL_USERNAME=postgres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVER_POSTGRE_SQL_POSTGRESQL_PASSWORD=postgres_password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVER_POSTGRE_SQL_POSTGRESQL_DATABASE=postgres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVER_DOMAIN=example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTPS_PORTAL_STAGE=local # local|stage|production</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="8-создаем-bash-скрипт-для-построения-локальных-docker-образов">8. Создаем Bash-скрипт для построения локальных Docker-образов<a class="hash-link" aria-label="Direct link to 8. Создаем Bash-скрипт для построения локальных Docker-образов" title="Direct link to 8. Создаем Bash-скрипт для построения локальных Docker-образов" href="/docs/ru-posts/fullstack/2024-09-08#8-создаем-bash-скрипт-для-построения-локальных-docker-образов">​</a></h3>
<p>Для локального запуска в режиме &quot;Docker Compose&quot; необходимо предварительно построить все образа, это будем делать в отдельном Bash-скрипте, для того чтобы в будущем иметь возможность кастомизировать процесс сборки.</p>
<p>Создаем файл <code>.docker/build-images.sh</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set -e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># We check the existence of a local image with the specified tag, if it does not exist, we start building the image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export IMG=${REGISTRY}/${BUILDER_IMAGE_NAME}:${ROOT_VERSION} &amp;&amp; [ -n &quot;$(docker images -q $IMG)&quot; ] || docker build -t &quot;${REGISTRY}/${BUILDER_IMAGE_NAME}:${ROOT_VERSION}&quot; -t &quot;${REGISTRY}/${BUILDER_IMAGE_NAME}:latest&quot; -f ./.docker/builder.Dockerfile . --progress=plain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># We build all applications</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker run -v ./dist:/usr/src/app/dist -v ./apps:/usr/src/app/apps -v ./libs:/usr/src/app/libs ${REGISTRY}/${BUILDER_IMAGE_NAME}:${ROOT_VERSION}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># We check the existence of a local image with the specified tag, if it does not exist, we start building the image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export IMG=${REGISTRY}/${BASE_SERVER_IMAGE_NAME}:${ROOT_VERSION} &amp;&amp; [ -n &quot;$(docker images -q $IMG)&quot; ] || docker build -t &quot;${REGISTRY}/${BASE_SERVER_IMAGE_NAME}:${ROOT_VERSION}&quot; -t &quot;${REGISTRY}/${BASE_SERVER_IMAGE_NAME}:latest&quot; -f ./.docker/base-server.Dockerfile . --progress=plain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># We check the existence of a local image with the specified tag, if it does not exist, we start building the image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export IMG=${REGISTRY}/${SERVER_IMAGE_NAME}:${SERVER_VERSION} &amp;&amp; [ -n &quot;$(docker images -q $IMG)&quot; ] || docker build -t &quot;${REGISTRY}/${SERVER_IMAGE_NAME}:${SERVER_VERSION}&quot; -t &quot;${REGISTRY}/${SERVER_IMAGE_NAME}:latest&quot; -f ./.docker/server.Dockerfile . --progress=plain --build-arg=\&quot;BASE_SERVER_IMAGE_TAG=${ROOT_VERSION}\&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># We check the existence of a local image with the specified tag, if it does not exist, we start building the image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export IMG=${REGISTRY}/${MIGRATIONS_IMAGE_NAME}:${ROOT_VERSION} &amp;&amp; [ -n &quot;$(docker images -q $IMG)&quot; ] || docker build -t &quot;${REGISTRY}/${MIGRATIONS_IMAGE_NAME}:${ROOT_VERSION}&quot; -t &quot;${REGISTRY}/${MIGRATIONS_IMAGE_NAME}:latest&quot; -f ./.docker/migrations.Dockerfile . --progress=plain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># We check the existence of a local image with the specified tag, if it does not exist, we start building the image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export IMG=${REGISTRY}/${NGINX_IMAGE_NAME}:${SERVER_VERSION} &amp;&amp; [ -n &quot;$(docker images -q $IMG)&quot; ] || docker build -t &quot;${REGISTRY}/${NGINX_IMAGE_NAME}:${SERVER_VERSION}&quot; -t &quot;${REGISTRY}/${NGINX_IMAGE_NAME}:latest&quot; -f ./.docker/nginx.Dockerfile . --progress=plain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># We check the existence of a local image with the specified tag, if it does not exist, we start building the image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export IMG=${REGISTRY}/${E2E_TESTS_IMAGE_NAME}:${ROOT_VERSION} &amp;&amp; [ -n &quot;$(docker images -q $IMG)&quot; ] || docker build -t &quot;${REGISTRY}/${E2E_TESTS_IMAGE_NAME}:${ROOT_VERSION}&quot; -t &quot;${REGISTRY}/${E2E_TESTS_IMAGE_NAME}:latest&quot; -f ./.docker/e2e-tests.Dockerfile . --progress=plain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="9-для-запуска-обновленного-режима-docker-compose-необходимо-обновить-все-npm-скрипты">9. Для запуска обновленного режима &quot;Docker Compose&quot; необходимо обновить все npm-скрипты<a class="hash-link" aria-label="Direct link to 9. Для запуска обновленного режима &quot;Docker Compose&quot; необходимо обновить все npm-скрипты" title="Direct link to 9. Для запуска обновленного режима &quot;Docker Compose&quot; необходимо обновить все npm-скрипты" href="/docs/ru-posts/fullstack/2024-09-08#9-для-запуска-обновленного-режима-docker-compose-необходимо-обновить-все-npm-скрипты">​</a></h3>
<p>Обновляем файл <code>package.json</code></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;scripts&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;_____pm2-full dev infra_____&quot;: &quot;_____pm2-full dev infra_____&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;pm2-full:dev:start&quot;: &quot;npm run generate &amp;&amp; npm run docker-compose:start-prod:server &amp;&amp; npm run db:create-and-fill &amp;&amp; npm run pm2:dev:start&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;pm2-full:dev:stop&quot;: &quot;npm run docker-compose:stop-prod:server &amp;&amp; npm run pm2:dev:stop&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;pm2-full:dev:test:e2e&quot;: &quot;npm run test:e2e&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;_____pm2-full prod infra_____&quot;: &quot;_____pm2-full prod infra_____&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;pm2-full:prod:start&quot;: &quot;npm run build:prod &amp;&amp; npm run docker-compose:start-prod:server &amp;&amp; npm run db:create-and-fill &amp;&amp; npm run pm2:start&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;pm2-full:prod:stop&quot;: &quot;npm run docker-compose:stop-prod:server &amp;&amp; npm run pm2:stop&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;pm2-full:prod:test:e2e&quot;: &quot;export BASE_URL=http://localhost:3000 &amp;&amp; npm run test:e2e&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;_____prod infra_____&quot;: &quot;_____prod infra_____&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;start&quot;: &quot;./node_modules/.bin/nx run-many --exclude=@nestjs-mod-fullstack/source --all -t=start&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;build&quot;: &quot;npm run generate &amp;&amp; ./node_modules/.bin/nx run-many --exclude=@nestjs-mod-fullstack/source --all -t=build --skip-nx-cache=true&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;build:prod&quot;: &quot;npm run generate &amp;&amp; chmod -R augo+rw libs apps dist &amp;&amp; ./node_modules/.bin/nx run-many --exclude=@nestjs-mod-fullstack/source --all -t=build --skip-nx-cache=true -c production&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;_____docker-compose-full prod infra_____&quot;: &quot;_____docker-compose-full prod infra_____&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;docker-compose-full:prod:build&quot;: &quot;. .docker/set-env.sh &amp;&amp; .docker/build-images.sh&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;docker-compose-full:prod:start&quot;: &quot;npm run docker-compose-full:prod:build &amp;&amp; npm run docker-compose-full:prod:only-start&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;docker-compose-full:prod:stop&quot;: &quot;. .docker/set-env.sh &amp;&amp; docker compose -f ./.docker/docker-compose-full.yml --env-file ./.docker/docker-compose-full.env --compatibility down&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;docker-compose-full:prod:only-start&quot;: &quot;. .docker/set-env.sh &amp;&amp; docker compose -f ./.docker/docker-compose-full.yml --env-file ./.docker/docker-compose-full.env --compatibility up -d&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;docker-compose-full:prod:test:e2e&quot;: &quot;. .docker/set-env.sh &amp;&amp; export BASE_URL=http://localhost:8080 &amp;&amp; npm run test:e2e&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;_____db_____&quot;: &quot;_____db_____&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;db:create&quot;: &quot;./node_modules/.bin/nx run-many -t=db-create&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;db:create-and-fill&quot;: &quot;npm run db:create &amp;&amp; npm run flyway:migrate&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="10-запускаем-обновленный-docker-compose-режим-с-встроеным-запуском-e2e-тестов">10. Запускаем обновленный &quot;Docker Compose&quot; режим с встроеным запуском E2E-тестов<a class="hash-link" aria-label="Direct link to 10. Запускаем обновленный &quot;Docker Compose&quot; режим с встроеным запуском E2E-тестов" title="Direct link to 10. Запускаем обновленный &quot;Docker Compose&quot; режим с встроеным запуском E2E-тестов" href="/docs/ru-posts/fullstack/2024-09-08#10-запускаем-обновленный-docker-compose-режим-с-встроеным-запуском-e2e-тестов">​</a></h3>
<p><em>Команды</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npm run docker-compose-full:prod:start</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>Вывод консоли</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 docker-compose-full:prod:start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; npm run docker-compose-full:prod:build &amp;&amp; npm run docker-compose-full:prod:only-start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 docker-compose-full:prod:build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; . .docker/set-env.sh &amp;&amp; .docker/build-images.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 build:prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; npm run generate &amp;&amp; chmod -R augo+rw libs apps dist &amp;&amp; ./node_modules/.bin/nx run-many --exclude=@nestjs-mod-fullstack/source --all -t=build --skip-nx-cache=true -c production</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 generate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ./node_modules/.bin/nx run-many --exclude=@nestjs-mod-fullstack/source --all -t=generate --skip-nx-cache=true &amp;&amp; npm run make-ts-list &amp;&amp; npm run lint:fix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Running target generate for project server:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; nx run server:generate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ./node_modules/.bin/prisma generate --schema=./apps/server/src/prisma/app-schema.prisma</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2mEnvironment variables loaded from .env[22m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2mPrisma schema loaded from apps/server/src/prisma/app-schema.prisma[22m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[36mprisma:info[39m [Prisma Class Generator]:Handler Registered.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[36mprisma:info[39m [Prisma Class Generator]:Generate /usr/src/app/apps/server/src/app/generated/rest/dto/app_demo.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[36mprisma:info[39m [Prisma Class Generator]:Generate /usr/src/app/apps/server/src/app/generated/rest/dto/migrations.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✔ Generated [1mPrisma Client[22m (v5.18.0, engine=binary)[2m to ./node_modules/@prisma/app-client[22m in 83ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✔ Generated [1mPrisma Class Generator[22m[2m to ./apps/server/src/app/generated/rest/dto[22m in 88ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Start by importing your Prisma Client (See: http://pris.ly/d/importing-client)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tip: Want real-time updates to your database without manual polling? Discover how with Pulse: https://pris.ly/tip-0-pulse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ./node_modules/.bin/rucken make-ts-list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; export NESTJS_MODE=infrastructure &amp;&amp; ./node_modules/.bin/nx serve server --host=0.0.0.0 --watch=false --inspect=false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2m&gt; [22m[2mnx run[22m server:serve:development --host=0.0.0.0 --watch=false --inspect=false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chunk (runtime: main) [1m[32mmain.js[39m[22m (main) 12.8 KiB [1m[33m[entry][39m[22m [1m[32m[rendered][39m[22m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">webpack compiled [1m[32msuccessfully[39m[22m (77fef9f77a8e1069)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.239] [32mINFO[39m (275): [36mStarting Nest application...[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;NestFactory&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.240] [32mINFO[39m (275): [36mDefaultNestApp dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.240] [32mINFO[39m (275): [36mProjectUtilsSettings dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.240] [32mINFO[39m (275): [36mDefaultNestApplicationInitializerSettings dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.240] [32mINFO[39m (275): [36mDefaultNestApplicationInitializerShared dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.240] [32mINFO[39m (275): [36mNestjsPinoLoggerModuleSettings dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.240] [32mINFO[39m (275): [36mNestjsPinoLoggerModuleShared dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.240] [32mINFO[39m (275): [36mTerminusHealthCheckModuleSettings dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.240] [32mINFO[39m (275): [36mDefaultNestApplicationListenerSettings dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.240] [32mINFO[39m (275): [36mDefaultNestApplicationListenerShared dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.240] [32mINFO[39m (275): [36mPrismaModuleSettings dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.240] [32mINFO[39m (275): [36mAppModuleSettings dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.240] [32mINFO[39m (275): [36mAppModuleShared dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.240] [32mINFO[39m (275): [36mPrismaModule dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.240] [32mINFO[39m (275): [36mInfrastructureMarkdownReportGeneratorSettings dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mPm2Settings dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mPm2Shared dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mProjectUtils dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mDockerComposeSettings dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mProjectUtils dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mDockerComposePostgreSQLSettings dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mDockerCompose dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mDockerComposePostgreSQL dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mDockerComposePostgreSQLSettings dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mDockerComposePostgreSQLShared dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mFlywaySettings dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mFlywayShared dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mPrismaModuleSettings dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mPrismaModuleShared dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mProjectUtils dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mInfrastructureMarkdownReportGeneratorSettings dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mProjectUtils dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mInfrastructureMarkdownReportStorage dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mInfrastructureMarkdownReportStorageSettings dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mProjectUtils dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mDockerCompose dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mFlywaySettings dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mFlywayShared dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mProjectUtils dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mDefaultNestApplicationListenerSettings dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mDefaultNestApplicationListenerShared dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mDockerComposeShared dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mInfrastructureMarkdownReportStorageShared dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mProjectUtils dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mDefaultNestApplicationInitializer dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mDefaultNestApplicationListener dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mPrismaModule dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mInfrastructureMarkdownReportGenerator dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mDockerComposePostgreSQL dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mFlyway dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mDefaultNestApplicationListener dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mNestjsPinoLoggerModule dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mTerminusModule dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mTerminusModule dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mProjectUtilsShared dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mInfrastructureMarkdownReportGeneratorShared dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mPm2 dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mDockerCompose dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mDockerComposePostgreSQL dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mPrismaModule dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mInfrastructureMarkdownReportGeneratorShared dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mFlyway dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mInfrastructureMarkdownReportGenerator dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mLoggerModule dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mDockerComposePostgreSQLShared dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mPrismaModuleShared dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mTerminusHealthCheckModuleShared dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mTerminusHealthCheckModule dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.241] [32mINFO[39m (275): [36mAppModule dependencies initialized[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;InstanceLoader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.285] [32mINFO[39m (275): [36mTerminusHealthCheckController {/api/health}:[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;RoutesResolver&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.287] [32mINFO[39m (275): [36mMapped {/api/health, GET} route[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;RouterExplorer&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.287] [32mINFO[39m (275): [36mAppController {/api}:[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;RoutesResolver&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.287] [32mINFO[39m (275): [36mMapped {/api, GET} route[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;RouterExplorer&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.287] [32mINFO[39m (275): [36mMapped {/api/demo, POST} route[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;RouterExplorer&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.288] [32mINFO[39m (275): [36mMapped {/api/demo/:id, GET} route[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;RouterExplorer&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.288] [32mINFO[39m (275): [36mMapped {/api/demo/:id, DELETE} route[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;RouterExplorer&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.288] [32mINFO[39m (275): [36mMapped {/api/demo, GET} route[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;RouterExplorer&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.292] [32mINFO[39m (275): [36mConnected to database![39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;PrismaClient&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.329] [34mDEBUG[39m (275):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0: &quot;SERVER_ROOT_DATABASE_URL: Description=&#x27;Connection string for PostgreSQL with root credentials (example: postgres://postgres:postgres_password@localhost:5432/postgres?schema=public, username must be \&quot;postgres\&quot;)&#x27;, Original Name=&#x27;rootDatabaseUrl&#x27;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    1: &quot;SERVER_PORT: Description=&#x27;The port on which to run the server.&#x27;, Default=&#x27;3000&#x27;, Original Name=&#x27;port&#x27;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2: &quot;SERVER_HOSTNAME: Description=&#x27;Hostname on which to listen for incoming packets.&#x27;, Original Name=&#x27;hostname&#x27;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3: &quot;SERVER_APP_DATABASE_URL: Description=&#x27;Connection string for PostgreSQL with module credentials (example: postgres://feat:feat_password@localhost:5432/feat?schema=public)&#x27;, Original Name=&#x27;databaseUrl&#x27;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;All application environments&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[15:52:07.399] [32mINFO[39m (275): [36mNest application successfully started[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: &quot;NestApplication&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[0m[7m[1m[32m NX [39m[22m[27m[0m  [32mSuccessfully ran target serve for project server[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; rm -rf ./libs/sdk/app-angular-rest-sdk/src/lib &amp;&amp; mkdir ./libs/sdk/app-angular-rest-sdk/src/lib &amp;&amp; ./node_modules/.bin/openapi-generator-cli generate -i ./app-swagger.json -g typescript-angular -o ./libs/sdk/app-angular-rest-sdk/src/lib  --additional-properties=apiModulePrefix=RestClient,configurationPrefix=RestClient,fileNaming=kebab-case,modelFileSuffix=.interface,modelSuffix=Interface,enumNameSuffix=Type,enumPropertyNaming=original,serviceFileSuffix=-rest.service,serviceSuffix=RestService</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[33mDownload 7.8.0 ...[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[32mDownloaded 7.8.0[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[32mDid set selected version to 7.8.0[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.DefaultGenerator - Generating with dryRun=false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.c.ignore.CodegenIgnoreProcessor - No .openapi-generator-ignore file found.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.DefaultGenerator - OpenAPI Generator: typescript-angular (client)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.DefaultGenerator - Generator &#x27;typescript-angular&#x27; is considered stable.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.c.l.AbstractTypeScriptClientCodegen - Hint: Environment variable &#x27;TS_POST_PROCESS_FILE&#x27; (optional) not defined. E.g. to format the source code, please try &#x27;export TS_POST_PROCESS_FILE=&quot;/usr/local/bin/prettier --write&quot;&#x27; (Linux/Mac)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.c.l.AbstractTypeScriptClientCodegen - Note: To enable file post-processing, &#x27;enablePostProcessFile&#x27; must be set to `true` (--enable-post-process-file for CLI).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] WARN  o.o.codegen.DefaultCodegen - The value (generator&#x27;s option) must be either boolean or string. Default to `false`.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.c.l.TypeScriptAngularClientCodegen - generating code for Angular 18.0.0 ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.c.l.TypeScriptAngularClientCodegen -   (you can select the angular version by setting the additionalProperties (--additional-properties in CLI) ngVersion)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.InlineModelResolver - Inline schema created as TerminusHealthCheckController_check_200_response_info_value. To have complete control of the model name, set the `title` field or use the modelNameMapping option (e.g. --model-name-mappings TerminusHealthCheckController_check_200_response_info_value=NewModel,ModelA=NewModelA in CLI) or inlineSchemaNameMapping option (--inline-schema-name-mappings TerminusHealthCheckController_check_200_response_info_value=NewModel,ModelA=NewModelA in CLI).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.InlineModelResolver - Inline schema created as TerminusHealthCheckController_check_200_response. To have complete control of the model name, set the `title` field or use the modelNameMapping option (e.g. --model-name-mappings TerminusHealthCheckController_check_200_response=NewModel,ModelA=NewModelA in CLI) or inlineSchemaNameMapping option (--inline-schema-name-mappings TerminusHealthCheckController_check_200_response=NewModel,ModelA=NewModelA in CLI).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.InlineModelResolver - Inline schema created as TerminusHealthCheckController_check_503_response. To have complete control of the model name, set the `title` field or use the modelNameMapping option (e.g. --model-name-mappings TerminusHealthCheckController_check_503_response=NewModel,ModelA=NewModelA in CLI) or inlineSchemaNameMapping option (--inline-schema-name-mappings TerminusHealthCheckController_check_503_response=NewModel,ModelA=NewModelA in CLI).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.utils.URLPathUtils - &#x27;host&#x27; (OAS 2.0) or &#x27;servers&#x27; (OAS 3.0) not defined in the spec. Default to [http://localhost] for server URL [http://localhost/]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.utils.URLPathUtils - &#x27;host&#x27; (OAS 2.0) or &#x27;servers&#x27; (OAS 3.0) not defined in the spec. Default to [http://localhost] for server URL [http://localhost/]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-angular-rest-sdk/src/lib/model/./app-data.interface.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-angular-rest-sdk/src/lib/model/./app-demo.interface.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-angular-rest-sdk/src/lib/model/./terminus-health-check-controller-check200-response-info-value.interface.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-angular-rest-sdk/src/lib/model/./terminus-health-check-controller-check200-response.interface.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-angular-rest-sdk/src/lib/model/./terminus-health-check-controller-check503-response.interface.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.utils.URLPathUtils - &#x27;host&#x27; (OAS 2.0) or &#x27;servers&#x27; (OAS 3.0) not defined in the spec. Default to [http://localhost] for server URL [http://localhost/]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-angular-rest-sdk/src/lib/api/default-rest.service.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.utils.URLPathUtils - &#x27;host&#x27; (OAS 2.0) or &#x27;servers&#x27; (OAS 3.0) not defined in the spec. Default to [http://localhost] for server URL [http://localhost/]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-angular-rest-sdk/src/lib/model/models.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-angular-rest-sdk/src/lib/api/api.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-angular-rest-sdk/src/lib/index.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-angular-rest-sdk/src/lib/api.module.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-angular-rest-sdk/src/lib/configuration.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-angular-rest-sdk/src/lib/variables.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-angular-rest-sdk/src/lib/encoder.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-angular-rest-sdk/src/lib/param.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-angular-rest-sdk/src/lib/.gitignore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-angular-rest-sdk/src/lib/git_push.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-angular-rest-sdk/src/lib/README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-angular-rest-sdk/src/lib/.openapi-generator-ignore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-angular-rest-sdk/src/lib/.openapi-generator/VERSION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-angular-rest-sdk/src/lib/.openapi-generator/FILES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">################################################################################</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Thanks for using OpenAPI Generator.                                          #</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Please consider donation to help us maintain this project 🙏                 #</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># https://opencollective.com/openapi_generator/donate                          #</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">################################################################################</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; rm -rf ./libs/sdk/app-rest-sdk/src/lib &amp;&amp; mkdir ./libs/sdk/app-rest-sdk/src/lib &amp;&amp; ./node_modules/.bin/openapi-generator-cli generate -i ./app-swagger.json -g typescript-axios -o ./libs/sdk/app-rest-sdk/src/lib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.DefaultGenerator - Generating with dryRun=false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.c.ignore.CodegenIgnoreProcessor - No .openapi-generator-ignore file found.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.DefaultGenerator - OpenAPI Generator: typescript-axios (client)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.DefaultGenerator - Generator &#x27;typescript-axios&#x27; is considered stable.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.c.l.AbstractTypeScriptClientCodegen - Hint: Environment variable &#x27;TS_POST_PROCESS_FILE&#x27; (optional) not defined. E.g. to format the source code, please try &#x27;export TS_POST_PROCESS_FILE=&quot;/usr/local/bin/prettier --write&quot;&#x27; (Linux/Mac)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.c.l.AbstractTypeScriptClientCodegen - Note: To enable file post-processing, &#x27;enablePostProcessFile&#x27; must be set to `true` (--enable-post-process-file for CLI).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] WARN  o.o.codegen.DefaultCodegen - The value (generator&#x27;s option) must be either boolean or string. Default to `false`.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.InlineModelResolver - Inline schema created as TerminusHealthCheckController_check_200_response_info_value. To have complete control of the model name, set the `title` field or use the modelNameMapping option (e.g. --model-name-mappings TerminusHealthCheckController_check_200_response_info_value=NewModel,ModelA=NewModelA in CLI) or inlineSchemaNameMapping option (--inline-schema-name-mappings TerminusHealthCheckController_check_200_response_info_value=NewModel,ModelA=NewModelA in CLI).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.InlineModelResolver - Inline schema created as TerminusHealthCheckController_check_200_response. To have complete control of the model name, set the `title` field or use the modelNameMapping option (e.g. --model-name-mappings TerminusHealthCheckController_check_200_response=NewModel,ModelA=NewModelA in CLI) or inlineSchemaNameMapping option (--inline-schema-name-mappings TerminusHealthCheckController_check_200_response=NewModel,ModelA=NewModelA in CLI).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.InlineModelResolver - Inline schema created as TerminusHealthCheckController_check_503_response. To have complete control of the model name, set the `title` field or use the modelNameMapping option (e.g. --model-name-mappings TerminusHealthCheckController_check_503_response=NewModel,ModelA=NewModelA in CLI) or inlineSchemaNameMapping option (--inline-schema-name-mappings TerminusHealthCheckController_check_503_response=NewModel,ModelA=NewModelA in CLI).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.utils.URLPathUtils - &#x27;host&#x27; (OAS 2.0) or &#x27;servers&#x27; (OAS 3.0) not defined in the spec. Default to [http://localhost] for server URL [http://localhost/]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.utils.URLPathUtils - &#x27;host&#x27; (OAS 2.0) or &#x27;servers&#x27; (OAS 3.0) not defined in the spec. Default to [http://localhost] for server URL [http://localhost/]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.utils.URLPathUtils - &#x27;host&#x27; (OAS 2.0) or &#x27;servers&#x27; (OAS 3.0) not defined in the spec. Default to [http://localhost] for server URL [http://localhost/]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.utils.URLPathUtils - &#x27;host&#x27; (OAS 2.0) or &#x27;servers&#x27; (OAS 3.0) not defined in the spec. Default to [http://localhost] for server URL [http://localhost/]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-rest-sdk/src/lib/index.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-rest-sdk/src/lib/base.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-rest-sdk/src/lib/common.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-rest-sdk/src/lib/api.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-rest-sdk/src/lib/configuration.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-rest-sdk/src/lib/git_push.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-rest-sdk/src/lib/.gitignore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-rest-sdk/src/lib/.npmignore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-rest-sdk/src/lib/.openapi-generator-ignore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-rest-sdk/src/lib/.openapi-generator/VERSION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[main] INFO  o.o.codegen.TemplateManager - writing file /usr/src/app/./libs/sdk/app-rest-sdk/src/lib/.openapi-generator/FILES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">################################################################################</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Thanks for using OpenAPI Generator.                                          #</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Please consider donation to help us maintain this project 🙏                 #</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># https://opencollective.com/openapi_generator/donate                          #</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">################################################################################</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Successfully ran target generate for project server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 make-ts-list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ./node_modules/.bin/rucken make-ts-list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 lint:fix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; npm run tsc:lint &amp;&amp; ./node_modules/.bin/nx run-many --exclude=@nestjs-mod-fullstack/source --all -t=lint --fix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 tsc:lint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ./node_modules/.bin/tsc --noEmit -p tsconfig.base.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Running target lint for 4 projects:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- app-angular-rest-sdk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- server-e2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">With additional flags:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --fix=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; nx run server-e2e:lint --fix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Linting &quot;server-e2e&quot;...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✔ All files pass linting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ESLint found too many warnings (maximum: -1).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; nx run app-angular-rest-sdk:lint --fix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Linting &quot;app-angular-rest-sdk&quot;...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[0m[0m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[0m[4m/usr/src/app/libs/sdk/app-angular-rest-sdk/src/test-setup.ts[24m[0m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[0m  [2m1:16[22m  [33mwarning[39m  Unexpected any. Specify a different type  [2m@typescript-eslint/no-explicit-any[22m[0m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[0m[0m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[0m[33m[1m✖ 1 problem (0 errors, 1 warning)[22m[39m[0m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[0m[33m[1m[22m[39m[0m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✖ 1 problem (0 errors, 1 warning)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ESLint found too many warnings (maximum: -1).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; nx run client:lint --fix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Linting &quot;client&quot;...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[0m[0m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[0m[4m/usr/src/app/apps/client/src/test-setup.ts[24m[0m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[0m  [2m1:16[22m  [33mwarning[39m  Unexpected any. Specify a different type  [2m@typescript-eslint/no-explicit-any[22m[0m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[0m[0m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[0m[33m[1m✖ 1 problem (0 errors, 1 warning)[22m[39m[0m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[0m[33m[1m[22m[39m[0m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✖ 1 problem (0 errors, 1 warning)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ESLint found too many warnings (maximum: -1).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; nx run server:lint --fix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Linting &quot;server&quot;...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✔ All files pass linting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ESLint found too many warnings (maximum: -1).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Successfully ran target lint for 4 projects</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Running target build for 4 projects:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- app-angular-rest-sdk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- app-rest-sdk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; nx run app-rest-sdk:build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1m[33mYour library compilation option specifies that the compiler external helper (tslib) is needed but it is not installed.[39m[22m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Compiling TypeScript files for project &quot;app-rest-sdk&quot;...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Done compiling TypeScript files for project &quot;app-rest-sdk&quot;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; nx run app-angular-rest-sdk:build:production</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[34mBuilding Angular Package[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[37m[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[37m------------------------------------------------------------------------------[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[37mBuilding entry point &#x27;@nestjs-mod-fullstack/app-angular-rest-sdk&#x27;[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[37m------------------------------------------------------------------------------[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Compiling with Angular sources in Ivy partial compilation mode.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[32m✔[39m Compiling with Angular sources in Ivy partial compilation mode.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[32m✔[39m Generating FESM bundles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Copying assets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[32m✔[39m Copying assets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Writing package manifest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[32m✔[39m Writing package manifest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[32m✔[39m Built @nestjs-mod-fullstack/app-angular-rest-sdk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[32m[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[32m------------------------------------------------------------------------------[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[32mBuilt Angular Package[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[32m - from: /usr/src/app/libs/sdk/app-angular-rest-sdk[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[32m - to:   /usr/src/app/dist/libs/sdk/app-angular-rest-sdk[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[32m------------------------------------------------------------------------------[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[37m[37m[39m[37m[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[37m[37mBuild at: [1m2024-09-08T15:52:28.701Z[22m - Time: [1m2306[22mms[39m[37m[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[37m[37m[39m[37m[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; nx run server:build:production</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chunk (runtime: main) [1m[32mmain.js[39m[22m (main) 12.8 KiB [1m[33m[entry][39m[22m [1m[32m[rendered][39m[22m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">webpack compiled [1m[32msuccessfully[39m[22m (77fef9f77a8e1069)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; nx run client:build:production</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Generating browser application bundles (phase: setup)...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[32m✔[39m Browser application bundle generation complete.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[32m✔[39m Browser application bundle generation complete.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Copying assets...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[32m✔[39m Copying assets complete.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Generating index html...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[32m✔[39m Index html generation complete.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[37m[0m[0m[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[37m[0m[1mInitial chunk files[22m          [2m | [22m[1mNames[22m        [2m | [22m [1mRaw size[22m[2m | [22m[1mEstimated transfer size[22m[0m[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[37m[0m[32mmain.7e68bd24636243f2.js[39m[37m     [2m | [22m[2mmain[22m         [2m | [22m[36m250.88 kB[39m[37m[2m | [22m               [36m65.65 kB[39m[37m[0m[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[37m[0m[32mpolyfills.b4ad6ba87a9b45cc.js[39m[37m[2m | [22m[2mpolyfills[22m    [2m | [22m [36m34.80 kB[39m[37m[2m | [22m               [36m11.36 kB[39m[37m[0m[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[37m[0m[32mstyles.1f9d21bffd1c8a8d.css[39m[37m  [2m | [22m[2mstyles[22m       [2m | [22m  [36m5.90 kB[39m[37m[2m | [22m                [36m1.46 kB[39m[37m[0m[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[37m[0m[32mruntime.a9340aa0e1064d4f.js[39m[37m  [2m | [22m[2mruntime[22m      [2m | [22m[36m890 bytes[39m[37m[2m | [22m              [36m504 bytes[39m[37m[0m[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[37m[0m[0m[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[37m[0m[1m [22m                            [2m | [22m[1mInitial total[22m[2m | [22m[1m292.46 kB[22m[2m | [22m               [1m78.97 kB[22m[0m[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[37m[0m[0m[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[37m[0mBuild at: [1m[37m2024-09-08T15:52:45.321Z[39m[37m[22m - Hash: [1m[37mcacf47df594708b3[39m[37m[22m - Time: [1m[37m16944[39m[37m[22mms[0m[39m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Successfully ran target build for 4 projects</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 docker-compose-full:prod:only-start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; . .docker/set-env.sh &amp;&amp; docker compose -f ./.docker/docker-compose-full.yml --env-file ./.docker/docker-compose-full.env --compatibility up -d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WARN[0000] .docker/docker-compose-full.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Running 21/2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✔ nestjs-mod-fullstack-postgre-sql Pulled 30.7s  92.33MB Pulling 30.6s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✔ nestjs-mod-fullstack-https-portal Pulled 27.0s ⣿⣿⣿⣿⣿⠀] Pulling 26.9s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Running 9/9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✔ Network docker_nestjs-mod-fullstack-network            Created0.1s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✔ Volume &quot;nestjs-mod-fullstack-https-portal-volume&quot;      Created0.0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✔ Volume &quot;nestjs-mod-fullstack-postgre-sql-volume&quot;       Created0.0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✔ Container nestjs-mod-fullstack-postgre-sql             Healthy7.3s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✔ Container nestjs-mod-fullstack-postgre-sql-migrations  Exited10.0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✔ Container nestjs-mod-fullstack-server                  Healthy41.2s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✔ Container nestjs-mod-fullstack-nginx                   Healthy71.9s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✔ Container nestjs-mod-fullstack-https-portal            Started72.2s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✔ Container nestjs-mod-fullstack-e2e-tests               Started72.2s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-выводим-список-собранных-образов-и-проверяем-что-они-все-собрались-успешно">11. Выводим список собранных образов и проверяем что они все собрались успешно<a class="hash-link" aria-label="Direct link to 11. Выводим список собранных образов и проверяем что они все собрались успешно" title="Direct link to 11. Выводим список собранных образов и проверяем что они все собрались успешно" href="/docs/ru-posts/fullstack/2024-09-08#11-выводим-список-собранных-образов-и-проверяем-что-они-все-собрались-успешно">​</a></h3>
<p><em>Команды</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker image list</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>Вывод консоли</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ docker image list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REPOSITORY                                            TAG       IMAGE ID       CREATED          SIZE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ghcr.io/nestjs-mod/nestjs-mod-fullstack-e2e-tests     0.0.0     0cfc73bba2ed   10 minutes ago   2.17GB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ghcr.io/nestjs-mod/nestjs-mod-fullstack-e2e-tests     latest    0cfc73bba2ed   10 minutes ago   2.17GB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ghcr.io/nestjs-mod/nestjs-mod-fullstack-nginx         0.0.1     d5502067f83f   12 minutes ago   47.6MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ghcr.io/nestjs-mod/nestjs-mod-fullstack-nginx         latest    d5502067f83f   12 minutes ago   47.6MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ghcr.io/nestjs-mod/nestjs-mod-fullstack-migrations    0.0.0     37854dd50cee   13 minutes ago   889MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ghcr.io/nestjs-mod/nestjs-mod-fullstack-migrations    latest    37854dd50cee   13 minutes ago   889MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ghcr.io/nestjs-mod/nestjs-mod-fullstack-server        0.0.1     0d97265cf4c3   14 minutes ago   406MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ghcr.io/nestjs-mod/nestjs-mod-fullstack-server        latest    0d97265cf4c3   14 minutes ago   406MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ghcr.io/nestjs-mod/nestjs-mod-fullstack-base-server   0.0.0     9375674299d4   14 minutes ago   423MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ghcr.io/nestjs-mod/nestjs-mod-fullstack-base-server   latest    9375674299d4   14 minutes ago   423MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ghcr.io/nestjs-mod/nestjs-mod-fullstack-builder       0.0.0     7d97e169a196   16 minutes ago   1.46GB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ghcr.io/nestjs-mod/nestjs-mod-fullstack-builder       latest    7d97e169a196   16 minutes ago   1.46GB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">steveltn/https-portal                                 1         0b78eab92499   8 days ago       295MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bitnami/postgresql                                    15.5.0    47ef5063d3bc   7 months ago     275MB</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-выводим-список-запущенных-контейнеров">12. Выводим список запущенных контейнеров<a class="hash-link" aria-label="Direct link to 12. Выводим список запущенных контейнеров" title="Direct link to 12. Выводим список запущенных контейнеров" href="/docs/ru-posts/fullstack/2024-09-08#12-выводим-список-запущенных-контейнеров">​</a></h3>
<p><em>Команды</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker stats</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>Вывод консоли</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ docker stats</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONTAINER ID   NAME                                CPU %     MEM USAGE / LIMIT     MEM %     NET I/O           BLOCK I/O         PIDS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7681c91d0da3   nestjs-mod-fullstack-https-portal   0.00%     11.09MiB / 15.59GiB   0.07%     19.9kB / 0B       0B / 127kB        18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">45326f0c1f0d   nestjs-mod-fullstack-nginx          0.00%     11.21MiB / 15.59GiB   0.07%     60.9kB / 704kB    1.05MB / 8.19kB   8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8c2c76c87d12   nestjs-mod-fullstack-server         0.02%     84.41MiB / 15.59GiB   0.53%     339kB / 21.7kB    28.8MB / 4.1kB    23</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ef5075938209   nestjs-mod-fullstack-postgre-sql    0.00%     52.74MiB / 15.59GiB   0.33%     62.8kB / 25.6kB   119kB / 54.1MB    7</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-проверяем-результат-запуска-e2e-тестов">13. Проверяем результат запуска E2E-тестов<a class="hash-link" aria-label="Direct link to 13. Проверяем результат запуска E2E-тестов" title="Direct link to 13. Проверяем результат запуска E2E-тестов" href="/docs/ru-posts/fullstack/2024-09-08#13-проверяем-результат-запуска-e2e-тестов">​</a></h3>
<p><em>Команды</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker logs nestjs-mod-fullstack-e2e-tests</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>Вывод консоли</em></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ docker logs nestjs-mod-fullstack-e2e-tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; @nestjs-mod-fullstack/source@0.0.0 test:e2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ./node_modules/.bin/nx run-many --exclude=@nestjs-mod-fullstack/source --all -t=e2e --skip-nx-cache=true --output-style=stream-without-prefixes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NX  Falling back to ts-node for local typescript execution. This may be a little slower.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - To fix this, ensure @swc-node/register and @swc/core have been installed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Running target e2e for 2 projects:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- client-e2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- server-e2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; nx run client-e2e:e2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; playwright test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Running 6 tests using 3 workers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  6 passed (4.9s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">To open last HTML report run:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  npx playwright show-report ../../dist/.playwright/apps/client-e2e/playwright-report</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; nx run server-e2e:e2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Setting up...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> PASS   server-e2e  apps/server-e2e/src/server/server.spec.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  GET /api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ✓ should return a message (31 ms)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ✓ should create and return a demo object (34 ms)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ✓ should get demo object by id (9 ms)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ✓ should get all demo object (7 ms)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ✓ should delete demo object by id (7 ms)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ✓ should get all demo object (5 ms)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Test Suites: 1 passed, 1 total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tests:       6 passed, 6 total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Snapshots:   0 total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Time:        0.643 s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ran all test suites.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tearing down...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NX   Successfully ran target e2e for 2 projects</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="14-модифицируем-cicd-конфигурацию-для-деплоя-приложений-на-выделенный-сервер">14. Модифицируем CI/CD-конфигурацию для деплоя приложений на выделенный сервер<a class="hash-link" aria-label="Direct link to 14. Модифицируем CI/CD-конфигурацию для деплоя приложений на выделенный сервер" title="Direct link to 14. Модифицируем CI/CD-конфигурацию для деплоя приложений на выделенный сервер" href="/docs/ru-posts/fullstack/2024-09-08#14-модифицируем-cicd-конфигурацию-для-деплоя-приложений-на-выделенный-сервер">​</a></h3>
<p>Конфигурация получилась очень большой, так как там учтены различные сценарии и этапы сборки образов с целью ускорить процесс деплоя.</p>
<p>Основные моменты я опишу ниже и в конце будет ссылка на полное содержимое CI/CD-конфигурации.</p>
<p><em>Проверка наличия базового образа</em></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">check-base-server-image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Игнорируем ошибки которые могут возникать в процессе работы Job-ы</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">continue-on-error</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Скачиваем репозиторий</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Checkout repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Если в тексте коммита мы напишем [skip cache] то все проверки наличия образов будут проигнорированны и билд образов будет запущен</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">if</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!contains(github.event.head_commit.message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> &#x27;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">skip cache</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">&#x27;) </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Формируем новые переменные окружения в рамках процесса работы Job-ы</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Set ENV vars</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">if</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!contains(github.event.head_commit.message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> &#x27;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">skip cache</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">&#x27;) </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Получаем версию проекта из package.json</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          echo &quot;root_version=&quot;$(npm pkg get version --workspaces=false | tr -d \&quot;) &gt;&gt; &quot;$GITHUB_OUTPUT&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Проверяем наличие контейнера с определенной версией в Docker-регистре</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Check exists docker image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">if</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!contains(github.event.head_commit.message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> &#x27;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">skip cache</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">&#x27;) </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> check</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Для проверки мы сперва получаем токен авторизации в Docker-регистр, а затем проверяем наличие manifests-файла для определенной версии</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          export TOKEN=$(curl -u ${{ github.actor }}:${{ secrets.GITHUB_TOKEN }} https://${{ env.REGISTRY }}/token\?scope\=&quot;repository:${{ env.BASE_SERVER_IMAGE_NAME}}:pull&quot; | jq -r .token)</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          curl --head --fail -H &quot;Authorization: Bearer $TOKEN&quot; https://${{ env.REGISTRY }}/v2/${{ env.BASE_SERVER_IMAGE_NAME}}/manifests/${{ steps.version.outputs.root_version }}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Проверяем ответ запроса на наличие manifests-файла и если код ответа не 404, то значит что Docker-образ существует</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Store result of check exists docker image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> store</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">check</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">if</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!contains(github.event.head_commit.message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> &#x27;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">skip cache</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">&#x27;) </span><span class="token important">&amp;&amp;</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!contains(needs.check-exists.outputs.result</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> &#x27;HTTP/2 404&#x27;) </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          echo &quot;conclusion=success&quot; &gt;&gt; &quot;$GITHUB_OUTPUT&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Кладем результат запроса в выходной объект данной Job-ы</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">outputs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">result</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> steps.store</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">check</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">exists.outputs.conclusion </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>Сборка базового образа</em></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build-and-push-base-server-image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Текущая Job-а запустится только после прохождения Job-ы check-base-server-image</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">needs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">check</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">base</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Запрашиваем разрешения для публикации Docker-образов в Docker-регистр Github-а</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">permissions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">contents</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> read</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">packages</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> write</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">attestations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> write</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">id-token</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> write</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Скачиваем репозиторий</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Checkout repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">if</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> needs.check</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">base</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">image.outputs.result </span><span class="token tag" style="color:#00009f">!=</span><span class="token plain"> &#x27;success&#x27; </span><span class="token punctuation" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> contains(github.event.head_commit.message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> &#x27;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">skip cache</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">&#x27;) </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Формируем новые переменные окружения в рамках процесса работы Job-ы</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Set ENV vars</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">if</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> needs.check</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">base</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">image.outputs.result </span><span class="token tag" style="color:#00009f">!=</span><span class="token plain"> &#x27;success&#x27; </span><span class="token punctuation" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> contains(github.event.head_commit.message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> &#x27;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">skip cache</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">&#x27;) </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Получаем версию проекта из package.json</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          echo &quot;root_version=&quot;$(npm pkg get version --workspaces=false | tr -d \&quot;) &gt;&gt; &quot;$GITHUB_OUTPUT&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Авторизуемся в Docker-регистре</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Log in to the Container registry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">if</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> needs.check</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">base</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">image.outputs.result </span><span class="token tag" style="color:#00009f">!=</span><span class="token plain"> &#x27;success&#x27; </span><span class="token punctuation" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> contains(github.event.head_commit.message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> &#x27;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">skip cache</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">&#x27;) </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> docker/login</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">action@65b78e6e13532edd9afa3aa52ac7964289d1a9c1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">registry</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> env.REGISTRY </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> github.actor </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.GITHUB_TOKEN </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Собираем и публикуем Docker-образ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Build and push Docker image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Проверяем что проверка наличия образа не прошла, это означает что нам необходимо собрать и опубликовать образ,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># а также проверяем что проверка наличия образа не была проигнорирована</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">if</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> needs.check</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">base</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">image.outputs.result </span><span class="token tag" style="color:#00009f">!=</span><span class="token plain"> &#x27;success&#x27; </span><span class="token punctuation" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> contains(github.event.head_commit.message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> &#x27;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">skip cache</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">&#x27;) </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> push</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> docker/build</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">push</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">action@f2a1d5e99d037542a71f64918e516c093c6f3fc4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">context</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">push</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">file</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ./.docker/base</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">server.Dockerfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># Собранный обр аз будет иметь тэг равный версии проекта, а также будет иметь тэг latest</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">tags</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> env.REGISTRY</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> env.BASE_SERVER_IMAGE_NAME</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> steps.version.outputs.root_version </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> env.REGISTRY</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> env.BASE_SERVER_IMAGE_NAME</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># Указываем репозиторий для проверки существующих слоев, это нужно чтобы частично ускорить сборку</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">cache-from</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> type=registry</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">ref=$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> env.REGISTRY</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> env.BASE_SERVER_IMAGE_NAME</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> steps.version.outputs.root_version </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">cache-to</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> type=inline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Формируем цифровую подпись образа</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Generate artifact attestation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Игнорируем ошибки которые могут возникать в процессе работы</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">continue-on-error</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">if</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> needs.check</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">base</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">image.outputs.result </span><span class="token tag" style="color:#00009f">!=</span><span class="token plain"> &#x27;success&#x27; </span><span class="token punctuation" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> contains(github.event.head_commit.message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> &#x27;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">skip cache</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">&#x27;) </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/attest</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">build</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">provenance@v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">subject-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> env.REGISTRY </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> env.BASE_SERVER_IMAGE_NAME</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">subject-digest</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> steps.push.outputs.digest </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">push-to-registry</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Файл с CI/CD-конфигурацией: <a href="https://github.com/nestjs-mod/nestjs-mod-fullstack/blob/master/.github/workflows/docker-compose.workflows.yml" target="_blank" rel="noopener noreferrer">https://github.com/nestjs-mod/nestjs-mod-fullstack/blob/master/.github/workflows/docker-compose.workflows.yml</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="15-коммитим-обновления-в-репозиторий-и-смотрим-результат-работы-в-github">15. Коммитим обновления в репозиторий и смотрим результат работы в &quot;Github&quot;<a class="hash-link" aria-label="Direct link to 15. Коммитим обновления в репозиторий и смотрим результат работы в &quot;Github&quot;" title="Direct link to 15. Коммитим обновления в репозиторий и смотрим результат работы в &quot;Github&quot;" href="/docs/ru-posts/fullstack/2024-09-08#15-коммитим-обновления-в-репозиторий-и-смотрим-результат-работы-в-github">​</a></h3>
<p>Для текущего проекта рабочий процесс раннеров можно видеть вот тут: <a href="https://github.com/nestjs-mod/nestjs-mod-fullstack/actions" target="_blank" rel="noopener noreferrer">https://github.com/nestjs-mod/nestjs-mod-fullstack/actions</a></p>
<p>Текущее рабочий процесс раннера: <a href="https://github.com/nestjs-mod/nestjs-mod-fullstack/actions/runs/10762536037" target="_blank" rel="noopener noreferrer">https://github.com/nestjs-mod/nestjs-mod-fullstack/actions/runs/10762536037</a>
Текущее время полного деплоя вместе с прогоном E2E-тестов: <code>6m 20s</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="заключение">Заключение<a class="hash-link" aria-label="Direct link to Заключение" title="Direct link to Заключение" href="/docs/ru-posts/fullstack/2024-09-08#заключение">​</a></h3>
<p>Когда я начал писать этот пост, я планировал использовать классный инструмент для локального запуска Github-акшенов <a href="https://github.com/nektos/act" target="_blank" rel="noopener noreferrer">https://github.com/nektos/act</a> и успешно смог через него запустить локально сборку и запуск всего проекта, но для этого пришлось выделить больший объем памяти и процессора, в итоге от <a href="https://github.com/nektos/act" target="_blank" rel="noopener noreferrer">https://github.com/nektos/act</a> пришлось отказаться и написать небольшой Bash-скрипт для сборки образов.</p>
<p>Объемы образов мигратора и тест-раннера получились очень большими, но это не так критично, так как эти образа пересобираются только при изменении версии рутового package.json.</p>
<p>В данный момент нет автоматической пересборки образов после изменения кода или изменения зависимостей проекта, пересборка происходит только после ручной модификации версии рутового package.json или package.json приложения, в дальнейших постах появится автоматическое версионирование и в ручную менять ничего не нужно будет.</p>
<p>Хотя проект и использует nx, на данном этапе я не пользуюсь всеми его возможностями, так как сперва нужно внедрить обычные пути оптимизации и ускорения процесса сборки и деплоя образов.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="планы">Планы<a class="hash-link" aria-label="Direct link to Планы" title="Direct link to Планы" href="/docs/ru-posts/fullstack/2024-09-08#планы">​</a></h3>
<p>В следующем посте я установлю Kubernetes на выделенный сервер и перенастрою CI/CD-конфигурацию проекта...</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ссылки">Ссылки<a class="hash-link" aria-label="Direct link to Ссылки" title="Direct link to Ссылки" href="/docs/ru-posts/fullstack/2024-09-08#ссылки">​</a></h3>
<ul>
<li><a href="https://nestjs.com" target="_blank" rel="noopener noreferrer">https://nestjs.com</a> - официальный сайт фреймворка</li>
<li><a href="https://nestjs-mod.com" target="_blank" rel="noopener noreferrer">https://nestjs-mod.com</a> - официальный сайт дополнительных утилит</li>
<li><a href="https://fullstack.nestjs-mod.com" target="_blank" rel="noopener noreferrer">https://fullstack.nestjs-mod.com</a> - сайт из поста</li>
<li><a href="https://github.com/nestjs-mod/nestjs-mod-fullstack" target="_blank" rel="noopener noreferrer">https://github.com/nestjs-mod/nestjs-mod-fullstack</a> - проект из поста</li>
<li><a href="https://github.com/nestjs-mod/nestjs-mod-fullstack/commit/6270febc23d50100133897630c1476b30b7e8751" target="_blank" rel="noopener noreferrer">https://github.com/nestjs-mod/nestjs-mod-fullstack/commit/6270febc23d50100133897630c1476b30b7e8751</a> - изменения</li>
</ul>
<p>#docker #github #nestjsmod #fullstack
#2024-09-08</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/nestjs-mod/nestjs-mod.com/blob/master/docs/ru-posts/fullstack/2024-09-08.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/ru-posts/fullstack/2024-08-26"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Добавляем CI/CD конфиг для деплоя NestJS и Angular приложений на выделенный сервер с помощью GitHub Actions</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/ru-posts/fullstack/2024-09-13"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Установка Kubernetes через MicroK8s и настройка деплоя NestJS и Angular приложений</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-09-08#1-создаем-docker-образ-со-всеми-зависимостями">1. Создаем Docker-образ со всеми зависимостями</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-09-08#2-создаем-базовый-docker-образ-для-запуска-nestjs-приложения">2. Создаем базовый Docker-образ для запуска NestJS-приложения</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-09-08#3-создаем-docker-образ-для-запуска-nestjs-приложения">3. Создаем Docker-образ для запуска NestJS-приложения</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-09-08#4-создаем-docker-образ-для-запуска-миграций-в-базы-данных">4. Создаем Docker-образ для запуска миграций в базы данных</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-09-08#5-создаем-docker-образ-для-запуска-e2e-тестов">5. Создаем Docker-образ для запуска E2E-тестов</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-09-08#6-клиентский-код-отдается-через-nginx-так-что-создаем-docker-образ-с-встроенным-nginx-и-статичными-файлами">6. Клиентский код отдается через Nginx, так что создаем Docker-образ с встроенным Nginx и статичными файлами</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-09-08#7-обновляем-файлы-для-запуска-в-режиме-docker-compose">7. Обновляем файлы для запуска в режиме &quot;Docker Compose&quot;</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-09-08#8-создаем-bash-скрипт-для-построения-локальных-docker-образов">8. Создаем Bash-скрипт для построения локальных Docker-образов</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-09-08#9-для-запуска-обновленного-режима-docker-compose-необходимо-обновить-все-npm-скрипты">9. Для запуска обновленного режима &quot;Docker Compose&quot; необходимо обновить все npm-скрипты</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-09-08#10-запускаем-обновленный-docker-compose-режим-с-встроеным-запуском-e2e-тестов">10. Запускаем обновленный &quot;Docker Compose&quot; режим с встроеным запуском E2E-тестов</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-09-08#11-выводим-список-собранных-образов-и-проверяем-что-они-все-собрались-успешно">11. Выводим список собранных образов и проверяем что они все собрались успешно</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-09-08#12-выводим-список-запущенных-контейнеров">12. Выводим список запущенных контейнеров</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-09-08#13-проверяем-результат-запуска-e2e-тестов">13. Проверяем результат запуска E2E-тестов</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-09-08#14-модифицируем-cicd-конфигурацию-для-деплоя-приложений-на-выделенный-сервер">14. Модифицируем CI/CD-конфигурацию для деплоя приложений на выделенный сервер</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-09-08#15-коммитим-обновления-в-репозиторий-и-смотрим-результат-работы-в-github">15. Коммитим обновления в репозиторий и смотрим результат работы в &quot;Github&quot;</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-09-08#заключение">Заключение</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-09-08#планы">Планы</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/ru-posts/fullstack/2024-09-08#ссылки">Ссылки</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/guides/introduction">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/drpg5rTmgG" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://t.me/nestjs_mod" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Links</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://dev.to/t/nestjsmod" target="_blank" rel="noopener noreferrer" class="footer__link-item">Posts on Dev.to<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://habr.com/ru/search/?q=[nestjsmod]" target="_blank" rel="noopener noreferrer" class="footer__link-item">Posts on Habr.com<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/nestjs-mod" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.npmjs.com/org/nestjs-mod" target="_blank" rel="noopener noreferrer" class="footer__link-item">NPM<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 NestJS-mod</div></div></div></footer></div>
</body>
</html>